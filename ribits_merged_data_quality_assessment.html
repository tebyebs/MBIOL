<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-11-24">

<title>RIBITS Cleaned Data Quality Assessment</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ribits_merged_data_quality_assessment_files/libs/clipboard/clipboard.min.js"></script>
<script src="ribits_merged_data_quality_assessment_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="ribits_merged_data_quality_assessment_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="ribits_merged_data_quality_assessment_files/libs/quarto-html/popper.min.js"></script>
<script src="ribits_merged_data_quality_assessment_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ribits_merged_data_quality_assessment_files/libs/quarto-html/anchor.min.js"></script>
<link href="ribits_merged_data_quality_assessment_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ribits_merged_data_quality_assessment_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ribits_merged_data_quality_assessment_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ribits_merged_data_quality_assessment_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ribits_merged_data_quality_assessment_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#document-setup" id="toc-document-setup" class="nav-link" data-scroll-target="#document-setup">Document Setup</a>
  <ul>
  <li><a href="#load-packages-and-set-chunk-options" id="toc-load-packages-and-set-chunk-options" class="nav-link" data-scroll-target="#load-packages-and-set-chunk-options">Load Packages and Set Chunk Options</a></li>
  <li><a href="#load-reusable-functions" id="toc-load-reusable-functions" class="nav-link" data-scroll-target="#load-reusable-functions">Load Reusable Functions</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data">Load Data</a></li>
  <li><a href="#clean-up-data" id="toc-clean-up-data" class="nav-link" data-scroll-target="#clean-up-data">Clean up data</a></li>
  <li><a href="#create-analysis-dataframes" id="toc-create-analysis-dataframes" class="nav-link" data-scroll-target="#create-analysis-dataframes">Create Analysis Dataframes</a></li>
  </ul></li>
  <li><a href="#data-exploration" id="toc-data-exploration" class="nav-link" data-scroll-target="#data-exploration">Data Exploration</a>
  <ul>
  <li><a href="#data-quality" id="toc-data-quality" class="nav-link" data-scroll-target="#data-quality">Data Quality</a>
  <ul class="collapse">
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data">Missing Data</a></li>
  <li><a href="#spatial-data-quality" id="toc-spatial-data-quality" class="nav-link" data-scroll-target="#spatial-data-quality">Spatial Data Quality</a></li>
  <li><a href="#footprint-and-total-acres-coverage" id="toc-footprint-and-total-acres-coverage" class="nav-link" data-scroll-target="#footprint-and-total-acres-coverage">Footprint and Total Acres Coverage</a></li>
  <li><a href="#footprint-and-total-acres-alignment" id="toc-footprint-and-total-acres-alignment" class="nav-link" data-scroll-target="#footprint-and-total-acres-alignment">Footprint and Total Acres Alignment</a></li>
  </ul></li>
  <li><a href="#bank-characteristics" id="toc-bank-characteristics" class="nav-link" data-scroll-target="#bank-characteristics">Bank Characteristics</a>
  <ul class="collapse">
  <li><a href="#spatial-distribution" id="toc-spatial-distribution" class="nav-link" data-scroll-target="#spatial-distribution">Spatial Distribution</a></li>
  <li><a href="#kinds-of-banks" id="toc-kinds-of-banks" class="nav-link" data-scroll-target="#kinds-of-banks">Kinds of Banks</a></li>
  <li><a href="#bank-type" id="toc-bank-type" class="nav-link" data-scroll-target="#bank-type">Bank Type</a></li>
  <li><a href="#bank-status" id="toc-bank-status" class="nav-link" data-scroll-target="#bank-status">Bank Status</a></li>
  <li><a href="#bank-establishment" id="toc-bank-establishment" class="nav-link" data-scroll-target="#bank-establishment">Bank Establishment</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#bank-cowardin-classes" id="toc-bank-cowardin-classes" class="nav-link" data-scroll-target="#bank-cowardin-classes">Bank Cowardin Classes</a>
  <ul>
  <li><a href="#top-classifications-by-level" id="toc-top-classifications-by-level" class="nav-link" data-scroll-target="#top-classifications-by-level">Top Classifications by Level</a></li>
  <li><a href="#classification-complexity-analysis" id="toc-classification-complexity-analysis" class="nav-link" data-scroll-target="#classification-complexity-analysis">Classification Complexity Analysis</a></li>
  <li><a href="#key-findings" id="toc-key-findings" class="nav-link" data-scroll-target="#key-findings">Key Findings</a></li>
  </ul></li>
  <li><a href="#types-of-credits" id="toc-types-of-credits" class="nav-link" data-scroll-target="#types-of-credits">Types of Credits</a></li>
  <li><a href="#summary-and-next-steps" id="toc-summary-and-next-steps" class="nav-link" data-scroll-target="#summary-and-next-steps">Summary and Next Steps</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">RIBITS Cleaned Data Quality Assessment</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 24, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The Regulatory In-lieu Fee and Bank Information Tracking System (RIBITS) is a database maintained by the U.S. Army Corps of Engineers that tracks mitigation banks, in-lieu fee programs, and sites across the United States. Mitigation banking allows developers who impact wetlands or streams to offset those impacts by purchasing credits from approved banks, which are created, restored, rehabilitated, or preserved wetlands. RIBITS provides key details such as locations, service areas, status, and credit information, making it the main public source for understanding and analyzing mitigation activities nationwide.</p>
<p>I programatically extracted RIBITS data via the GeoJSON API and processed it into a GeoPackage file. The data was processed through a multi-stage pipeline:</p>
<ul>
<li>Raw data extraction from RIBITS API</li>
<li>Spatial data processing</li>
<li>GeoPackage creation with multi-layer spatial data.</li>
</ul>
<p>Here, I explore the downloaded raw dataset to look at overall coverage and QA checks.</p>
</section>
<section id="document-setup" class="level1">
<h1>Document Setup</h1>
<section id="load-packages-and-set-chunk-options" class="level2">
<h2 class="anchored" data-anchor-id="load-packages-and-set-chunk-options">Load Packages and Set Chunk Options</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)                    <span class="co"># Spatial data handling</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)                 <span class="co"># Data manipulation</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)               <span class="co"># Data cleaning</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)                 <span class="co"># Functional programming</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)               <span class="co"># Data visualization</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)             <span class="co"># Date and time manipulation</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)                  <span class="co"># File path handling</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)                 <span class="co"># Data tidying</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)                 <span class="co"># Document knitting</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)            <span class="co"># Table styling</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)                  <span class="co"># String interpolation</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)                 <span class="co"># working with base R</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)               <span class="co"># pattern matching</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)                    <span class="co"># Table styling</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)         <span class="co"># Map data</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthdata)     <span class="co"># Map data</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthhires)    <span class="co"># Map data</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)              <span class="co"># Text processing</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Set ggplot theme</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)))</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Global chunk options</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">echo       =</span> <span class="cn">FALSE</span>,   <span class="co"># Hide code by default for clean report</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">message    =</span> <span class="cn">FALSE</span>,  <span class="co"># Hide messages (like package loading)</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="at">warning    =</span> <span class="cn">FALSE</span>,  <span class="co"># Hide warnings</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="at">error      =</span> <span class="cn">FALSE</span>,  <span class="co"># Stop on errors instead of showing them in report</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.align  =</span> <span class="st">"center"</span>, <span class="co"># Center all plots</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">out.width  =</span> <span class="st">"90%"</span>,  <span class="co"># Scale figures nicely</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi        =</span> <span class="dv">300</span>     <span class="co"># High resolution figures</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="load-reusable-functions" class="level2">
<h2 class="anchored" data-anchor-id="load-reusable-functions">Load Reusable Functions</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Function: Table style formatter</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>style_table <span class="ot">&lt;-</span> <span class="cf">function</span>(gt_tbl, title, <span class="at">subtitle =</span> <span class="cn">NULL</span>) {</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  gt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add title and subtitle/table_caption</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">md</span>(title),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(subtitle)) <span class="fu">md</span>(subtitle) <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make column headers bold</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>()</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add row stripes</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opt_row_striping</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># General formatting options</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">column_labels.border.bottom.color =</span> <span class="st">"black"</span>,    <span class="co"># Line under header</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">column_labels.border.bottom.width =</span> <span class="fu">px</span>(<span class="dv">2</span>),</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.border.top.color =</span> <span class="st">"transparent"</span>,         <span class="co"># No top border</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.border.bottom.color =</span> <span class="st">"transparent"</span>,      <span class="co"># No bottom border</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.width =</span> <span class="fu">pct</span>(<span class="dv">90</span>),                          <span class="co"># Consistent width      </span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.align =</span> <span class="st">"center"</span>                          <span class="co"># Center the table</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Function: collapse_and_count</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Collapses a variable to one value per bank, counts banks per value, and </span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a><span class="co"># handles multi-valued strings (splits and counts tokens).</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments:</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   data:        Input data (sf or tibble)</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   var:         Column to analyze (unquoted)</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   how:         Collapse method ("first", "min", "max", "concat")</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   explode:     TRUE to split multi-valued strings and count tokens</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   token_rx:    Regular expression to extract tokens when explode=TRUE</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   sep:         Joiner for concatenation</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns:</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   list(counts, bank_level, conflicts)</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>collapse_and_count <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var,</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>                               <span class="at">how =</span> <span class="st">"first"</span>,</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>                               <span class="at">explode =</span> <span class="cn">FALSE</span>,</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>                               <span class="at">token_rx =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">b[A-Z]{2}</span><span class="sc">\\</span><span class="st">b"</span>,</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sep =</span> <span class="st">", "</span>) {</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure data is a tibble. Using as_tibble on sf objects is deprecated,</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># but st_drop_geometry() is a safe way to convert to a regular tibble.</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(data, <span class="st">"sf"</span>)) {</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data)</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(data)</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert var to symbol for easier handling</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  var_sym <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">ensym</span>(var)</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  var_str <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">as_string</span>(var_sym)</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure column exists</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(var_str <span class="sc">%in%</span> <span class="fu">names</span>(data))</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Validate `how` parameter</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>  how <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(how, <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"first"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"concat"</span>))</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define collapse function</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>  bank_collapse <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var_sym, how, sep) {</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>    var_str <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">as_string</span>(var_sym)</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>    data <span class="sc">%&gt;%</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!!</span><span class="at">var_sym :=</span> {</span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a>          vals <span class="ot">&lt;-</span> .data[[var_str]]</span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a>          vals <span class="ot">&lt;-</span> vals[<span class="sc">!</span><span class="fu">is.na</span>(vals) <span class="sc">&amp;</span> vals <span class="sc">!=</span> <span class="st">""</span>]</span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">length</span>(vals) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Return a type-stable NA</span></span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>            <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>          <span class="cf">switch</span>(how,</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>                 <span class="at">first  =</span> dplyr<span class="sc">::</span><span class="fu">first</span>(vals),</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>                 <span class="at">min    =</span> <span class="fu">suppressWarnings</span>(<span class="fu">min</span>(vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>                 <span class="at">max    =</span> <span class="fu">suppressWarnings</span>(<span class="fu">max</span>(vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>                 <span class="at">concat =</span> <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.character</span>(vals))), <span class="at">collapse =</span> sep)</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>explode) {</span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Call the collapse function</span></span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>    bank_level <span class="ot">&lt;-</span> <span class="fu">bank_collapse</span>(data, var_sym, how, sep)</span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>    counts <span class="ot">&lt;-</span> bank_level <span class="sc">%&gt;%</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>(<span class="sc">!!</span>var_sym, <span class="at">name =</span> <span class="st">"n_banks"</span>, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate conflicts - banks with multiple different values</span></span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>    conflicts <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_distinct =</span> <span class="fu">n_distinct</span>(.data[[var_str]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb2-116"><a href="#cb2-116" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb2-117"><a href="#cb2-117" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(n_distinct <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-118"><a href="#cb2-118" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(bank_id, n_distinct)</span>
<span id="cb2-119"><a href="#cb2-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-120"><a href="#cb2-120" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-121"><a href="#cb2-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Explode mode for multi-valued strings</span></span>
<span id="cb2-122"><a href="#cb2-122" aria-hidden="true" tabindex="-1"></a>    data_exploded <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb2-123"><a href="#cb2-123" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(bank_id, <span class="sc">!!</span>var_sym) <span class="sc">%&gt;%</span></span>
<span id="cb2-124"><a href="#cb2-124" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">.raw =</span> <span class="fu">as.character</span>(.data[[var_str]])) <span class="sc">%&gt;%</span></span>
<span id="cb2-125"><a href="#cb2-125" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">tokens =</span> stringr<span class="sc">::</span><span class="fu">str_extract_all</span>(<span class="fu">coalesce</span>(.raw, <span class="st">""</span>), token_rx)) <span class="sc">%&gt;%</span></span>
<span id="cb2-126"><a href="#cb2-126" aria-hidden="true" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">unnest_longer</span>(tokens, <span class="at">values_to =</span> <span class="st">"token"</span>, <span class="at">keep_empty =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-127"><a href="#cb2-127" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">token =</span> <span class="fu">na_if</span>(token, <span class="st">""</span>))</span>
<span id="cb2-128"><a href="#cb2-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-129"><a href="#cb2-129" aria-hidden="true" tabindex="-1"></a>    counts <span class="ot">&lt;-</span> data_exploded <span class="sc">%&gt;%</span></span>
<span id="cb2-130"><a href="#cb2-130" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(token)) <span class="sc">%&gt;%</span></span>
<span id="cb2-131"><a href="#cb2-131" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>(token, <span class="at">name =</span> <span class="st">"n_banks"</span>, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-132"><a href="#cb2-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-133"><a href="#cb2-133" aria-hidden="true" tabindex="-1"></a>    bank_level <span class="ot">&lt;-</span> data_exploded <span class="sc">%&gt;%</span></span>
<span id="cb2-134"><a href="#cb2-134" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(token)) <span class="sc">%&gt;%</span></span>
<span id="cb2-135"><a href="#cb2-135" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb2-136"><a href="#cb2-136" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb2-137"><a href="#cb2-137" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!!</span><span class="at">var_sym :=</span> <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(token)), <span class="at">collapse =</span> sep),</span>
<span id="cb2-138"><a href="#cb2-138" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb2-139"><a href="#cb2-139" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb2-140"><a href="#cb2-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-141"><a href="#cb2-141" aria-hidden="true" tabindex="-1"></a>    conflicts <span class="ot">&lt;-</span> data_exploded <span class="sc">%&gt;%</span></span>
<span id="cb2-142"><a href="#cb2-142" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb2-143"><a href="#cb2-143" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb2-144"><a href="#cb2-144" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_distinct =</span> <span class="fu">n_distinct</span>(token, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb2-145"><a href="#cb2-145" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb2-146"><a href="#cb2-146" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb2-147"><a href="#cb2-147" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(n_distinct <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb2-148"><a href="#cb2-148" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(bank_id, n_distinct)</span>
<span id="cb2-149"><a href="#cb2-149" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-150"><a href="#cb2-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-151"><a href="#cb2-151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb2-152"><a href="#cb2-152" aria-hidden="true" tabindex="-1"></a>    <span class="at">counts =</span> counts,</span>
<span id="cb2-153"><a href="#cb2-153" aria-hidden="true" tabindex="-1"></a>    <span class="at">bank_level =</span> bank_level,</span>
<span id="cb2-154"><a href="#cb2-154" aria-hidden="true" tabindex="-1"></a>    <span class="at">conflicts =</span> conflicts</span>
<span id="cb2-155"><a href="#cb2-155" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb2-156"><a href="#cb2-156" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-157"><a href="#cb2-157" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="load-data" class="level2">
<h2 class="anchored" data-anchor-id="load-data">Load Data</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the merged bank summary data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>merged_bank_summary <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"data_intermediate"</span>, <span class="st">"merged_bank_summary.rds"</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in the geopackage data</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>gpkg_file <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"data_intermediate"</span>, <span class="st">"bank_geometries.gpkg"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(gpkg_file)) {</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load all layers</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  centroids <span class="ot">&lt;-</span> <span class="fu">st_read</span>(gpkg_file, <span class="at">layer =</span> <span class="st">"bank_centroids"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  footprints <span class="ot">&lt;-</span> <span class="fu">st_read</span>(gpkg_file, <span class="at">layer =</span> <span class="st">"bank_footprints"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  service_areas <span class="ot">&lt;-</span> <span class="fu">st_read</span>(gpkg_file, <span class="at">layer =</span> <span class="st">"bank_service_areas"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  service_areas_individual <span class="ot">&lt;-</span> <span class="fu">st_read</span>(gpkg_file, <span class="at">layer =</span> <span class="st">"bank_service_areas_individual"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"GeoPackage file not found!"</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="clean-up-data" class="level2">
<h2 class="anchored" data-anchor-id="clean-up-data">Clean up data</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up the data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>merged_bank_summary <span class="ot">&lt;-</span> merged_bank_summary <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up the geometry data</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>centroids <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(centroids)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>footprints <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(footprints)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>service_areas <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(service_areas)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>service_areas_individual <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(service_areas_individual)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="create-analysis-dataframes" class="level2">
<h2 class="anchored" data-anchor-id="create-analysis-dataframes">Create Analysis Dataframes</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># To avoid memory issues, I separate out the geometries from the main table.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and rename geometry from each layer</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>centroids_geom <span class="ot">&lt;-</span> centroids <span class="sc">%&gt;%</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id) <span class="sc">%&gt;%</span> </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">centroid =</span> geom)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>footprints_geom <span class="ot">&lt;-</span> footprints <span class="sc">%&gt;%</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id) <span class="sc">%&gt;%</span> </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">footprint =</span> geom)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>service_areas_geom <span class="ot">&lt;-</span> service_areas <span class="sc">%&gt;%</span> </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id) <span class="sc">%&gt;%</span> </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">service_area =</span> geom)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Join them together into a single spatial dataframe</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># We start with all bank IDs from the main table to ensure all banks are included</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>banks_geometries <span class="ot">&lt;-</span> merged_bank_summary <span class="sc">%&gt;%</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(centroids_geom, <span class="at">by =</span> <span class="st">"bank_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(footprints_geom, <span class="at">by =</span> <span class="st">"bank_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(service_areas_geom, <span class="at">by =</span> <span class="st">"bank_id"</span>)</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, create a fast, non-spatial main dataframe with availability flags</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># This adds boolean flags to the main data, which is much faster and more</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co"># memory-efficient than joining the actual geometries.</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> merged_bank_summary <span class="sc">%&gt;%</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># True/False for if the variable exists</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_centroid =</span> bank_id <span class="sc">%in%</span> centroids<span class="sc">$</span>bank_id,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_footprint =</span> bank_id <span class="sc">%in%</span> footprints<span class="sc">$</span>bank_id,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_service_area =</span> bank_id <span class="sc">%in%</span> service_areas<span class="sc">$</span>bank_id</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a><span class="co"># clean names again</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up intermediate objects to save memory</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(centroids_geom, footprints_geom, service_areas_geom)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the individual spatial dataframes since they are in a combined one</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(centroids, footprints, service_areas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="data-exploration" class="level1">
<h1>Data Exploration</h1>
<p>Lets explore the basic characteristics of the RIBITS dataset, including variable descriptions, data availability and quality, bank types, and geographic distribution.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display available variables (commented out for now)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># data %&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-BANK_LOCATION_CENTROID) %&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   colnames() %&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   paste(collapse = ", ")</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This is pasted from RIBITS documentation</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>ribits_vars <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>Variable,                  <span class="sc">~</span>Description,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_ID"</span>,                  <span class="st">"Unique ID for the bank or ILF site"</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_NAME"</span>,                <span class="st">"Name of the bank"</span>,</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"kind_of_bank"</span>,             <span class="st">"ILF, NRDA, Umbrella, or Standard"</span>,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IS_404"</span>,                   <span class="st">"Yes or No (Section 404 applicability)"</span>,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IS_CONSERVATION"</span>,          <span class="st">"Yes or No (Conservation bank indicator)"</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CHAIR"</span>,                    <span class="st">"Overseeing agency"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"district"</span>,                 <span class="st">"Managing district the bank is in"</span>,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SECONDARY_district_LIST"</span>,  <span class="st">"Secondary districts the bank location is in"</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FIELD_OFFICE"</span>,             <span class="st">"Affiliated field office the bank is in"</span>,</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SECONDARY_OFFICE_LIST"</span>,    <span class="st">"Secondary field offices the bank is in"</span>,</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NMFS_REGION"</span>,              <span class="st">"Affiliated NMFS region"</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SECONDARY_NOAA_REGION_LIST"</span>,<span class="st">"Secondary NMFS regions the bank is in"</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"state_list"</span>,               <span class="st">"Comma-separated list of states"</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COUNTY_LIST"</span>,              <span class="st">"Comma-separated list of counties"</span>,</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PERMIT_NUMBER"</span>,            <span class="st">"Comma-separated list of bank or site permits"</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"year_established"</span>,         <span class="st">"Year the bank was established"</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"establishment_date"</span>,       <span class="st">"Date bank was established"</span>,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CLOSURE_DATE"</span>,             <span class="st">"Date of bank closure"</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"total_acres"</span>,              <span class="st">"Total acres of the bank"</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_status"</span>,              <span class="st">"Bank status"</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_status_DATE"</span>,         <span class="st">"Date bank status was changed"</span>,</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_type"</span>,                <span class="st">"Type of bank"</span>,</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WEBSITE"</span>,                  <span class="st">"Website of the bank"</span>,</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COMMENTS"</span>,                 <span class="st">"Any additional comments about the bank"</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RIBITS_URL_TO_BANK"</span>,       <span class="st">"URL to the bank in RIBITS"</span>,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ILF_PROGRAM_DATA_WS_URL"</span>,  <span class="st">"For ILF site, link to ILF program details"</span>,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>  <span class="st">"UMBRELLA_INSTRUMENT_DATA_WS_URL"</span>, <span class="st">"For umbrella banks, link to Umbrella Instrument details"</span>,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_GEOMETRY_OBSCURED"</span>,   <span class="st">"Flag for whether geometry is hidden (1 = obscured)"</span>,</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_LOCATION_CENTROID"</span>,   <span class="st">"Centroid (Lat/Long) of the bank location"</span>,</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_FOOTPRINT"</span>,           <span class="st">"Bank footprint (GeoJSON)"</span>,</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SERVICE_AREAS"</span>,            <span class="st">"Service areas for ILF sites"</span>,</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_SPONSORS"</span>,            <span class="st">"Entities responsible for the bank"</span>,</span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_POCS"</span>,                <span class="st">"Bank points of contact (owners/consultants)"</span>,</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_MANAGERS"</span>,            <span class="st">"Regulatory bank managers"</span>,</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_IRT_MEMBERS"</span>,         <span class="st">"Interagency Review Team members"</span>,</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_OTHER_CONTACTS"</span>,      <span class="st">"Other contacts for the bank"</span>,</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LEDGER"</span>,                   <span class="st">"Ledger of bank credits/debits"</span></span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a table</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>ribits_vars <span class="sc">%&gt;%</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a GT table</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add column labels</span></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">Variable =</span> <span class="st">"Variable"</span>,</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">Description =</span> <span class="st">"Description"</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply theme</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"**RIBITS Variables**"</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="pjkezrkkef" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#pjkezrkkef table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#pjkezrkkef thead, #pjkezrkkef tbody, #pjkezrkkef tfoot, #pjkezrkkef tr, #pjkezrkkef td, #pjkezrkkef th {
  border-style: none;
}

#pjkezrkkef p {
  margin: 0;
  padding: 0;
}

#pjkezrkkef .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#pjkezrkkef .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#pjkezrkkef .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#pjkezrkkef .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#pjkezrkkef .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pjkezrkkef .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pjkezrkkef .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#pjkezrkkef .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#pjkezrkkef .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#pjkezrkkef .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#pjkezrkkef .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#pjkezrkkef .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#pjkezrkkef .gt_spanner_row {
  border-bottom-style: hidden;
}

#pjkezrkkef .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#pjkezrkkef .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#pjkezrkkef .gt_from_md > :first-child {
  margin-top: 0;
}

#pjkezrkkef .gt_from_md > :last-child {
  margin-bottom: 0;
}

#pjkezrkkef .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#pjkezrkkef .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#pjkezrkkef .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#pjkezrkkef .gt_row_group_first td {
  border-top-width: 2px;
}

#pjkezrkkef .gt_row_group_first th {
  border-top-width: 2px;
}

#pjkezrkkef .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjkezrkkef .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#pjkezrkkef .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#pjkezrkkef .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pjkezrkkef .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjkezrkkef .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#pjkezrkkef .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#pjkezrkkef .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#pjkezrkkef .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#pjkezrkkef .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pjkezrkkef .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjkezrkkef .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#pjkezrkkef .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#pjkezrkkef .gt_left {
  text-align: left;
}

#pjkezrkkef .gt_center {
  text-align: center;
}

#pjkezrkkef .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#pjkezrkkef .gt_font_normal {
  font-weight: normal;
}

#pjkezrkkef .gt_font_bold {
  font-weight: bold;
}

#pjkezrkkef .gt_font_italic {
  font-style: italic;
}

#pjkezrkkef .gt_super {
  font-size: 65%;
}

#pjkezrkkef .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#pjkezrkkef .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#pjkezrkkef .gt_indent_1 {
  text-indent: 5px;
}

#pjkezrkkef .gt_indent_2 {
  text-indent: 10px;
}

#pjkezrkkef .gt_indent_3 {
  text-indent: 15px;
}

#pjkezrkkef .gt_indent_4 {
  text-indent: 20px;
}

#pjkezrkkef .gt_indent_5 {
  text-indent: 25px;
}

#pjkezrkkef .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#pjkezrkkef div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="2" class="gt_heading gt_title gt_font_normal gt_bottom_border"><strong>RIBITS Variables</strong></th>
</tr>
<tr class="gt_col_headings even">
<th id="Variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Variable</th>
<th id="Description" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Description</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">BANK_ID</td>
<td class="gt_row gt_left" headers="Description">Unique ID for the bank or ILF site</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">BANK_NAME</td>
<td class="gt_row gt_left gt_striped" headers="Description">Name of the bank</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">kind_of_bank</td>
<td class="gt_row gt_left" headers="Description">ILF, NRDA, Umbrella, or Standard</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">IS_404</td>
<td class="gt_row gt_left gt_striped" headers="Description">Yes or No (Section 404 applicability)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">IS_CONSERVATION</td>
<td class="gt_row gt_left" headers="Description">Yes or No (Conservation bank indicator)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">CHAIR</td>
<td class="gt_row gt_left gt_striped" headers="Description">Overseeing agency</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">district</td>
<td class="gt_row gt_left" headers="Description">Managing district the bank is in</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">SECONDARY_district_LIST</td>
<td class="gt_row gt_left gt_striped" headers="Description">Secondary districts the bank location is in</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">FIELD_OFFICE</td>
<td class="gt_row gt_left" headers="Description">Affiliated field office the bank is in</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">SECONDARY_OFFICE_LIST</td>
<td class="gt_row gt_left gt_striped" headers="Description">Secondary field offices the bank is in</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">NMFS_REGION</td>
<td class="gt_row gt_left" headers="Description">Affiliated NMFS region</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">SECONDARY_NOAA_REGION_LIST</td>
<td class="gt_row gt_left gt_striped" headers="Description">Secondary NMFS regions the bank is in</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">state_list</td>
<td class="gt_row gt_left" headers="Description">Comma-separated list of states</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">COUNTY_LIST</td>
<td class="gt_row gt_left gt_striped" headers="Description">Comma-separated list of counties</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">PERMIT_NUMBER</td>
<td class="gt_row gt_left" headers="Description">Comma-separated list of bank or site permits</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">year_established</td>
<td class="gt_row gt_left gt_striped" headers="Description">Year the bank was established</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">establishment_date</td>
<td class="gt_row gt_left" headers="Description">Date bank was established</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">CLOSURE_DATE</td>
<td class="gt_row gt_left gt_striped" headers="Description">Date of bank closure</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">total_acres</td>
<td class="gt_row gt_left" headers="Description">Total acres of the bank</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">bank_status</td>
<td class="gt_row gt_left gt_striped" headers="Description">Bank status</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">bank_status_DATE</td>
<td class="gt_row gt_left" headers="Description">Date bank status was changed</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">bank_type</td>
<td class="gt_row gt_left gt_striped" headers="Description">Type of bank</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">WEBSITE</td>
<td class="gt_row gt_left" headers="Description">Website of the bank</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">COMMENTS</td>
<td class="gt_row gt_left gt_striped" headers="Description">Any additional comments about the bank</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">RIBITS_URL_TO_BANK</td>
<td class="gt_row gt_left" headers="Description">URL to the bank in RIBITS</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">ILF_PROGRAM_DATA_WS_URL</td>
<td class="gt_row gt_left gt_striped" headers="Description">For ILF site, link to ILF program details</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">UMBRELLA_INSTRUMENT_DATA_WS_URL</td>
<td class="gt_row gt_left" headers="Description">For umbrella banks, link to Umbrella Instrument details</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">BANK_GEOMETRY_OBSCURED</td>
<td class="gt_row gt_left gt_striped" headers="Description">Flag for whether geometry is hidden (1 = obscured)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">BANK_LOCATION_CENTROID</td>
<td class="gt_row gt_left" headers="Description">Centroid (Lat/Long) of the bank location</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">BANK_FOOTPRINT</td>
<td class="gt_row gt_left gt_striped" headers="Description">Bank footprint (GeoJSON)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">SERVICE_AREAS</td>
<td class="gt_row gt_left" headers="Description">Service areas for ILF sites</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">BANK_SPONSORS</td>
<td class="gt_row gt_left gt_striped" headers="Description">Entities responsible for the bank</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">BANK_POCS</td>
<td class="gt_row gt_left" headers="Description">Bank points of contact (owners/consultants)</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">BANK_MANAGERS</td>
<td class="gt_row gt_left gt_striped" headers="Description">Regulatory bank managers</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">BANK_IRT_MEMBERS</td>
<td class="gt_row gt_left" headers="Description">Interagency Review Team members</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Variable">BANK_OTHER_CONTACTS</td>
<td class="gt_row gt_left gt_striped" headers="Description">Other contacts for the bank</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Variable">LEDGER</td>
<td class="gt_row gt_left" headers="Description">Ledger of bank credits/debits</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="data-quality" class="level2">
<h2 class="anchored" data-anchor-id="data-quality">Data Quality</h2>
<section id="missing-data" class="level3">
<h3 class="anchored" data-anchor-id="missing-data">Missing Data</h3>
<p>Lets get a feel for how many values have missing data. Below I summarize how many variables are missing row values.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze missing data patterns</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>missing_analysis <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First convert the True/False geometry columns to NA</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">CENTROID =</span> <span class="fu">na_if</span>(has_centroid, <span class="cn">FALSE</span>),</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">FOOTPRINT =</span> <span class="fu">na_if</span>(has_footprint, <span class="cn">FALSE</span>),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">SERVICE_AREA =</span> <span class="fu">na_if</span>(has_service_area, <span class="cn">FALSE</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unselect the original geom columns</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(has_centroid, has_footprint, has_service_area)) <span class="sc">%&gt;%</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now this summarise/across will work correctly</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.)))) <span class="sc">%&gt;%</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to long data </span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Field"</span>, <span class="at">values_to =</span> <span class="st">"Missing_Count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate as a proportion (0-1) so fmt_percent() works perfectly</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Missing_Proportion =</span> Missing_Count <span class="sc">/</span> <span class="fu">nrow</span>(data)) <span class="sc">%&gt;%</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Missing_Count <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Missing_Count))</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(missing_analysis) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the count for the subtitle</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  num_missing_vars <span class="ot">&lt;-</span> <span class="fu">nrow</span>(missing_analysis)</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display the detailed gt table</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    missing_analysis <span class="sc">%&gt;%</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>      <span class="co"># --- Data-specific formatting ---</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cols_label</span>(</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">Field =</span> <span class="st">"Field"</span>,</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">Missing_Count =</span> <span class="st">"Missing Count"</span>,</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">Missing_Proportion =</span> <span class="st">"Missing (%)"</span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Format the count with commas and no decimals</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fmt_number</span>(</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">columns =</span> Missing_Count,</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Format the proportion into a percentage</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fmt_percent</span>(</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">columns =</span> Missing_Proportion,</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        <span class="at">decimals =</span> <span class="dv">1</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>      <span class="co"># --- Apply your consistent theme ---</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">style_table</span>(</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"**Missing Data Overview**"</span>,</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"{num_missing_vars} field(s) have missing values."</span>)</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is fine, or you could use a gt-styled message</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"No missing data detected in the main dataset."</span>)</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="gtsbzjszhj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#gtsbzjszhj table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#gtsbzjszhj thead, #gtsbzjszhj tbody, #gtsbzjszhj tfoot, #gtsbzjszhj tr, #gtsbzjszhj td, #gtsbzjszhj th {
  border-style: none;
}

#gtsbzjszhj p {
  margin: 0;
  padding: 0;
}

#gtsbzjszhj .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gtsbzjszhj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#gtsbzjszhj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gtsbzjszhj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gtsbzjszhj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gtsbzjszhj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gtsbzjszhj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gtsbzjszhj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gtsbzjszhj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gtsbzjszhj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gtsbzjszhj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gtsbzjszhj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gtsbzjszhj .gt_spanner_row {
  border-bottom-style: hidden;
}

#gtsbzjszhj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#gtsbzjszhj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gtsbzjszhj .gt_from_md > :first-child {
  margin-top: 0;
}

#gtsbzjszhj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gtsbzjszhj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gtsbzjszhj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gtsbzjszhj .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gtsbzjszhj .gt_row_group_first td {
  border-top-width: 2px;
}

#gtsbzjszhj .gt_row_group_first th {
  border-top-width: 2px;
}

#gtsbzjszhj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gtsbzjszhj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gtsbzjszhj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gtsbzjszhj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gtsbzjszhj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gtsbzjszhj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gtsbzjszhj .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#gtsbzjszhj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gtsbzjszhj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gtsbzjszhj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gtsbzjszhj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gtsbzjszhj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gtsbzjszhj .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gtsbzjszhj .gt_left {
  text-align: left;
}

#gtsbzjszhj .gt_center {
  text-align: center;
}

#gtsbzjszhj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gtsbzjszhj .gt_font_normal {
  font-weight: normal;
}

#gtsbzjszhj .gt_font_bold {
  font-weight: bold;
}

#gtsbzjszhj .gt_font_italic {
  font-style: italic;
}

#gtsbzjszhj .gt_super {
  font-size: 65%;
}

#gtsbzjszhj .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#gtsbzjszhj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gtsbzjszhj .gt_indent_1 {
  text-indent: 5px;
}

#gtsbzjszhj .gt_indent_2 {
  text-indent: 10px;
}

#gtsbzjszhj .gt_indent_3 {
  text-indent: 15px;
}

#gtsbzjszhj .gt_indent_4 {
  text-indent: 20px;
}

#gtsbzjszhj .gt_indent_5 {
  text-indent: 25px;
}

#gtsbzjszhj .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#gtsbzjszhj div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="3" class="gt_heading gt_title gt_font_normal"><strong>Missing Data Overview</strong></th>
</tr>
<tr class="gt_heading even">
<th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">33 field(s) have missing values.</th>
</tr>
<tr class="gt_col_headings header">
<th id="Field" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Field</th>
<th id="Missing_Count" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Missing Count</th>
<th id="Missing_Proportion" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Missing (%)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Field">blm_permit_no</td>
<td class="gt_row gt_right" headers="Missing_Count">4,868</td>
<td class="gt_row gt_right" headers="Missing_Proportion">100.0%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">ilf_program_permit_no</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">4,868</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">100.0%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">next_inspection_date</td>
<td class="gt_row gt_right" headers="Missing_Count">4,868</td>
<td class="gt_row gt_right" headers="Missing_Proportion">100.0%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">amended_date</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">4,840</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">99.4%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">number_of_sub_ledger_transactions</td>
<td class="gt_row gt_right" headers="Missing_Count">4,779</td>
<td class="gt_row gt_right" headers="Missing_Proportion">98.2%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">bank_suspended_date</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">4,747</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">97.5%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">bank_terminated_date</td>
<td class="gt_row gt_right" headers="Missing_Count">4,667</td>
<td class="gt_row gt_right" headers="Missing_Proportion">95.9%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">last_inspection_date</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">4,540</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">93.3%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">umbrella_id</td>
<td class="gt_row gt_right" headers="Missing_Count">4,454</td>
<td class="gt_row gt_right" headers="Missing_Proportion">91.5%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">bank_pending_date</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">4,389</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">90.2%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">bank_withdrawn_date</td>
<td class="gt_row gt_right" headers="Missing_Count">4,327</td>
<td class="gt_row gt_right" headers="Missing_Proportion">88.9%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">bank_sold_out_date</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">4,005</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">82.3%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">initiation_feet</td>
<td class="gt_row gt_right" headers="Missing_Count">3,862</td>
<td class="gt_row gt_right" headers="Missing_Proportion">79.3%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">program_id</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">3,128</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">64.3%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">FOOTPRINT</td>
<td class="gt_row gt_right" headers="Missing_Count">2,320</td>
<td class="gt_row gt_right" headers="Missing_Proportion">47.7%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">initiation_acres</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">2,287</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">47.0%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">SERVICE_AREA</td>
<td class="gt_row gt_right" headers="Missing_Count">2,040</td>
<td class="gt_row gt_right" headers="Missing_Proportion">41.9%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">available_credits</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">1,820</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">37.4%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">number_of_ledger_transactions</td>
<td class="gt_row gt_right" headers="Missing_Count">1,820</td>
<td class="gt_row gt_right" headers="Missing_Proportion">37.4%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">recent_ledger_activity_date</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">1,820</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">37.4%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">initiation_credits</td>
<td class="gt_row gt_right" headers="Missing_Count">1,820</td>
<td class="gt_row gt_right" headers="Missing_Proportion">37.4%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">released_credits</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">1,820</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">37.4%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">withdrawn_credits</td>
<td class="gt_row gt_right" headers="Missing_Count">1,820</td>
<td class="gt_row gt_right" headers="Missing_Proportion">37.4%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">total_pot_credits_from_details</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">1,820</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">37.4%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">total_pot_credit_types</td>
<td class="gt_row gt_right" headers="Missing_Count">1,820</td>
<td class="gt_row gt_right" headers="Missing_Proportion">37.4%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">year_established</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">1,677</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">34.4%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">establishment_date</td>
<td class="gt_row gt_right" headers="Missing_Count">1,677</td>
<td class="gt_row gt_right" headers="Missing_Proportion">34.4%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">bank_approved_date</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">1,344</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">27.6%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">permit_number</td>
<td class="gt_row gt_right" headers="Missing_Count">934</td>
<td class="gt_row gt_right" headers="Missing_Proportion">19.2%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">total_acres</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">881</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">18.1%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">bank_status_date</td>
<td class="gt_row gt_right" headers="Missing_Count">517</td>
<td class="gt_row gt_right" headers="Missing_Proportion">10.6%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">current_status_date</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Count">517</td>
<td class="gt_row gt_right gt_striped" headers="Missing_Proportion">10.6%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">other_permit_no</td>
<td class="gt_row gt_right" headers="Missing_Count">16</td>
<td class="gt_row gt_right" headers="Missing_Proportion">0.3%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Many of the columns arent super important (secondary office list, secondary district list, website/URL fields). However, there are a few we should note that have significant amounts of missing data:</p>
<ul>
<li>Footprint</li>
<li>Service Area</li>
<li>Total Acres</li>
</ul>
<p>These three fields might come in useful later for calculating total area offset or other metrics of interest. Lets now dive specifically into the spatial data quality.</p>
</section>
<section id="spatial-data-quality" class="level3">
<h3 class="anchored" data-anchor-id="spatial-data-quality">Spatial Data Quality</h3>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Build flags to see what data exists</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>spat_flags <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only choose banks in dataset</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(bank_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create new dataframe with specified columns</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    bank_id,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_centroid      =</span> has_centroid,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_footprint     =</span> has_footprint,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_service_area  =</span> has_service_area,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_total_acres   =</span> <span class="sc">!</span><span class="fu">is.na</span>(total_acres), <span class="co"># Already a TRUE/FALSE flag</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Counter for the number of total banks</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>n_banks <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(spat_flags<span class="sc">$</span>bank_id)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co"># overall coverage</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>overall_cov <span class="ot">&lt;-</span> spat_flags <span class="sc">%&gt;%</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarise all the TRUE/FALSE columns.</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sum(column, na.rm = TRUE) counts all the TRUEs.</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Has centroid</span><span class="st">`</span>      <span class="ot">=</span> <span class="fu">sum</span>(has_centroid,     <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Has footprint</span><span class="st">`</span>     <span class="ot">=</span> <span class="fu">sum</span>(has_footprint,    <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Has service area</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">sum</span>(has_service_area, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Has total acres</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">sum</span>(has_total_acres,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Field"</span>, <span class="at">values_to =</span> <span class="st">"Count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">Proportion =</span> Count <span class="sc">/</span> n_banks <span class="co"># Calculate 0-1 proportion for gt</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Print this using a gt table</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  overall_cov <span class="sc">%&gt;%</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">Field =</span> <span class="st">"Flag"</span>,</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">Count =</span> <span class="st">"Count"</span>,</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">Proportion =</span> <span class="st">"Percent"</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_percent</span>(</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> Proportion,</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">decimals =</span> <span class="dv">1</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> Count,</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply your consistent theme</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"**Spatial Data Coverage**"</span>,</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Based on {n_banks} banks"</span>)</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="jehecthdnt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#jehecthdnt table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#jehecthdnt thead, #jehecthdnt tbody, #jehecthdnt tfoot, #jehecthdnt tr, #jehecthdnt td, #jehecthdnt th {
  border-style: none;
}

#jehecthdnt p {
  margin: 0;
  padding: 0;
}

#jehecthdnt .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#jehecthdnt .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#jehecthdnt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#jehecthdnt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#jehecthdnt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jehecthdnt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jehecthdnt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#jehecthdnt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#jehecthdnt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#jehecthdnt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#jehecthdnt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#jehecthdnt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#jehecthdnt .gt_spanner_row {
  border-bottom-style: hidden;
}

#jehecthdnt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#jehecthdnt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#jehecthdnt .gt_from_md > :first-child {
  margin-top: 0;
}

#jehecthdnt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#jehecthdnt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#jehecthdnt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#jehecthdnt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#jehecthdnt .gt_row_group_first td {
  border-top-width: 2px;
}

#jehecthdnt .gt_row_group_first th {
  border-top-width: 2px;
}

#jehecthdnt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jehecthdnt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#jehecthdnt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#jehecthdnt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jehecthdnt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#jehecthdnt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#jehecthdnt .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#jehecthdnt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#jehecthdnt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#jehecthdnt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jehecthdnt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jehecthdnt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#jehecthdnt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#jehecthdnt .gt_left {
  text-align: left;
}

#jehecthdnt .gt_center {
  text-align: center;
}

#jehecthdnt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#jehecthdnt .gt_font_normal {
  font-weight: normal;
}

#jehecthdnt .gt_font_bold {
  font-weight: bold;
}

#jehecthdnt .gt_font_italic {
  font-style: italic;
}

#jehecthdnt .gt_super {
  font-size: 65%;
}

#jehecthdnt .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#jehecthdnt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#jehecthdnt .gt_indent_1 {
  text-indent: 5px;
}

#jehecthdnt .gt_indent_2 {
  text-indent: 10px;
}

#jehecthdnt .gt_indent_3 {
  text-indent: 15px;
}

#jehecthdnt .gt_indent_4 {
  text-indent: 20px;
}

#jehecthdnt .gt_indent_5 {
  text-indent: 25px;
}

#jehecthdnt .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#jehecthdnt div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="3" class="gt_heading gt_title gt_font_normal"><strong>Spatial Data Coverage</strong></th>
</tr>
<tr class="gt_heading even">
<th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Based on 4868 banks</th>
</tr>
<tr class="gt_col_headings header">
<th id="Field" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Flag</th>
<th id="Count" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Count</th>
<th id="Proportion" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Percent</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="Field">Has centroid</td>
<td class="gt_row gt_right" headers="Count">4,868</td>
<td class="gt_row gt_right" headers="Proportion">100.0%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">Has footprint</td>
<td class="gt_row gt_right gt_striped" headers="Count">2,548</td>
<td class="gt_row gt_right gt_striped" headers="Proportion">52.3%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="Field">Has service area</td>
<td class="gt_row gt_right" headers="Count">2,828</td>
<td class="gt_row gt_right" headers="Proportion">58.1%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="Field">Has total acres</td>
<td class="gt_row gt_right gt_striped" headers="Count">3,987</td>
<td class="gt_row gt_right gt_striped" headers="Proportion">81.9%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="footprint-and-total-acres-coverage" class="level3">
<h3 class="anchored" data-anchor-id="footprint-and-total-acres-coverage">Footprint and Total Acres Coverage</h3>
<p>For future analyses, we might also want to know the total area made up by the banks. We can calculate this either using the total_acres column, or by extracting the area from the bank footprint polygon. Lets check what banks have areal information (either the footprint, the total acreage, both, or none).</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the table dataframe </span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>footprint_acres <span class="ot">&lt;-</span> spat_flags <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to yes/no</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_footprint =</span> <span class="fu">ifelse</span>(has_footprint, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_acres     =</span> <span class="fu">ifelse</span>(has_total_acres, <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count the number of banks that have footprint / total acres</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(has_footprint, has_acres, <span class="at">name =</span> <span class="st">"Banks"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to a percentage </span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Share =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> Banks <span class="sc">/</span> <span class="fu">sum</span>(Banks), <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Banks))</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a GT table</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>footprint_acres <span class="sc">%&gt;%</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">has_footprint =</span> <span class="st">"Has footprint"</span>,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">has_acres     =</span> <span class="st">"Has total acres"</span>,</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">Share         =</span> <span class="st">"Share (%)"</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    )  <span class="sc">%&gt;%</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">title    =</span> <span class="st">"**Data Availability: Footprint  Total Acres**"</span>,</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {n_banks} banks"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="squgtxpayo" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#squgtxpayo table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#squgtxpayo thead, #squgtxpayo tbody, #squgtxpayo tfoot, #squgtxpayo tr, #squgtxpayo td, #squgtxpayo th {
  border-style: none;
}

#squgtxpayo p {
  margin: 0;
  padding: 0;
}

#squgtxpayo .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#squgtxpayo .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#squgtxpayo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#squgtxpayo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#squgtxpayo .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#squgtxpayo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#squgtxpayo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#squgtxpayo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#squgtxpayo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#squgtxpayo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#squgtxpayo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#squgtxpayo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#squgtxpayo .gt_spanner_row {
  border-bottom-style: hidden;
}

#squgtxpayo .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#squgtxpayo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#squgtxpayo .gt_from_md > :first-child {
  margin-top: 0;
}

#squgtxpayo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#squgtxpayo .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#squgtxpayo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#squgtxpayo .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#squgtxpayo .gt_row_group_first td {
  border-top-width: 2px;
}

#squgtxpayo .gt_row_group_first th {
  border-top-width: 2px;
}

#squgtxpayo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#squgtxpayo .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#squgtxpayo .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#squgtxpayo .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#squgtxpayo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#squgtxpayo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#squgtxpayo .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#squgtxpayo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#squgtxpayo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#squgtxpayo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#squgtxpayo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#squgtxpayo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#squgtxpayo .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#squgtxpayo .gt_left {
  text-align: left;
}

#squgtxpayo .gt_center {
  text-align: center;
}

#squgtxpayo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#squgtxpayo .gt_font_normal {
  font-weight: normal;
}

#squgtxpayo .gt_font_bold {
  font-weight: bold;
}

#squgtxpayo .gt_font_italic {
  font-style: italic;
}

#squgtxpayo .gt_super {
  font-size: 65%;
}

#squgtxpayo .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#squgtxpayo .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#squgtxpayo .gt_indent_1 {
  text-indent: 5px;
}

#squgtxpayo .gt_indent_2 {
  text-indent: 10px;
}

#squgtxpayo .gt_indent_3 {
  text-indent: 15px;
}

#squgtxpayo .gt_indent_4 {
  text-indent: 20px;
}

#squgtxpayo .gt_indent_5 {
  text-indent: 25px;
}

#squgtxpayo .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#squgtxpayo div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="4" class="gt_heading gt_title gt_font_normal"><strong>Data Availability: Footprint  Total Acres</strong></th>
</tr>
<tr class="gt_heading even">
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Across 4868 banks</th>
</tr>
<tr class="gt_col_headings header">
<th id="has_footprint" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Has footprint</th>
<th id="has_acres" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Has total acres</th>
<th id="Banks" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Banks</th>
<th id="Share" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Share (%)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="has_footprint">Yes</td>
<td class="gt_row gt_left" headers="has_acres">Yes</td>
<td class="gt_row gt_right" headers="Banks">2222</td>
<td class="gt_row gt_right" headers="Share">45.6</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="has_footprint">No</td>
<td class="gt_row gt_left gt_striped" headers="has_acres">Yes</td>
<td class="gt_row gt_right gt_striped" headers="Banks">1765</td>
<td class="gt_row gt_right gt_striped" headers="Share">36.3</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="has_footprint">No</td>
<td class="gt_row gt_left" headers="has_acres">No</td>
<td class="gt_row gt_right" headers="Banks">555</td>
<td class="gt_row gt_right" headers="Share">11.4</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="has_footprint">Yes</td>
<td class="gt_row gt_left gt_striped" headers="has_acres">No</td>
<td class="gt_row gt_right gt_striped" headers="Banks">326</td>
<td class="gt_row gt_right gt_striped" headers="Share">6.7</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>There is fairly complete information on spatial area - only 572 banks (11.6%) have no footprint or total acreage information.</p>
</section>
<section id="footprint-and-total-acres-alignment" class="level3">
<h3 class="anchored" data-anchor-id="footprint-and-total-acres-alignment">Footprint and Total Acres Alignment</h3>
<p>A quick inspection of the data seems like there might be discrepancies between the area calculated from the <code>BANK_FOOTPRINT</code> geometry against the <code>total_acres</code> value reported in the data. To compare, we first need to ensure the area is calculated correctly. Geometries are often stored in a geographic CRS (like WGS84, EPSG:4326), where units are in degrees. To get an accurate area in meters, we must first transform the data into a projected, equal-area CRS. For the continental U.S., the Albers Equal Area projection (EPSG:5070) is a standard choice.</p>
<p>Below, I transform the spatial data, convert area into square meters, convert square meters into acres, and then compare the values of total acres listed to the calculated total acres.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Prepare the data for area calculation</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The CRS is missing and the dataframe is not a true sf object. We need to explicitly create an sf object from the footprint data and set its CRS before transforming. WGS84 (EPSG:4326) is a safe assumption for GeoJSON data.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the original and target CRS</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>initial_crs <span class="ot">&lt;-</span> <span class="dv">4326</span> <span class="co"># WGS84</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>target_crs <span class="ot">&lt;-</span> <span class="dv">5070</span>  <span class="co"># Albers Equal Area for US</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a valid sf object from the footprint data</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>footprints_sf <span class="ot">&lt;-</span> banks_geometries <span class="sc">%&gt;%</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep only banks with a footprint geometry</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">sapply</span>(footprint, <span class="cf">function</span>(x) <span class="fu">is.null</span>(x) <span class="sc">||</span> <span class="fu">st_is_empty</span>(x))) <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to a proper sf object, specifying the geometry column</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">sf_column_name =</span> <span class="st">"footprint"</span>, <span class="at">crs =</span> initial_crs)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Calculate area</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>footprint_areas <span class="ot">&lt;-</span> footprints_sf <span class="sc">%&gt;%</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transform to an equal-area projection</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> target_crs) <span class="sc">%&gt;%</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate area in square meters, then convert to acres</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">calculated_acres =</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(footprint)) <span class="sc">/</span> <span class="fl">4046.86</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We only need the ID and the calculated area</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id, calculated_acres)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Join calculated area with reported acres</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>comparison_df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We only need total_acres for comparison</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id, total_acres) <span class="sc">%&gt;%</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Join the calculated areas</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(footprint_areas, <span class="at">by =</span> <span class="st">"bank_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter out cases with no reported acres</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_acres) <span class="sc">&amp;</span> total_acres <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the discrepancy ratio</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">discrepancy_ratio =</span> calculated_acres <span class="sc">/</span> total_acres</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Visualize the comparison</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co"># A scatter plot is ideal for this. A 1:1 line shows where perfect agreement lies.</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison_df, <span class="fu">aes</span>(<span class="at">x =</span> total_acres, <span class="at">y =</span> calculated_acres)) <span class="sc">+</span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a 1:1 line for perfect agreement</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use a log scale to handle the wide range of values</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Footprint Area vs. Reported Acres"</span>,</span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {nrow(comparison_df)} banks"</span>),</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Reported Total Acres (log scale)"</span>,</span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Calculated Footprint Acres (log scale)"</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title    =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="co"># Ensures the 1:1 line is visually accurate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ribits_merged_data_quality_assessment_files/figure-html/footprint-acres-alignment-plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>There are 2548 banks with footprint information, and 2217 banks with both reported acres and a valid footprint to compare.</p>
<p>The plot above generally shows a correlation between the reported <code>total_acres</code> and the area calculated from the footprint geometries. I would not call this a great plot though - there is a lot of dispersion around the line, and in theory, the reported acreage and the calculated acreage should be exactly the same. However, we are seeing:</p>
<ul>
<li><strong>Under-reported Area</strong>: Points below the line, where the calculated footprint area is <em>smaller</em> than the reported total acres. This could be because <code>total_acres</code> refers to the entire property parcel, while the footprint only covers the actual mitigation area.</li>
<li><strong>Over-reported Area</strong>: Points above the line, where the calculated footprint is significantly <em>larger</em> than the reported acreage. These are a bit more more concerning, as it signals data entry errors in <code>total_acres</code> or an incorrect footprint geometry.</li>
<li><strong>Outliers</strong>: A few points are far from the line, representing significant discrepancies. These are likely service area polygons that were misattributed to the footprint column in RIBITS.</li>
</ul>
<p>Lets check how many banks actually fall significantly outside of the line. Here, I plot the data as a histogram, with the 1:1 ratio line in black, with grey lines at 0.5 and 2 to indicate an acceptable margin of error (i.e.&nbsp;banks with reported areas either half as small or twice as large as the calculated area). We may want to think about what is an acceptable margin of error for further analyses.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of the Discrepancy Ratio</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>discrepancy_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparison_df, <span class="fu">aes</span>(<span class="at">x =</span> discrepancy_ratio)) <span class="sc">+</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="at">fill =</span> <span class="st">"dodgerblue"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use a log10 scale to see the distribution of extreme outliers</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add vertical lines at key thresholds for context</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">1.0</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">2.0</span>), <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Discrepancy Ratios"</span>,</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {nrow(comparison_df)} banks"</span>),</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Discrepancy Ratio (Geometric Area / Listed Area) - Log Scale"</span>,</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title    =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>discrepancy_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ribits_merged_data_quality_assessment_files/figure-html/discrepancy-ratio-histogram-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>We see a large peak near 1.0, which is good. But we also see fairly long tails to both the right and left, as well as a decent amount of banks just outside the margin of error. Lets check the top 20 worst (i.e., most misaligned) banks.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create table of top 20 banks with greatest discrepancy</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>top_discrepancies <span class="ot">&lt;-</span> comparison_df <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a column for absolute distance from a perfect ratio of 1</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">abs_log_ratio =</span> <span class="fu">abs</span>(<span class="fu">log10</span>(discrepancy_ratio))) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(abs_log_ratio)) <span class="sc">%&gt;%</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the table </span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  top_discrepancies <span class="sc">%&gt;%</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">bank_id       =</span> <span class="st">"Bank ID"</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_acres   =</span> <span class="st">"Listed Total Acres"</span>,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">calculated_acres =</span> <span class="st">"Calculated Total Acres"</span>,</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">discrepancy_ratio  =</span> <span class="st">"Discrepancy Ratio"</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    )  <span class="sc">%&gt;%</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">title    =</span> <span class="st">"**Top 20 Highest Area/Footprint Discrepancies**"</span>,</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {nrow(comparison_df)} banks"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="nspnqlmboj" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#nspnqlmboj table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#nspnqlmboj thead, #nspnqlmboj tbody, #nspnqlmboj tfoot, #nspnqlmboj tr, #nspnqlmboj td, #nspnqlmboj th {
  border-style: none;
}

#nspnqlmboj p {
  margin: 0;
  padding: 0;
}

#nspnqlmboj .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#nspnqlmboj .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#nspnqlmboj .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#nspnqlmboj .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#nspnqlmboj .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nspnqlmboj .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nspnqlmboj .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#nspnqlmboj .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#nspnqlmboj .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#nspnqlmboj .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#nspnqlmboj .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#nspnqlmboj .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#nspnqlmboj .gt_spanner_row {
  border-bottom-style: hidden;
}

#nspnqlmboj .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#nspnqlmboj .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#nspnqlmboj .gt_from_md > :first-child {
  margin-top: 0;
}

#nspnqlmboj .gt_from_md > :last-child {
  margin-bottom: 0;
}

#nspnqlmboj .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#nspnqlmboj .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#nspnqlmboj .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#nspnqlmboj .gt_row_group_first td {
  border-top-width: 2px;
}

#nspnqlmboj .gt_row_group_first th {
  border-top-width: 2px;
}

#nspnqlmboj .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nspnqlmboj .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#nspnqlmboj .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#nspnqlmboj .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nspnqlmboj .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#nspnqlmboj .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#nspnqlmboj .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#nspnqlmboj .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#nspnqlmboj .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#nspnqlmboj .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nspnqlmboj .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nspnqlmboj .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#nspnqlmboj .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#nspnqlmboj .gt_left {
  text-align: left;
}

#nspnqlmboj .gt_center {
  text-align: center;
}

#nspnqlmboj .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#nspnqlmboj .gt_font_normal {
  font-weight: normal;
}

#nspnqlmboj .gt_font_bold {
  font-weight: bold;
}

#nspnqlmboj .gt_font_italic {
  font-style: italic;
}

#nspnqlmboj .gt_super {
  font-size: 65%;
}

#nspnqlmboj .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#nspnqlmboj .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#nspnqlmboj .gt_indent_1 {
  text-indent: 5px;
}

#nspnqlmboj .gt_indent_2 {
  text-indent: 10px;
}

#nspnqlmboj .gt_indent_3 {
  text-indent: 15px;
}

#nspnqlmboj .gt_indent_4 {
  text-indent: 20px;
}

#nspnqlmboj .gt_indent_5 {
  text-indent: 25px;
}

#nspnqlmboj .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#nspnqlmboj div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="5" class="gt_heading gt_title gt_font_normal"><strong>Top 20 Highest Area/Footprint Discrepancies</strong></th>
</tr>
<tr class="gt_heading even">
<th colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Across 2217 banks</th>
</tr>
<tr class="gt_col_headings header">
<th id="bank_id" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Bank ID</th>
<th id="total_acres" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Listed Total Acres</th>
<th id="calculated_acres" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Calculated Total Acres</th>
<th id="discrepancy_ratio" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Discrepancy Ratio</th>
<th id="abs_log_ratio" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">abs_log_ratio</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="bank_id">5339</td>
<td class="gt_row gt_right" headers="total_acres">13.00</td>
<td class="gt_row gt_right" headers="calculated_acres">5464421.7</td>
<td class="gt_row gt_right" headers="discrepancy_ratio">420340.134</td>
<td class="gt_row gt_right" headers="abs_log_ratio">5.623601</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="bank_id">5948</td>
<td class="gt_row gt_right gt_striped" headers="total_acres">13.90</td>
<td class="gt_row gt_right gt_striped" headers="calculated_acres">5464421.7</td>
<td class="gt_row gt_right gt_striped" headers="discrepancy_ratio">393123.866</td>
<td class="gt_row gt_right gt_striped" headers="abs_log_ratio">5.594529</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="bank_id">3447</td>
<td class="gt_row gt_right" headers="total_acres">42.03</td>
<td class="gt_row gt_right" headers="calculated_acres">9453326.3</td>
<td class="gt_row gt_right" headers="discrepancy_ratio">224918.542</td>
<td class="gt_row gt_right" headers="abs_log_ratio">5.352025</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="bank_id">6418</td>
<td class="gt_row gt_right gt_striped" headers="total_acres">2.00</td>
<td class="gt_row gt_right gt_striped" headers="calculated_acres">297434.6</td>
<td class="gt_row gt_right gt_striped" headers="discrepancy_ratio">148717.292</td>
<td class="gt_row gt_right gt_striped" headers="abs_log_ratio">5.172361</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="bank_id">2480</td>
<td class="gt_row gt_right" headers="total_acres">65.50</td>
<td class="gt_row gt_right" headers="calculated_acres">9583683.6</td>
<td class="gt_row gt_right" headers="discrepancy_ratio">146315.781</td>
<td class="gt_row gt_right" headers="abs_log_ratio">5.165291</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="bank_id">6053</td>
<td class="gt_row gt_right gt_striped" headers="total_acres">45.00</td>
<td class="gt_row gt_right gt_striped" headers="calculated_acres">6104023.5</td>
<td class="gt_row gt_right gt_striped" headers="discrepancy_ratio">135644.967</td>
<td class="gt_row gt_right gt_striped" headers="abs_log_ratio">5.132404</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="bank_id">7171</td>
<td class="gt_row gt_right" headers="total_acres">12.00</td>
<td class="gt_row gt_right" headers="calculated_acres">955643.2</td>
<td class="gt_row gt_right" headers="discrepancy_ratio">79636.930</td>
<td class="gt_row gt_right" headers="abs_log_ratio">4.901115</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="bank_id">7231</td>
<td class="gt_row gt_right gt_striped" headers="total_acres">13.50</td>
<td class="gt_row gt_right gt_striped" headers="calculated_acres">928078.4</td>
<td class="gt_row gt_right gt_striped" headers="discrepancy_ratio">68746.547</td>
<td class="gt_row gt_right gt_striped" headers="abs_log_ratio">4.837251</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="bank_id">4568</td>
<td class="gt_row gt_right" headers="total_acres">115.60</td>
<td class="gt_row gt_right" headers="calculated_acres">5682772.5</td>
<td class="gt_row gt_right" headers="discrepancy_ratio">49158.931</td>
<td class="gt_row gt_right" headers="abs_log_ratio">4.691602</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="bank_id">5744</td>
<td class="gt_row gt_right gt_striped" headers="total_acres">124.20</td>
<td class="gt_row gt_right gt_striped" headers="calculated_acres">4172470.4</td>
<td class="gt_row gt_right gt_striped" headers="discrepancy_ratio">33594.770</td>
<td class="gt_row gt_right gt_striped" headers="abs_log_ratio">4.526272</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="bank_id">4320</td>
<td class="gt_row gt_right" headers="total_acres">155.00</td>
<td class="gt_row gt_right" headers="calculated_acres">4501649.5</td>
<td class="gt_row gt_right" headers="discrepancy_ratio">29042.900</td>
<td class="gt_row gt_right" headers="abs_log_ratio">4.463040</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="bank_id">6974</td>
<td class="gt_row gt_right gt_striped" headers="total_acres">50.61</td>
<td class="gt_row gt_right gt_striped" headers="calculated_acres">1202841.6</td>
<td class="gt_row gt_right gt_striped" headers="discrepancy_ratio">23766.877</td>
<td class="gt_row gt_right gt_striped" headers="abs_log_ratio">4.375972</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="bank_id">7232</td>
<td class="gt_row gt_right" headers="total_acres">74.00</td>
<td class="gt_row gt_right" headers="calculated_acres">1539964.2</td>
<td class="gt_row gt_right" headers="discrepancy_ratio">20810.327</td>
<td class="gt_row gt_right" headers="abs_log_ratio">4.318279</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="bank_id">2870</td>
<td class="gt_row gt_right gt_striped" headers="total_acres">77.00</td>
<td class="gt_row gt_right gt_striped" headers="calculated_acres">1587677.1</td>
<td class="gt_row gt_right gt_striped" headers="discrepancy_ratio">20619.183</td>
<td class="gt_row gt_right gt_striped" headers="abs_log_ratio">4.314271</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="bank_id">7233</td>
<td class="gt_row gt_right" headers="total_acres">82.00</td>
<td class="gt_row gt_right" headers="calculated_acres">1539964.2</td>
<td class="gt_row gt_right" headers="discrepancy_ratio">18780.051</td>
<td class="gt_row gt_right" headers="abs_log_ratio">4.273697</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="bank_id">1126</td>
<td class="gt_row gt_right gt_striped" headers="total_acres">55.86</td>
<td class="gt_row gt_right gt_striped" headers="calculated_acres">793088.6</td>
<td class="gt_row gt_right gt_striped" headers="discrepancy_ratio">14197.791</td>
<td class="gt_row gt_right gt_striped" headers="abs_log_ratio">4.152221</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="bank_id">5774</td>
<td class="gt_row gt_right" headers="total_acres">100.00</td>
<td class="gt_row gt_right" headers="calculated_acres">907087.8</td>
<td class="gt_row gt_right" headers="discrepancy_ratio">9070.878</td>
<td class="gt_row gt_right" headers="abs_log_ratio">3.957649</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="bank_id">5060</td>
<td class="gt_row gt_right gt_striped" headers="total_acres">276.73</td>
<td class="gt_row gt_right gt_striped" headers="calculated_acres">1700367.4</td>
<td class="gt_row gt_right gt_striped" headers="discrepancy_ratio">6144.500</td>
<td class="gt_row gt_right gt_striped" headers="abs_log_ratio">3.788487</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="bank_id">3284</td>
<td class="gt_row gt_right" headers="total_acres">652.00</td>
<td class="gt_row gt_right" headers="calculated_acres">3108396.1</td>
<td class="gt_row gt_right" headers="discrepancy_ratio">4767.479</td>
<td class="gt_row gt_right" headers="abs_log_ratio">3.678289</td>
</tr>
<tr class="even">
<td class="gt_row gt_right gt_striped" headers="bank_id">6167</td>
<td class="gt_row gt_right gt_striped" headers="total_acres">150.30</td>
<td class="gt_row gt_right gt_striped" headers="calculated_acres">451578.3</td>
<td class="gt_row gt_right gt_striped" headers="discrepancy_ratio">3004.513</td>
<td class="gt_row gt_right gt_striped" headers="abs_log_ratio">3.477774</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Clearly these are incorrect and likely just service area polygons listed as footprints. However, all of this makes it a bit difficult to trust the RIBITS data - many calculated area values are either higher or lower than the reported values, so knowing which is the true value is unclear. For any analyses, we may want to:</p>
<ul>
<li>Define our margin of error (how big/small can the area discrepancy ratio be)</li>
<li>Remove all banks that fall outside of that margin of error</li>
<li>Then calculate downstream stats</li>
</ul>
<p>If we dont, we may run the risk of over-inflating any area counts.</p>
</section>
</section>
<section id="bank-characteristics" class="level2">
<h2 class="anchored" data-anchor-id="bank-characteristics">Bank Characteristics</h2>
<p>Lets now move on to exploring the variables in the RIBITS extract.</p>
<section id="spatial-distribution" class="level3">
<h3 class="anchored" data-anchor-id="spatial-distribution">Spatial Distribution</h3>
<p>Lets see where the banks are, and how their spatial distribution varies by state and district. First, I will plot the centroids on a map of the U.S.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the centroid data for plotting</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We need a clean sf object with a valid CRS.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a valid sf object from the centroid data</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>centroids_sf <span class="ot">&lt;-</span> banks_geometries <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep only banks with a centroid geometry</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">sapply</span>(centroid, <span class="cf">function</span>(x) <span class="fu">is.null</span>(x) <span class="sc">||</span> <span class="fu">st_is_empty</span>(x))) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to a proper sf object</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">sf_column_name =</span> <span class="st">"centroid"</span>, <span class="at">crs =</span> <span class="dv">4326</span>) <span class="co"># Assume WGS84</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Prepared"</span>, <span class="fu">nrow</span>(centroids_sf), <span class="st">"centroids for plotting.</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Prepared 4868 centroids for plotting.</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Get base map data using rnaturalearth to get country and state boundaries.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">ne_states</span>(<span class="at">country =</span> <span class="st">"United States of America"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create the map</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a base layer for the world, filled with a light grey</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world, <span class="at">fill =</span> <span class="st">"gray90"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add US state boundaries</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> states, <span class="at">fill =</span> <span class="st">"gray80"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the bank centroids on top</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> centroids_sf,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.5</span>,</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.4</span>,</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">16</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set the coordinate system and limits.</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This zooms the map to show the continental US, Alaska, Hawaii, and the Caribbean.</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="sc">-</span><span class="dv">65</span>),</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">72</span>),</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="cn">FALSE</span>,</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">4326</span> <span class="co"># Use WGS84 projection</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"National Distribution of Sites"</span>,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Each red dot represents one bank centroid."</span></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use a minimal theme suitable for maps</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"aliceblue"</span>),</span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ribits_merged_data_quality_assessment_files/figure-html/bank-national-distribution-map-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>Distribution of RIBITS bank centroids across the United States.</figcaption>
</figure>
</div>
</div>
</div>
<p>We have a pretty wide geographic distribution of banks, with significant clusters in the eastern and southeastern U.S., the northern midwest (Minnesota), California, the Pacific Northwest, and along the Gulf Coast. Theres also coverage in Alaska, and Puerto Rico, interestingly enough. I will now quickly plot the distribution in the conterminous U.S. (lower 48):</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a base layer for the world</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world, <span class="at">fill =</span> <span class="st">"gray90"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add US state boundaries</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> states, <span class="at">fill =</span> <span class="st">"gray80"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the bank centroids on top</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> centroids_sf,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.5</span>,</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.4</span>,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">16</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set the coordinate system and limits.</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># These new coordinates zoom to the conterminous (lower 48) US.</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>, <span class="sc">-</span><span class="fl">66.5</span>),  <span class="co"># From Washington coast to Maine coast</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">24</span>, <span class="dv">50</span>),     <span class="co"># From Florida keys to Canadian border</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="cn">FALSE</span>,</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">4326</span> <span class="co"># Use WGS84 projection</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- UPDATED TITLE ---</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Sites (Conterminous US)"</span>,</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Each red dot represents one bank centroid."</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use a minimal theme suitable for maps</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"aliceblue"</span>),</span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ribits_merged_data_quality_assessment_files/figure-html/map-conterminous-us-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>Lets break the geographic distribution down by state:</p>
<p>There are 4868 unique banks represented across 47 states. 0 banks (0%) have no recorded state information. Banks are present in 47 states (plus PR). No banks are present in the following 4 states: HI, MI, NM, RI. The top 15 states by number of banks:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar chart of the top 15 states</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>state_counts <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(n_banks, <span class="at">n =</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(token, n_banks), <span class="at">y =</span> n_banks)) <span class="sc">+</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"seagreen2"</span>) <span class="sc">+</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_banks),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>,             <span class="co"># push text a little outside the bar</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>             <span class="co"># control text size</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Number of Banks by State (Top 15)"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"State"</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">max</span>(state_counts<span class="sc">$</span>n_banks, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">1.1</span>)  <span class="co"># add space for labels</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ribits_merged_data_quality_assessment_files/figure-html/geo-spread-bar-chart-states-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>We can also break it down by USACE District, which is responsible for overseeing the management and reporting on banking.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the counts for USACE Districts</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the new count column to 'n_banks'</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>district_counts <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(district)) <span class="sc">%&gt;%</span>            <span class="co"># Remove any NA district entries</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(district, <span class="at">name =</span> <span class="st">"n_banks"</span>) <span class="sc">%&gt;%</span>   <span class="co"># Count banks per district</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_banks))                <span class="co"># Sort from largest to smallest</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar chart of the top 15 districts</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  district_counts <span class="sc">%&gt;%</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_max</span>(n_banks, <span class="at">n =</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(district, n_banks), <span class="at">y =</span> n_banks)) <span class="sc">+</span> <span class="co"># Swapped 'token' for 'district'</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"dodgerblue3"</span>) <span class="sc">+</span>  <span class="co"># Changed color</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_banks),</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>,       <span class="co"># push text a little outside the bar</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>         <span class="co"># (I made the size a bit smaller)</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Number of Banks by USACE District (Top 15)"</span>, <span class="co"># Updated title</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"USACE District"</span>,                     <span class="co"># Updated x-axis</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make sure to use the new district_counts for the limit</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">max</span>(district_counts<span class="sc">$</span>n_banks, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">1.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ribits_merged_data_quality_assessment_files/figure-html/plot-district-counts-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="kinds-of-banks" class="level3">
<h3 class="anchored" data-anchor-id="kinds-of-banks">Kinds of Banks</h3>
<p>There are several <strong>Kinds of banks (<code>kind_of_bank</code>):</strong> represented in the dataset:</p>
<ul>
<li><strong>ILF (In-Lieu Fee program):</strong> Permittee pays a fee; the ILF sponsor later uses those funds to restore or establish wetlands/streams.</li>
<li><strong>NRDA (Natural Resource Damage Assessment):</strong> Bank created to offset environmental damages (e.g., oil spills, hazardous releases).</li>
<li><strong>Umbrella Bank:</strong> A single umbrella instrument covering multiple sites under one sponsor/permit.</li>
<li><strong>Standard Bank:</strong> The most common type; a single mitigation bank site with its own instrument.</li>
</ul>
<p><strong>Other classifications:</strong></p>
<ul>
<li><strong>Is 404 (<code>IS_404</code>):</strong> Indicates whether the bank is authorized under Section 404 of the Clean Water Act (administered by the U.S. Army Corps of Engineers).
<ul>
<li><em>Yes</em>: Usable for compensatory mitigation required by 404 permits.</li>
<li><em>No</em>: May be tied to state, local, or non-404 obligations.</li>
</ul></li>
<li><strong>Is Conservation Bank (<code>IS_CONSERVATION</code>):</strong> Indicates whether the site is a conservation bank under the U.S. Fish &amp; Wildlife Service.
<ul>
<li>Conservation banks focus on endangered species habitat offsets rather than wetlands/streams.</li>
<li>They often coexist in RIBITS alongside mitigation banks but serve different legal/regulatory purposes.</li>
</ul></li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply collapse and count function to bank types, whether they are 404 or not, and whether they are conservation banks or not</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>bank_kinds <span class="ot">&lt;-</span> <span class="fu">collapse_and_count</span>(data, <span class="st">"kind_of_bank"</span>, <span class="at">how =</span> <span class="st">"first"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>bank_404 <span class="ot">&lt;-</span> <span class="fu">collapse_and_count</span>(data, <span class="st">"is_404"</span>, <span class="at">how =</span> <span class="st">"first"</span>) </span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>bank_conservation <span class="ot">&lt;-</span> <span class="fu">collapse_and_count</span>(data, <span class="st">"is_conservation"</span>, <span class="at">how =</span> <span class="st">"first"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Table: Bank Kind Distribution</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the bank types</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  bank_kinds<span class="sc">$</span>counts <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">kind_of_bank  =</span> <span class="st">"Kind of Bank"</span>,</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_banks       =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">title    =</span> <span class="st">"**Bank Kind Distribution**"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {nrow(data)} banks"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="iaaehlmzpc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#iaaehlmzpc table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#iaaehlmzpc thead, #iaaehlmzpc tbody, #iaaehlmzpc tfoot, #iaaehlmzpc tr, #iaaehlmzpc td, #iaaehlmzpc th {
  border-style: none;
}

#iaaehlmzpc p {
  margin: 0;
  padding: 0;
}

#iaaehlmzpc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#iaaehlmzpc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#iaaehlmzpc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#iaaehlmzpc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#iaaehlmzpc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iaaehlmzpc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iaaehlmzpc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#iaaehlmzpc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#iaaehlmzpc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#iaaehlmzpc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#iaaehlmzpc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#iaaehlmzpc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#iaaehlmzpc .gt_spanner_row {
  border-bottom-style: hidden;
}

#iaaehlmzpc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#iaaehlmzpc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#iaaehlmzpc .gt_from_md > :first-child {
  margin-top: 0;
}

#iaaehlmzpc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#iaaehlmzpc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#iaaehlmzpc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#iaaehlmzpc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#iaaehlmzpc .gt_row_group_first td {
  border-top-width: 2px;
}

#iaaehlmzpc .gt_row_group_first th {
  border-top-width: 2px;
}

#iaaehlmzpc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iaaehlmzpc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#iaaehlmzpc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#iaaehlmzpc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iaaehlmzpc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#iaaehlmzpc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#iaaehlmzpc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#iaaehlmzpc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#iaaehlmzpc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#iaaehlmzpc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iaaehlmzpc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#iaaehlmzpc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#iaaehlmzpc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#iaaehlmzpc .gt_left {
  text-align: left;
}

#iaaehlmzpc .gt_center {
  text-align: center;
}

#iaaehlmzpc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#iaaehlmzpc .gt_font_normal {
  font-weight: normal;
}

#iaaehlmzpc .gt_font_bold {
  font-weight: bold;
}

#iaaehlmzpc .gt_font_italic {
  font-style: italic;
}

#iaaehlmzpc .gt_super {
  font-size: 65%;
}

#iaaehlmzpc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#iaaehlmzpc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#iaaehlmzpc .gt_indent_1 {
  text-indent: 5px;
}

#iaaehlmzpc .gt_indent_2 {
  text-indent: 10px;
}

#iaaehlmzpc .gt_indent_3 {
  text-indent: 15px;
}

#iaaehlmzpc .gt_indent_4 {
  text-indent: 20px;
}

#iaaehlmzpc .gt_indent_5 {
  text-indent: 25px;
}

#iaaehlmzpc .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#iaaehlmzpc div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="2" class="gt_heading gt_title gt_font_normal"><strong>Bank Kind Distribution</strong></th>
</tr>
<tr class="gt_heading even">
<th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Across 4868 banks</th>
</tr>
<tr class="gt_col_headings header">
<th id="kind_of_bank" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Kind of Bank</th>
<th id="n_banks" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Number of Banks</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="kind_of_bank">Standard</td>
<td class="gt_row gt_right" headers="n_banks">2709</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="kind_of_bank">ILF</td>
<td class="gt_row gt_right gt_striped" headers="n_banks">1740</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="kind_of_bank">Umbrella</td>
<td class="gt_row gt_right" headers="n_banks">414</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="kind_of_bank">NRDA</td>
<td class="gt_row gt_right gt_striped" headers="n_banks">5</td>
</tr>
</tbody>
</table>

</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table: Section 404 Applicability</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  bank_404<span class="sc">$</span>counts <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_404  =</span> <span class="st">"Section 404 Applicable"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_banks =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">title    =</span> <span class="st">"**Section 404 Applicability**"</span>,</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {nrow(data)} banks"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="gywfhwqmrk" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#gywfhwqmrk table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#gywfhwqmrk thead, #gywfhwqmrk tbody, #gywfhwqmrk tfoot, #gywfhwqmrk tr, #gywfhwqmrk td, #gywfhwqmrk th {
  border-style: none;
}

#gywfhwqmrk p {
  margin: 0;
  padding: 0;
}

#gywfhwqmrk .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#gywfhwqmrk .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#gywfhwqmrk .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#gywfhwqmrk .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#gywfhwqmrk .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gywfhwqmrk .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gywfhwqmrk .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#gywfhwqmrk .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#gywfhwqmrk .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#gywfhwqmrk .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#gywfhwqmrk .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#gywfhwqmrk .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#gywfhwqmrk .gt_spanner_row {
  border-bottom-style: hidden;
}

#gywfhwqmrk .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#gywfhwqmrk .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#gywfhwqmrk .gt_from_md > :first-child {
  margin-top: 0;
}

#gywfhwqmrk .gt_from_md > :last-child {
  margin-bottom: 0;
}

#gywfhwqmrk .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#gywfhwqmrk .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#gywfhwqmrk .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#gywfhwqmrk .gt_row_group_first td {
  border-top-width: 2px;
}

#gywfhwqmrk .gt_row_group_first th {
  border-top-width: 2px;
}

#gywfhwqmrk .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gywfhwqmrk .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#gywfhwqmrk .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#gywfhwqmrk .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gywfhwqmrk .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#gywfhwqmrk .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#gywfhwqmrk .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#gywfhwqmrk .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#gywfhwqmrk .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#gywfhwqmrk .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gywfhwqmrk .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gywfhwqmrk .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#gywfhwqmrk .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#gywfhwqmrk .gt_left {
  text-align: left;
}

#gywfhwqmrk .gt_center {
  text-align: center;
}

#gywfhwqmrk .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#gywfhwqmrk .gt_font_normal {
  font-weight: normal;
}

#gywfhwqmrk .gt_font_bold {
  font-weight: bold;
}

#gywfhwqmrk .gt_font_italic {
  font-style: italic;
}

#gywfhwqmrk .gt_super {
  font-size: 65%;
}

#gywfhwqmrk .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#gywfhwqmrk .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#gywfhwqmrk .gt_indent_1 {
  text-indent: 5px;
}

#gywfhwqmrk .gt_indent_2 {
  text-indent: 10px;
}

#gywfhwqmrk .gt_indent_3 {
  text-indent: 15px;
}

#gywfhwqmrk .gt_indent_4 {
  text-indent: 20px;
}

#gywfhwqmrk .gt_indent_5 {
  text-indent: 25px;
}

#gywfhwqmrk .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#gywfhwqmrk div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="2" class="gt_heading gt_title gt_font_normal"><strong>Section 404 Applicability</strong></th>
</tr>
<tr class="gt_heading even">
<th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Across 4868 banks</th>
</tr>
<tr class="gt_col_headings header">
<th id="is_404" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Section 404 Applicable</th>
<th id="n_banks" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Number of Banks</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="is_404">Yes</td>
<td class="gt_row gt_right" headers="n_banks">4542</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="is_404">No</td>
<td class="gt_row gt_right gt_striped" headers="n_banks">326</td>
</tr>
</tbody>
</table>

</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Table: Conservation Bank Status</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  bank_conservation<span class="sc">$</span>counts <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_conservation  =</span> <span class="st">"Conservation Bank"</span>,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_banks =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">title    =</span> <span class="st">"**Conservation Bank Status**"</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {nrow(data)} banks"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="zfnedgxztf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#zfnedgxztf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zfnedgxztf thead, #zfnedgxztf tbody, #zfnedgxztf tfoot, #zfnedgxztf tr, #zfnedgxztf td, #zfnedgxztf th {
  border-style: none;
}

#zfnedgxztf p {
  margin: 0;
  padding: 0;
}

#zfnedgxztf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zfnedgxztf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zfnedgxztf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zfnedgxztf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zfnedgxztf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zfnedgxztf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zfnedgxztf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zfnedgxztf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zfnedgxztf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zfnedgxztf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zfnedgxztf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zfnedgxztf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zfnedgxztf .gt_spanner_row {
  border-bottom-style: hidden;
}

#zfnedgxztf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zfnedgxztf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zfnedgxztf .gt_from_md > :first-child {
  margin-top: 0;
}

#zfnedgxztf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zfnedgxztf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zfnedgxztf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#zfnedgxztf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zfnedgxztf .gt_row_group_first td {
  border-top-width: 2px;
}

#zfnedgxztf .gt_row_group_first th {
  border-top-width: 2px;
}

#zfnedgxztf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zfnedgxztf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zfnedgxztf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zfnedgxztf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zfnedgxztf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zfnedgxztf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zfnedgxztf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zfnedgxztf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zfnedgxztf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zfnedgxztf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zfnedgxztf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zfnedgxztf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zfnedgxztf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zfnedgxztf .gt_left {
  text-align: left;
}

#zfnedgxztf .gt_center {
  text-align: center;
}

#zfnedgxztf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zfnedgxztf .gt_font_normal {
  font-weight: normal;
}

#zfnedgxztf .gt_font_bold {
  font-weight: bold;
}

#zfnedgxztf .gt_font_italic {
  font-style: italic;
}

#zfnedgxztf .gt_super {
  font-size: 65%;
}

#zfnedgxztf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zfnedgxztf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zfnedgxztf .gt_indent_1 {
  text-indent: 5px;
}

#zfnedgxztf .gt_indent_2 {
  text-indent: 10px;
}

#zfnedgxztf .gt_indent_3 {
  text-indent: 15px;
}

#zfnedgxztf .gt_indent_4 {
  text-indent: 20px;
}

#zfnedgxztf .gt_indent_5 {
  text-indent: 25px;
}

#zfnedgxztf .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#zfnedgxztf div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="2" class="gt_heading gt_title gt_font_normal"><strong>Conservation Bank Status</strong></th>
</tr>
<tr class="gt_heading even">
<th colspan="2" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Across 4868 banks</th>
</tr>
<tr class="gt_col_headings header">
<th id="is_conservation" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Conservation Bank</th>
<th id="n_banks" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Number of Banks</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="is_conservation">No</td>
<td class="gt_row gt_right" headers="n_banks">4630</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="is_conservation">Yes</td>
<td class="gt_row gt_right gt_striped" headers="n_banks">238</td>
</tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="bank-type" class="level3">
<h3 class="anchored" data-anchor-id="bank-type">Bank Type</h3>
<p>In addition to kinds of banks, there is also the type of bank. The <strong>bank type (<code>bank_type</code>)</strong> field describes who owns, operates, or sponsors the mitigation bank and provides context on the institution behind the credits and how they are managed.</p>
<ul>
<li><p><strong>Private Commercial</strong><br>
Privately owned, for-profit entities that develop banks and sell credits on the open market.<br>
This is the most common type of mitigation bank.</p></li>
<li><p><strong>Public Commercial</strong><br>
Government agencies (e.g., state DOTs, local governments) acting as bank sponsors and selling credits.</p></li>
<li><p><strong>Private Nonprofit</strong><br>
Nonprofit organizations (such as land trusts or conservation groups) that operate banks, often reinvesting proceeds into restoration and stewardship.</p></li>
<li><p><strong>Single-Client</strong><br>
Banks established to serve the mitigation needs of a single developer or project sponsor.<br>
Credits are not generally available to the broader market.</p></li>
<li><p><strong>Combination Public/Private</strong><br>
Joint ventures where both public agencies and private entities share roles in sponsoring or managing the bank.</p></li>
</ul>
<p>Here I show it as a plot rather than a table.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Collapse to one row per bank (take first recorded type per bank)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>bank_type    <span class="ot">&lt;-</span> <span class="fu">collapse_and_count</span>(data, <span class="st">"bank_type"</span>, <span class="at">how =</span> <span class="st">"first"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>type_level  <span class="ot">&lt;-</span> bank_type<span class="sc">$</span>bank_level</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>type_counts <span class="ot">&lt;-</span> bank_type<span class="sc">$</span>counts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bank_type))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Horizontal bar chart with value labels</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(type_counts, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(bank_type, n_banks), <span class="at">y =</span> n_banks)) <span class="sc">+</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"seagreen"</span>) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_banks), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Bank Type"</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Bank Type"</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">max</span>(type_counts<span class="sc">$</span>n_banks, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ribits_merged_data_quality_assessment_files/figure-html/bank-type-summary-and-plot-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bank-status" class="level3">
<h3 class="anchored" data-anchor-id="bank-status">Bank Status</h3>
<p><strong>Bank status (<code>bank_status</code>)</strong> indicates where a mitigation or conservation bank stands in the regulatory process and determines whether credits from the bank are available for use. There is also <strong>Bank status date (<code>bank_status_date</code>)</strong> which provides the date in which the bank status was changed.</p>
<ul>
<li><p><strong>Approved</strong><br>
Active banks with an approved instrument (formal agreement with agencies).<br>
These banks are authorized to sell credits for compensatory mitigation.</p></li>
<li><p><strong>Sold-Out</strong><br>
Banks that have sold all of their available credits.<br>
They remain in RIBITS for historical purposes but cannot provide new credits.</p></li>
<li><p><strong>Pending</strong><br>
Proposed banks currently under review.<br>
Credits cannot yet be purchased, but these represent projects in the pipeline.</p></li>
<li><p><strong>Withdrawn</strong><br>
Applications that were submitted but later withdrawn by the sponsor or rejected.<br>
These banks never became active.</p></li>
<li><p><strong>Terminated</strong><br>
Banks that were once approved but have since been closed or terminated by regulators.<br>
Credits are no longer valid.</p></li>
<li><p><strong>Suspended</strong><br>
Banks temporarily suspended, often due to compliance or legal issues.<br>
While suspended, the bank cannot sell credits; it may later be reinstated or permanently terminated.</p></li>
</ul>
<p>Here, I check how many banks have a recorded and dated status entry. Of the 4868 banks that had status information, <strong>517 banks were excluded</strong> from this analysis because they had no valid status date. The table below compares the statuses for the 4351 banks we kept (those with valid dates) against the statuses listed for the 517 banks we had to drop.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>  status_comparison_table <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">bank_status =</span> <span class="st">"Bank Status"</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_current_with_date =</span> <span class="st">"Kept (Has Date)"</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_dropped_no_date =</span> <span class="st">"Dropped (No Date)"</span>,</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_total =</span> <span class="st">"Total Banks"</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a summary row at the bottom to show totals</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grand_summary_rows</span>(</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="fu">c</span>(n_current_with_date, n_dropped_no_date, n_total),</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">fns =</span> <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"Total"</span>, <span class="at">fn =</span> <span class="st">"sum"</span>),</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">formatter =</span> fmt_number, <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"**Bank Status: Kept vs. Dropped**"</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Comparing banks with and without valid status dates"</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="wzmsxqjbqm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wzmsxqjbqm table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wzmsxqjbqm thead, #wzmsxqjbqm tbody, #wzmsxqjbqm tfoot, #wzmsxqjbqm tr, #wzmsxqjbqm td, #wzmsxqjbqm th {
  border-style: none;
}

#wzmsxqjbqm p {
  margin: 0;
  padding: 0;
}

#wzmsxqjbqm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wzmsxqjbqm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wzmsxqjbqm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wzmsxqjbqm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wzmsxqjbqm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wzmsxqjbqm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wzmsxqjbqm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wzmsxqjbqm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wzmsxqjbqm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wzmsxqjbqm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wzmsxqjbqm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wzmsxqjbqm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wzmsxqjbqm .gt_spanner_row {
  border-bottom-style: hidden;
}

#wzmsxqjbqm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wzmsxqjbqm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wzmsxqjbqm .gt_from_md > :first-child {
  margin-top: 0;
}

#wzmsxqjbqm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wzmsxqjbqm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wzmsxqjbqm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wzmsxqjbqm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wzmsxqjbqm .gt_row_group_first td {
  border-top-width: 2px;
}

#wzmsxqjbqm .gt_row_group_first th {
  border-top-width: 2px;
}

#wzmsxqjbqm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wzmsxqjbqm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wzmsxqjbqm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wzmsxqjbqm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wzmsxqjbqm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wzmsxqjbqm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wzmsxqjbqm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wzmsxqjbqm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wzmsxqjbqm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wzmsxqjbqm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wzmsxqjbqm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wzmsxqjbqm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wzmsxqjbqm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wzmsxqjbqm .gt_left {
  text-align: left;
}

#wzmsxqjbqm .gt_center {
  text-align: center;
}

#wzmsxqjbqm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wzmsxqjbqm .gt_font_normal {
  font-weight: normal;
}

#wzmsxqjbqm .gt_font_bold {
  font-weight: bold;
}

#wzmsxqjbqm .gt_font_italic {
  font-style: italic;
}

#wzmsxqjbqm .gt_super {
  font-size: 65%;
}

#wzmsxqjbqm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wzmsxqjbqm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wzmsxqjbqm .gt_indent_1 {
  text-indent: 5px;
}

#wzmsxqjbqm .gt_indent_2 {
  text-indent: 10px;
}

#wzmsxqjbqm .gt_indent_3 {
  text-indent: 15px;
}

#wzmsxqjbqm .gt_indent_4 {
  text-indent: 20px;
}

#wzmsxqjbqm .gt_indent_5 {
  text-indent: 25px;
}

#wzmsxqjbqm .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#wzmsxqjbqm div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="5" class="gt_heading gt_title gt_font_normal"><strong>Bank Status: Kept vs.&nbsp;Dropped</strong></th>
</tr>
<tr class="gt_heading even">
<th colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Comparing banks with and without valid status dates</th>
</tr>
<tr class="gt_col_headings header">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="bank_status" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Bank Status</th>
<th id="n_current_with_date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Kept (Has Date)</th>
<th id="n_dropped_no_date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Dropped (No Date)</th>
<th id="n_total" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Total Banks</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="stub_1_1 bank_status">Approved</td>
<td class="gt_row gt_right" headers="stub_1_1 n_current_with_date">2,767</td>
<td class="gt_row gt_right" headers="stub_1_1 n_dropped_no_date">0</td>
<td class="gt_row gt_right" headers="stub_1_1 n_total">2,767</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left gt_striped" headers="stub_1_2 bank_status">Sold-Out</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 n_current_with_date">831</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 n_dropped_no_date">0</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 n_total">831</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="stub_1_3 bank_status">Pending</td>
<td class="gt_row gt_right" headers="stub_1_3 n_current_with_date">101</td>
<td class="gt_row gt_right" headers="stub_1_3 n_dropped_no_date">514</td>
<td class="gt_row gt_right" headers="stub_1_3 n_total">615</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left gt_striped" headers="stub_1_4 bank_status">Withdrawn</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 n_current_with_date">436</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 n_dropped_no_date">0</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 n_total">436</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left" headers="stub_1_5 bank_status">Terminated</td>
<td class="gt_row gt_right" headers="stub_1_5 n_current_with_date">181</td>
<td class="gt_row gt_right" headers="stub_1_5 n_dropped_no_date">2</td>
<td class="gt_row gt_right" headers="stub_1_5 n_total">183</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_left gt_striped" headers="stub_1_6 bank_status">Suspended</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_6 n_current_with_date">35</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_6 n_dropped_no_date">1</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_6 n_total">36</td>
</tr>
<tr class="odd">
<td id="grand_summary_stub_1" class="gt_row gt_left gt_stub gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" data-quarto-table-cell-role="th" scope="row">Total</td>
<td class="gt_row gt_left gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 bank_status"></td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 n_current_with_date">4,351</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 n_dropped_no_date">517</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 n_total">4,868</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now lets check how these status events look by year:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Calculate events per year (This is the corrected part)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    We just use the existing all-caps column names.</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>events_by_year <span class="ot">&lt;-</span> current_bank_status <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(bank_status_date)) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year, bank_status, <span class="at">name =</span> <span class="st">"n_events"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, bank_status)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Plot the stacked bar chart of new events</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(events_by_year, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> n_events, <span class="at">fill =</span> bank_status)) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"New Bank Status Events Per Year"</span>,</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Each bar shows the number of banks that received their status that year."</span>,</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of New Status Events"</span>,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Status"</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">pretty</span>(events_by_year<span class="sc">$</span>year, <span class="at">n =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ribits_merged_data_quality_assessment_files/figure-html/bank-status-events-per-year-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>This table shows the same; it is <strong>the number of bank status events</strong> that occurred within each 5-year period.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>  binned_summary_table <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Relabel the bin column to be clearer</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">year_bin =</span> <span class="st">"5-Year Period"</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format all number columns</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use your custom theme function</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"**Bank Status Events by 5-Year Period**"</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a summary row at the bottom</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grand_summary_rows</span>(</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">fns =</span> <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"Total"</span>, <span class="at">fn =</span> <span class="st">"sum"</span>),</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">formatter =</span> fmt_number, <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="mtaalxtfpx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mtaalxtfpx table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mtaalxtfpx thead, #mtaalxtfpx tbody, #mtaalxtfpx tfoot, #mtaalxtfpx tr, #mtaalxtfpx td, #mtaalxtfpx th {
  border-style: none;
}

#mtaalxtfpx p {
  margin: 0;
  padding: 0;
}

#mtaalxtfpx .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mtaalxtfpx .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mtaalxtfpx .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mtaalxtfpx .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mtaalxtfpx .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mtaalxtfpx .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mtaalxtfpx .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mtaalxtfpx .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mtaalxtfpx .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mtaalxtfpx .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mtaalxtfpx .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mtaalxtfpx .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mtaalxtfpx .gt_spanner_row {
  border-bottom-style: hidden;
}

#mtaalxtfpx .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mtaalxtfpx .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mtaalxtfpx .gt_from_md > :first-child {
  margin-top: 0;
}

#mtaalxtfpx .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mtaalxtfpx .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mtaalxtfpx .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mtaalxtfpx .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mtaalxtfpx .gt_row_group_first td {
  border-top-width: 2px;
}

#mtaalxtfpx .gt_row_group_first th {
  border-top-width: 2px;
}

#mtaalxtfpx .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mtaalxtfpx .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mtaalxtfpx .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mtaalxtfpx .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mtaalxtfpx .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mtaalxtfpx .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mtaalxtfpx .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mtaalxtfpx .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mtaalxtfpx .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mtaalxtfpx .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mtaalxtfpx .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mtaalxtfpx .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mtaalxtfpx .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mtaalxtfpx .gt_left {
  text-align: left;
}

#mtaalxtfpx .gt_center {
  text-align: center;
}

#mtaalxtfpx .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mtaalxtfpx .gt_font_normal {
  font-weight: normal;
}

#mtaalxtfpx .gt_font_bold {
  font-weight: bold;
}

#mtaalxtfpx .gt_font_italic {
  font-style: italic;
}

#mtaalxtfpx .gt_super {
  font-size: 65%;
}

#mtaalxtfpx .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mtaalxtfpx .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mtaalxtfpx .gt_indent_1 {
  text-indent: 5px;
}

#mtaalxtfpx .gt_indent_2 {
  text-indent: 10px;
}

#mtaalxtfpx .gt_indent_3 {
  text-indent: 15px;
}

#mtaalxtfpx .gt_indent_4 {
  text-indent: 20px;
}

#mtaalxtfpx .gt_indent_5 {
  text-indent: 25px;
}

#mtaalxtfpx .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mtaalxtfpx div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="8" class="gt_heading gt_title gt_font_normal gt_bottom_border"><strong>Bank Status Events by 5-Year Period</strong></th>
</tr>
<tr class="gt_col_headings even">
<th id="a::stub" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="year_bin" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">5-Year Period</th>
<th id="Approved" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Approved</th>
<th id="Sold-Out" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Sold-Out</th>
<th id="Pending" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Pending</th>
<th id="Terminated" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Terminated</th>
<th id="Suspended" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Suspended</th>
<th id="Withdrawn" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Withdrawn</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td id="stub_1_1" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_center" headers="stub_1_1 year_bin">1980-1984</td>
<td class="gt_row gt_right" headers="stub_1_1 Approved">1</td>
<td class="gt_row gt_right" headers="stub_1_1 Sold-Out">0</td>
<td class="gt_row gt_right" headers="stub_1_1 Pending">0</td>
<td class="gt_row gt_right" headers="stub_1_1 Terminated">0</td>
<td class="gt_row gt_right" headers="stub_1_1 Suspended">0</td>
<td class="gt_row gt_right" headers="stub_1_1 Withdrawn">0</td>
</tr>
<tr class="even">
<td id="stub_1_2" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_center gt_striped" headers="stub_1_2 year_bin">1985-1989</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 Approved">1</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 Sold-Out">0</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 Pending">0</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 Terminated">0</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 Suspended">0</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_2 Withdrawn">0</td>
</tr>
<tr class="odd">
<td id="stub_1_3" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_center" headers="stub_1_3 year_bin">1990-1994</td>
<td class="gt_row gt_right" headers="stub_1_3 Approved">5</td>
<td class="gt_row gt_right" headers="stub_1_3 Sold-Out">1</td>
<td class="gt_row gt_right" headers="stub_1_3 Pending">0</td>
<td class="gt_row gt_right" headers="stub_1_3 Terminated">0</td>
<td class="gt_row gt_right" headers="stub_1_3 Suspended">0</td>
<td class="gt_row gt_right" headers="stub_1_3 Withdrawn">0</td>
</tr>
<tr class="even">
<td id="stub_1_4" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_center gt_striped" headers="stub_1_4 year_bin">1995-1999</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 Approved">88</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 Sold-Out">6</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 Pending">3</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 Terminated">1</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 Suspended">0</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_4 Withdrawn">0</td>
</tr>
<tr class="odd">
<td id="stub_1_5" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_center" headers="stub_1_5 year_bin">2000-2004</td>
<td class="gt_row gt_right" headers="stub_1_5 Approved">171</td>
<td class="gt_row gt_right" headers="stub_1_5 Sold-Out">17</td>
<td class="gt_row gt_right" headers="stub_1_5 Pending">0</td>
<td class="gt_row gt_right" headers="stub_1_5 Terminated">0</td>
<td class="gt_row gt_right" headers="stub_1_5 Suspended">0</td>
<td class="gt_row gt_right" headers="stub_1_5 Withdrawn">0</td>
</tr>
<tr class="even">
<td id="stub_1_6" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_center gt_striped" headers="stub_1_6 year_bin">2005-2009</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_6 Approved">346</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_6 Sold-Out">64</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_6 Pending">1</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_6 Terminated">11</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_6 Suspended">2</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_6 Withdrawn">4</td>
</tr>
<tr class="odd">
<td id="stub_1_7" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_center" headers="stub_1_7 year_bin">2010-2014</td>
<td class="gt_row gt_right" headers="stub_1_7 Approved">574</td>
<td class="gt_row gt_right" headers="stub_1_7 Sold-Out">252</td>
<td class="gt_row gt_right" headers="stub_1_7 Pending">4</td>
<td class="gt_row gt_right" headers="stub_1_7 Terminated">27</td>
<td class="gt_row gt_right" headers="stub_1_7 Suspended">11</td>
<td class="gt_row gt_right" headers="stub_1_7 Withdrawn">59</td>
</tr>
<tr class="even">
<td id="stub_1_8" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_center gt_striped" headers="stub_1_8 year_bin">2015-2019</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_8 Approved">631</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_8 Sold-Out">234</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_8 Pending">14</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_8 Terminated">81</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_8 Suspended">1</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_8 Withdrawn">119</td>
</tr>
<tr class="odd">
<td id="stub_1_9" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_center" headers="stub_1_9 year_bin">2020-2024</td>
<td class="gt_row gt_right" headers="stub_1_9 Approved">811</td>
<td class="gt_row gt_right" headers="stub_1_9 Sold-Out">242</td>
<td class="gt_row gt_right" headers="stub_1_9 Pending">50</td>
<td class="gt_row gt_right" headers="stub_1_9 Terminated">60</td>
<td class="gt_row gt_right" headers="stub_1_9 Suspended">18</td>
<td class="gt_row gt_right" headers="stub_1_9 Withdrawn">229</td>
</tr>
<tr class="even">
<td id="stub_1_10" class="gt_row gt_left gt_stub" data-quarto-table-cell-role="th" scope="row"></td>
<td class="gt_row gt_center gt_striped" headers="stub_1_10 year_bin">2025-2029</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_10 Approved">139</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_10 Sold-Out">15</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_10 Pending">29</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_10 Terminated">1</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_10 Suspended">3</td>
<td class="gt_row gt_right gt_striped" headers="stub_1_10 Withdrawn">25</td>
</tr>
<tr class="odd">
<td id="grand_summary_stub_1" class="gt_row gt_left gt_stub gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" data-quarto-table-cell-role="th" scope="row">Total</td>
<td class="gt_row gt_center gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 year_bin"></td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 Approved">2,767</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 Sold-Out">831</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 Pending">101</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 Terminated">181</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 Suspended">35</td>
<td class="gt_row gt_right gt_grand_summary_row gt_first_grand_summary_row gt_last_summary_row" headers="grand_summary_stub_1 Withdrawn">436</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>We can also see the cumulative trajectory - how many total banks are approved/pending/terminated/etc through time:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the cumulative sum using the 'events_by_year' table from the chunk above</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>cumulative_counts <span class="ot">&lt;-</span> events_by_year <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add 0-count rows for missing year/status combos</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(year, bank_status, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n_events =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the cumulative sum *within each status group*</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bank_status) <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_banks =</span> <span class="fu">cumsum</span>(n_events)) <span class="sc">%&gt;%</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the cumulative trajectories</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cumulative_counts, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> total_banks, <span class="at">color =</span> bank_status, <span class="at">group =</span> bank_status)) <span class="sc">+</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cumulative Bank Status Over Time"</span>,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Total number of banks in each state at the end of each year"</span>,</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Total Number of Banks"</span>,</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Bank Status"</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">pretty</span>(cumulative_counts<span class="sc">$</span>year, <span class="at">n =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ribits_merged_data_quality_assessment_files/figure-html/bank-status-cumulative-trajectory-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="bank-establishment" class="level3">
<h3 class="anchored" data-anchor-id="bank-establishment">Bank Establishment</h3>
<p>The date of bank establishment is also helpful to understand the age of banks and trends over time.</p>
<p>We found 3191 of the 4868 banks (65.6%) have a recorded establishment year. These dates range from 1980 to 2025.</p>
<p>The median age (as of 2025) for a bank with a known establishment date is 13 years, with the oldest being 45 years.</p>
<p>This plot shows the number of new banks established each year:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(year_counts_for_plot, <span class="fu">aes</span>(<span class="at">x =</span> year_established, <span class="at">y =</span> n_banks)) <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#0099F8"</span>) <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">pretty_breaks</span>(<span class="at">n =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="co"># Cleaner axis</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Bank Establishment Years"</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year Established"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ribits_merged_data_quality_assessment_files/figure-html/plot-establishment-year-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>This histogram shows the distribution of bank ages (as of 2025):</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bank_level <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bank_age)), <span class="fu">aes</span>(<span class="at">x =</span> bank_age, <span class="at">fill =</span> bank_status)) <span class="sc">+</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">1</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"white"</span>, <span class="co"># White outlines for clarity</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">boundary =</span> <span class="dv">0</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Bank Age Distribution by Status"</span>,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Bank Age (Years)"</span>,</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Banks"</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Bank Status"</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="co"># Move legend to bottom for more space</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ribits_merged_data_quality_assessment_files/figure-html/plot-bank-age-by-status-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
<p>It looks like most banks are under ~25 years, with some pushing 40. Note that many of the older banks are appear to be sold-out or terminated. Next, we can look at a few of the oldest banks:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>  oldest_banks_table <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">bank_name =</span> <span class="st">"Bank Name"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">bank_id =</span> <span class="st">"Bank ID"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">year_established =</span> <span class="st">"Year Est."</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">bank_age =</span> <span class="st">"Age"</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(bank_age, year_established), <span class="at">decimals =</span> <span class="dv">0</span>, <span class="at">sep_mark =</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"**Oldest Banks in Dataset**"</span>,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"As of {this_year}"</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="mscdnjhdjy" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#mscdnjhdjy table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#mscdnjhdjy thead, #mscdnjhdjy tbody, #mscdnjhdjy tfoot, #mscdnjhdjy tr, #mscdnjhdjy td, #mscdnjhdjy th {
  border-style: none;
}

#mscdnjhdjy p {
  margin: 0;
  padding: 0;
}

#mscdnjhdjy .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#mscdnjhdjy .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#mscdnjhdjy .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#mscdnjhdjy .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#mscdnjhdjy .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mscdnjhdjy .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mscdnjhdjy .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#mscdnjhdjy .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#mscdnjhdjy .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#mscdnjhdjy .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#mscdnjhdjy .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#mscdnjhdjy .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#mscdnjhdjy .gt_spanner_row {
  border-bottom-style: hidden;
}

#mscdnjhdjy .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#mscdnjhdjy .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#mscdnjhdjy .gt_from_md > :first-child {
  margin-top: 0;
}

#mscdnjhdjy .gt_from_md > :last-child {
  margin-bottom: 0;
}

#mscdnjhdjy .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#mscdnjhdjy .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#mscdnjhdjy .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#mscdnjhdjy .gt_row_group_first td {
  border-top-width: 2px;
}

#mscdnjhdjy .gt_row_group_first th {
  border-top-width: 2px;
}

#mscdnjhdjy .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mscdnjhdjy .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#mscdnjhdjy .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#mscdnjhdjy .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mscdnjhdjy .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#mscdnjhdjy .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#mscdnjhdjy .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#mscdnjhdjy .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#mscdnjhdjy .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#mscdnjhdjy .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mscdnjhdjy .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mscdnjhdjy .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#mscdnjhdjy .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#mscdnjhdjy .gt_left {
  text-align: left;
}

#mscdnjhdjy .gt_center {
  text-align: center;
}

#mscdnjhdjy .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#mscdnjhdjy .gt_font_normal {
  font-weight: normal;
}

#mscdnjhdjy .gt_font_bold {
  font-weight: bold;
}

#mscdnjhdjy .gt_font_italic {
  font-style: italic;
}

#mscdnjhdjy .gt_super {
  font-size: 65%;
}

#mscdnjhdjy .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#mscdnjhdjy .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#mscdnjhdjy .gt_indent_1 {
  text-indent: 5px;
}

#mscdnjhdjy .gt_indent_2 {
  text-indent: 10px;
}

#mscdnjhdjy .gt_indent_3 {
  text-indent: 15px;
}

#mscdnjhdjy .gt_indent_4 {
  text-indent: 20px;
}

#mscdnjhdjy .gt_indent_5 {
  text-indent: 25px;
}

#mscdnjhdjy .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#mscdnjhdjy div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="4" class="gt_heading gt_title gt_font_normal"><strong>Oldest Banks in Dataset</strong></th>
</tr>
<tr class="gt_heading even">
<th colspan="4" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">As of 2025</th>
</tr>
<tr class="gt_col_headings header">
<th id="bank_name" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Bank Name</th>
<th id="bank_id" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Bank ID</th>
<th id="year_established" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Year Est.</th>
<th id="bank_age" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Age</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="bank_name">Bracut Marsh</td>
<td class="gt_row gt_right" headers="bank_id">2655</td>
<td class="gt_row gt_right" headers="year_established">1980</td>
<td class="gt_row gt_right" headers="bank_age">45</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="bank_name">Louisiana Department of Development &amp; Transportation</td>
<td class="gt_row gt_right gt_striped" headers="bank_id">2663</td>
<td class="gt_row gt_right gt_striped" headers="year_established">1982</td>
<td class="gt_row gt_right gt_striped" headers="bank_age">43</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="bank_name">VDOT - Goose Creek</td>
<td class="gt_row gt_right" headers="bank_id">590</td>
<td class="gt_row gt_right" headers="year_established">1982</td>
<td class="gt_row gt_right" headers="bank_age">43</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="bank_name">Fina La Terre</td>
<td class="gt_row gt_right gt_striped" headers="bank_id">2683</td>
<td class="gt_row gt_right gt_striped" headers="year_established">1984</td>
<td class="gt_row gt_right gt_striped" headers="bank_age">41</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="bank_name">MN - Hubbard - Lake George Borrow Ponds - MnDOT</td>
<td class="gt_row gt_right" headers="bank_id">2669</td>
<td class="gt_row gt_right" headers="year_established">1986</td>
<td class="gt_row gt_right" headers="bank_age">39</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="bank_name">Anaheim Bay - Port of Long Beach</td>
<td class="gt_row gt_right gt_striped" headers="bank_id">2662</td>
<td class="gt_row gt_right gt_striped" headers="year_established">1986</td>
<td class="gt_row gt_right gt_striped" headers="bank_age">39</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="bank_name">Huntington Beach MB</td>
<td class="gt_row gt_right" headers="bank_id">2681</td>
<td class="gt_row gt_right" headers="year_established">1987</td>
<td class="gt_row gt_right" headers="bank_age">38</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="bank_name">North Dakota State Wetlands Bank (Closed)</td>
<td class="gt_row gt_right gt_striped" headers="bank_id">2595</td>
<td class="gt_row gt_right gt_striped" headers="year_established">1987</td>
<td class="gt_row gt_right gt_striped" headers="bank_age">38</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="bank_name">Astoria Airport</td>
<td class="gt_row gt_right" headers="bank_id">1207</td>
<td class="gt_row gt_right" headers="year_established">1987</td>
<td class="gt_row gt_right" headers="bank_age">38</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="bank_name">MN - St. Louis - Buhl Impoundment - MnDOT</td>
<td class="gt_row gt_right gt_striped" headers="bank_id">2668</td>
<td class="gt_row gt_right gt_striped" headers="year_established">1988</td>
<td class="gt_row gt_right gt_striped" headers="bank_age">37</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Finally, just to check the data quality of bank establishment year, I create a table showing what proportion of banks in each status (approved, pending, withdrawn, etc) are missing the establishment year in RIBITS.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>  missing_by_status_table <span class="sc">%&gt;%</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">bank_status =</span> <span class="st">"Bank Status"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_total =</span> <span class="st">"Total Banks"</span>,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_missing =</span> <span class="st">"Banks Missing Est. Year"</span>,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">pct_missing =</span> <span class="st">"Missing %"</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(n_total, n_missing), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_percent</span>(<span class="at">columns =</span> pct_missing, <span class="at">scale_values =</span> <span class="cn">FALSE</span>, <span class="at">decimals =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"**Missing Establishment Year by Bank Status**"</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="cykioisqdg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#cykioisqdg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#cykioisqdg thead, #cykioisqdg tbody, #cykioisqdg tfoot, #cykioisqdg tr, #cykioisqdg td, #cykioisqdg th {
  border-style: none;
}

#cykioisqdg p {
  margin: 0;
  padding: 0;
}

#cykioisqdg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cykioisqdg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#cykioisqdg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cykioisqdg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cykioisqdg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cykioisqdg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cykioisqdg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cykioisqdg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cykioisqdg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cykioisqdg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cykioisqdg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cykioisqdg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cykioisqdg .gt_spanner_row {
  border-bottom-style: hidden;
}

#cykioisqdg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#cykioisqdg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cykioisqdg .gt_from_md > :first-child {
  margin-top: 0;
}

#cykioisqdg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cykioisqdg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cykioisqdg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cykioisqdg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cykioisqdg .gt_row_group_first td {
  border-top-width: 2px;
}

#cykioisqdg .gt_row_group_first th {
  border-top-width: 2px;
}

#cykioisqdg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cykioisqdg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cykioisqdg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cykioisqdg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cykioisqdg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cykioisqdg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cykioisqdg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#cykioisqdg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cykioisqdg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cykioisqdg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cykioisqdg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cykioisqdg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cykioisqdg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cykioisqdg .gt_left {
  text-align: left;
}

#cykioisqdg .gt_center {
  text-align: center;
}

#cykioisqdg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cykioisqdg .gt_font_normal {
  font-weight: normal;
}

#cykioisqdg .gt_font_bold {
  font-weight: bold;
}

#cykioisqdg .gt_font_italic {
  font-style: italic;
}

#cykioisqdg .gt_super {
  font-size: 65%;
}

#cykioisqdg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#cykioisqdg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cykioisqdg .gt_indent_1 {
  text-indent: 5px;
}

#cykioisqdg .gt_indent_2 {
  text-indent: 10px;
}

#cykioisqdg .gt_indent_3 {
  text-indent: 15px;
}

#cykioisqdg .gt_indent_4 {
  text-indent: 20px;
}

#cykioisqdg .gt_indent_5 {
  text-indent: 25px;
}

#cykioisqdg .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#cykioisqdg div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="4" class="gt_heading gt_title gt_font_normal gt_bottom_border"><strong>Missing Establishment Year by Bank Status</strong></th>
</tr>
<tr class="gt_col_headings even">
<th id="bank_status" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Bank Status</th>
<th id="n_total" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Total Banks</th>
<th id="n_missing" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Banks Missing Est. Year</th>
<th id="pct_missing" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Missing %</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="bank_status">Pending</td>
<td class="gt_row gt_right" headers="n_total">615</td>
<td class="gt_row gt_right" headers="n_missing">572</td>
<td class="gt_row gt_right" headers="pct_missing">93.0%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="bank_status">Withdrawn</td>
<td class="gt_row gt_right gt_striped" headers="n_total">436</td>
<td class="gt_row gt_right gt_striped" headers="n_missing">391</td>
<td class="gt_row gt_right gt_striped" headers="pct_missing">89.7%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="bank_status">Terminated</td>
<td class="gt_row gt_right" headers="n_total">183</td>
<td class="gt_row gt_right" headers="n_missing">78</td>
<td class="gt_row gt_right" headers="pct_missing">42.6%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="bank_status">Sold-Out</td>
<td class="gt_row gt_right gt_striped" headers="n_total">831</td>
<td class="gt_row gt_right gt_striped" headers="n_missing">262</td>
<td class="gt_row gt_right gt_striped" headers="pct_missing">31.5%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="bank_status">Approved</td>
<td class="gt_row gt_right" headers="n_total">2,767</td>
<td class="gt_row gt_right" headers="n_missing">371</td>
<td class="gt_row gt_right" headers="pct_missing">13.4%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="bank_status">Suspended</td>
<td class="gt_row gt_right gt_striped" headers="n_total">36</td>
<td class="gt_row gt_right gt_striped" headers="n_missing">3</td>
<td class="gt_row gt_right gt_striped" headers="pct_missing">8.3%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
</section>
<section id="bank-cowardin-classes" class="level1">
<h1>Bank Cowardin Classes</h1>
<p>The Cowardin system is a hierarchical method for classifying wetland vegetation and habitats. Because a single mitigation bank may encompass several types of ecosystems, there might be multiple values in the Cowardin columns. The data below represents multi-value lists (comma-separated) for each bank.</p>
<p>We analyze the four main hierarchy levels:</p>
<ul>
<li><p>Systems: (<code>bank_cowardin_system_list</code>) - The broadest category describing the general hydrologic environment (e.g., Palustrine, Riverine, Estuarine).</p></li>
<li><p>Subsystems: (<code>bank_cowardin_subsystem_list</code>) - A subdivision of Systems based on water flow or flooding regimes (e.g., Tidal, Perennial, Intermittent). Note: The Palustrine system usually has no subsystem.</p></li>
<li><p>Classes: (<code>bank_cowardin_class_list</code>) - Describes the general appearance of the habitat in terms of either the dominant life form of the vegetation or the composition of the substrate (e.g., Emergent, Scrub-Shrub, Unconsolidated Bottom).</p></li>
<li><p>Subclasses: (<code>bank_cowardin_subclass_list</code>) - A finer distinction of the Class (e.g., Persistent, Broad-Leaved Deciduous).</p></li>
</ul>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the columns of interest mapping to readable names</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>cowardin_map <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_cowardin_system_list"</span>    <span class="ot">=</span> <span class="st">"Systems"</span>,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_cowardin_class_list"</span>     <span class="ot">=</span> <span class="st">"Classes"</span>, </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_cowardin_subsystem_list"</span> <span class="ot">=</span> <span class="st">"Subsystems"</span>,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_cowardin_subclass_list"</span>  <span class="ot">=</span> <span class="st">"Subclasses"</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function to calculate stats for ONE column</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>calc_cowardin_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(col_name, label, df) {</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  vals <span class="ot">&lt;-</span> df[[col_name]]</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  n_per_bank <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(vals) <span class="sc">|</span> vals <span class="sc">==</span> <span class="st">""</span>, <span class="dv">0</span>, <span class="fu">str_count</span>(vals, <span class="st">","</span>) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  all_tokens <span class="ot">&lt;-</span> vals[<span class="sc">!</span><span class="fu">is.na</span>(vals) <span class="sc">&amp;</span> vals <span class="sc">!=</span> <span class="st">""</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_split</span>(<span class="st">",</span><span class="sc">\\</span><span class="st">s*"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> <span class="fu">str_trim</span>()</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">classification_level =</span> label,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_types =</span> <span class="fu">n_distinct</span>(all_tokens),</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_tags =</span> <span class="fu">length</span>(all_tokens),</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">banks_with_data =</span> <span class="fu">sum</span>(n_per_bank <span class="sc">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_of_banks =</span> <span class="fu">mean</span>(n_per_bank <span class="sc">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_per_bank =</span> <span class="fu">mean</span>(n_per_bank[n_per_bank <span class="sc">&gt;</span> <span class="dv">0</span>])</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Build summary table</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>summary_df <span class="ot">&lt;-</span> <span class="fu">imap_dfr</span>(cowardin_map, <span class="sc">~</span><span class="fu">calc_cowardin_stats</span>(.y, .x, data))</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Create formatted summary table</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>summary_df <span class="sc">%&gt;%</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">classification_level =</span> <span class="st">"Classification Level"</span>,</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_types =</span> <span class="st">"Unique Types"</span>,</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_tags =</span> <span class="st">"Total Tags"</span>, </span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">banks_with_data =</span> <span class="st">"Banks with Data"</span>,</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_of_banks =</span> <span class="st">"% of Banks"</span>,</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_per_bank =</span> <span class="st">"Avg per Bank"</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(unique_types, total_tags, banks_with_data), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(avg_per_bank), <span class="at">decimals =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> <span class="fu">c</span>(pct_of_banks), <span class="at">decimals =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">style_table</span>(</span>
<span id="cb31-44"><a href="#cb31-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"**Cowardin Classification Data Availability**"</span>,</span>
<span id="cb31-45"><a href="#cb31-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Data density across {n_banks} banks"</span>)</span>
<span id="cb31-46"><a href="#cb31-46" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="atyojnprlm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#atyojnprlm table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#atyojnprlm thead, #atyojnprlm tbody, #atyojnprlm tfoot, #atyojnprlm tr, #atyojnprlm td, #atyojnprlm th {
  border-style: none;
}

#atyojnprlm p {
  margin: 0;
  padding: 0;
}

#atyojnprlm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#atyojnprlm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#atyojnprlm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#atyojnprlm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#atyojnprlm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#atyojnprlm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#atyojnprlm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#atyojnprlm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#atyojnprlm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#atyojnprlm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#atyojnprlm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#atyojnprlm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#atyojnprlm .gt_spanner_row {
  border-bottom-style: hidden;
}

#atyojnprlm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#atyojnprlm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#atyojnprlm .gt_from_md > :first-child {
  margin-top: 0;
}

#atyojnprlm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#atyojnprlm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#atyojnprlm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#atyojnprlm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#atyojnprlm .gt_row_group_first td {
  border-top-width: 2px;
}

#atyojnprlm .gt_row_group_first th {
  border-top-width: 2px;
}

#atyojnprlm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#atyojnprlm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#atyojnprlm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#atyojnprlm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#atyojnprlm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#atyojnprlm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#atyojnprlm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#atyojnprlm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#atyojnprlm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#atyojnprlm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#atyojnprlm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#atyojnprlm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#atyojnprlm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#atyojnprlm .gt_left {
  text-align: left;
}

#atyojnprlm .gt_center {
  text-align: center;
}

#atyojnprlm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#atyojnprlm .gt_font_normal {
  font-weight: normal;
}

#atyojnprlm .gt_font_bold {
  font-weight: bold;
}

#atyojnprlm .gt_font_italic {
  font-style: italic;
}

#atyojnprlm .gt_super {
  font-size: 65%;
}

#atyojnprlm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#atyojnprlm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#atyojnprlm .gt_indent_1 {
  text-indent: 5px;
}

#atyojnprlm .gt_indent_2 {
  text-indent: 10px;
}

#atyojnprlm .gt_indent_3 {
  text-indent: 15px;
}

#atyojnprlm .gt_indent_4 {
  text-indent: 20px;
}

#atyojnprlm .gt_indent_5 {
  text-indent: 25px;
}

#atyojnprlm .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#atyojnprlm div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="6" class="gt_heading gt_title gt_font_normal"><strong>Cowardin Classification Data Availability</strong></th>
</tr>
<tr class="gt_heading even">
<th colspan="6" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Data density across 4868 banks</th>
</tr>
<tr class="gt_col_headings header">
<th id="classification_level" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Classification Level</th>
<th id="unique_types" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Unique Types</th>
<th id="total_tags" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Total Tags</th>
<th id="banks_with_data" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Banks with Data</th>
<th id="pct_of_banks" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">% of Banks</th>
<th id="avg_per_bank" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Avg per Bank</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="classification_level">Systems</td>
<td class="gt_row gt_right" headers="unique_types">7</td>
<td class="gt_row gt_right" headers="total_tags">4,536</td>
<td class="gt_row gt_right" headers="banks_with_data">3,203</td>
<td class="gt_row gt_right" headers="pct_of_banks">65.8%</td>
<td class="gt_row gt_right" headers="avg_per_bank">1.4</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="classification_level">Classes</td>
<td class="gt_row gt_right gt_striped" headers="unique_types">12</td>
<td class="gt_row gt_right gt_striped" headers="total_tags">1,881</td>
<td class="gt_row gt_right gt_striped" headers="banks_with_data">1,194</td>
<td class="gt_row gt_right gt_striped" headers="pct_of_banks">24.5%</td>
<td class="gt_row gt_right gt_striped" headers="avg_per_bank">1.6</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="classification_level">Subsystems</td>
<td class="gt_row gt_right" headers="unique_types">10</td>
<td class="gt_row gt_right" headers="total_tags">2,546</td>
<td class="gt_row gt_right" headers="banks_with_data">2,307</td>
<td class="gt_row gt_right" headers="pct_of_banks">47.4%</td>
<td class="gt_row gt_right" headers="avg_per_bank">1.1</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="classification_level">Subclasses</td>
<td class="gt_row gt_right gt_striped" headers="unique_types">15</td>
<td class="gt_row gt_right gt_striped" headers="total_tags">904</td>
<td class="gt_row gt_right gt_striped" headers="banks_with_data">670</td>
<td class="gt_row gt_right gt_striped" headers="pct_of_banks">13.8%</td>
<td class="gt_row gt_right gt_striped" headers="avg_per_bank">1.3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="top-classifications-by-level" class="level2">
<h2 class="anchored" data-anchor-id="top-classifications-by-level">Top Classifications by Level</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create tidy data for plotting</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id, <span class="fu">all_of</span>(<span class="fu">names</span>(cowardin_map))) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>bank_id, <span class="at">names_to =</span> <span class="st">"col_name"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value), value <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(value, <span class="at">sep =</span> <span class="st">",</span><span class="sc">\\</span><span class="st">s*"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">str_trim</span>(value),</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">category =</span> <span class="fu">factor</span>(cowardin_map[col_name], <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Systems"</span>, <span class="st">"Subsystems"</span>, <span class="st">"Classes"</span>, <span class="st">"Subclasses"</span>))</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(category, value) <span class="sc">%&gt;%</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(category) <span class="sc">%&gt;%</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(n, <span class="at">n =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Create faceted plot</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> <span class="fu">reorder_within</span>(value, n, category))) <span class="sc">+</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reordered</span>() <span class="sc">+</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>category, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 5 Cowardin Classifications by Level"</span>,</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of Banks"</span>,</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>)) <span class="sc">+</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">max</span>(plot_data<span class="sc">$</span>n) <span class="sc">*</span> <span class="fl">1.1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="ribits_merged_data_quality_assessment_files/figure-html/cowardin-top-classifications-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:90.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="classification-complexity-analysis" class="level2">
<h2 class="anchored" data-anchor-id="classification-complexity-analysis">Classification Complexity Analysis</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to analyze complexity per level</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>analyze_complexity <span class="ot">&lt;-</span> <span class="cf">function</span>(col_name, label) {</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  vals <span class="ot">&lt;-</span> data[[col_name]]</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  n_per_bank <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(vals) <span class="sc">|</span> vals <span class="sc">==</span> <span class="st">""</span>, <span class="dv">0</span>, <span class="fu">str_count</span>(vals, <span class="st">","</span>) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">classification_level =</span> label,</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">single_classification =</span> <span class="fu">sum</span>(n_per_bank <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">multiple_classifications =</span> <span class="fu">sum</span>(n_per_bank <span class="sc">&gt;</span> <span class="dv">1</span>),</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_classifications =</span> <span class="fu">max</span>(n_per_bank),</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_multiple =</span> <span class="fu">mean</span>(n_per_bank <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate complexity for all levels</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>complexity_df <span class="ot">&lt;-</span> <span class="fu">imap_dfr</span>(cowardin_map, <span class="sc">~</span><span class="fu">analyze_complexity</span>(.y, .x))</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create complexity table</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>complexity_df <span class="sc">%&gt;%</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">classification_level =</span> <span class="st">"Classification Level"</span>,</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">single_classification =</span> <span class="st">"Single"</span>,</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">multiple_classifications =</span> <span class="st">"Multiple"</span>, </span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_classifications =</span> <span class="st">"Max per Bank"</span>,</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_multiple =</span> <span class="st">"% Multiple"</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(single_classification, multiple_classifications, max_classifications), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> <span class="fu">c</span>(pct_multiple), <span class="at">decimals =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">style_table</span>(</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"**Classification Complexity Analysis**"</span>,</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Banks with single vs multiple classifications by level"</span></span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="hzjzqjtzkn" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hzjzqjtzkn table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hzjzqjtzkn thead, #hzjzqjtzkn tbody, #hzjzqjtzkn tfoot, #hzjzqjtzkn tr, #hzjzqjtzkn td, #hzjzqjtzkn th {
  border-style: none;
}

#hzjzqjtzkn p {
  margin: 0;
  padding: 0;
}

#hzjzqjtzkn .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: 90%;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: rgba(255, 255, 255, 0);
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: rgba(255, 255, 255, 0);
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hzjzqjtzkn .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hzjzqjtzkn .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hzjzqjtzkn .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hzjzqjtzkn .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hzjzqjtzkn .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hzjzqjtzkn .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hzjzqjtzkn .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hzjzqjtzkn .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hzjzqjtzkn .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hzjzqjtzkn .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hzjzqjtzkn .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #000000;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hzjzqjtzkn .gt_spanner_row {
  border-bottom-style: hidden;
}

#hzjzqjtzkn .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hzjzqjtzkn .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hzjzqjtzkn .gt_from_md > :first-child {
  margin-top: 0;
}

#hzjzqjtzkn .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hzjzqjtzkn .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hzjzqjtzkn .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjzqjtzkn .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hzjzqjtzkn .gt_row_group_first td {
  border-top-width: 2px;
}

#hzjzqjtzkn .gt_row_group_first th {
  border-top-width: 2px;
}

#hzjzqjtzkn .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjzqjtzkn .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hzjzqjtzkn .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hzjzqjtzkn .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hzjzqjtzkn .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjzqjtzkn .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hzjzqjtzkn .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hzjzqjtzkn .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hzjzqjtzkn .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hzjzqjtzkn .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hzjzqjtzkn .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjzqjtzkn .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hzjzqjtzkn .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hzjzqjtzkn .gt_left {
  text-align: left;
}

#hzjzqjtzkn .gt_center {
  text-align: center;
}

#hzjzqjtzkn .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hzjzqjtzkn .gt_font_normal {
  font-weight: normal;
}

#hzjzqjtzkn .gt_font_bold {
  font-weight: bold;
}

#hzjzqjtzkn .gt_font_italic {
  font-style: italic;
}

#hzjzqjtzkn .gt_super {
  font-size: 65%;
}

#hzjzqjtzkn .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hzjzqjtzkn .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hzjzqjtzkn .gt_indent_1 {
  text-indent: 5px;
}

#hzjzqjtzkn .gt_indent_2 {
  text-indent: 10px;
}

#hzjzqjtzkn .gt_indent_3 {
  text-indent: 15px;
}

#hzjzqjtzkn .gt_indent_4 {
  text-indent: 20px;
}

#hzjzqjtzkn .gt_indent_5 {
  text-indent: 25px;
}

#hzjzqjtzkn .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hzjzqjtzkn div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="5" class="gt_heading gt_title gt_font_normal"><strong>Classification Complexity Analysis</strong></th>
</tr>
<tr class="gt_heading even">
<th colspan="5" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Banks with single vs multiple classifications by level</th>
</tr>
<tr class="gt_col_headings header">
<th id="classification_level" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Classification Level</th>
<th id="single_classification" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Single</th>
<th id="multiple_classifications" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Multiple</th>
<th id="max_classifications" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">Max per Bank</th>
<th id="pct_multiple" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold" scope="col">% Multiple</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="classification_level">Systems</td>
<td class="gt_row gt_right" headers="single_classification">2,082</td>
<td class="gt_row gt_right" headers="multiple_classifications">1,121</td>
<td class="gt_row gt_right" headers="max_classifications">5</td>
<td class="gt_row gt_right" headers="pct_multiple">23.0%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="classification_level">Classes</td>
<td class="gt_row gt_right gt_striped" headers="single_classification">763</td>
<td class="gt_row gt_right gt_striped" headers="multiple_classifications">431</td>
<td class="gt_row gt_right gt_striped" headers="max_classifications">6</td>
<td class="gt_row gt_right gt_striped" headers="pct_multiple">8.9%</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="classification_level">Subsystems</td>
<td class="gt_row gt_right" headers="single_classification">2,118</td>
<td class="gt_row gt_right" headers="multiple_classifications">189</td>
<td class="gt_row gt_right" headers="max_classifications">5</td>
<td class="gt_row gt_right" headers="pct_multiple">3.9%</td>
</tr>
<tr class="even">
<td class="gt_row gt_left gt_striped" headers="classification_level">Subclasses</td>
<td class="gt_row gt_right gt_striped" headers="single_classification">477</td>
<td class="gt_row gt_right gt_striped" headers="multiple_classifications">193</td>
<td class="gt_row gt_right gt_striped" headers="max_classifications">5</td>
<td class="gt_row gt_right gt_striped" headers="pct_multiple">4.0%</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="key-findings" class="level2">
<h2 class="anchored" data-anchor-id="key-findings">Key Findings</h2>
<p>The Cowardin classification analysis reveals several important patterns:</p>
<ol type="1">
<li><p><strong>Data Coverage</strong>: 65.8% of banks have system-level data, with 24.5% having class-level data, indicating good coverage of ecological habitat information.</p></li>
<li><p><strong>Dominant Systems</strong>: The 7 system dominates, representing the majority of all system classifications. This includes freshwater wetlands like marshes, swamps, and forested wetlands - the primary focus of mitigation banking.</p></li>
<li><p><strong>Habitat Diversity</strong>: Banks typically contain multiple habitat types, with an average of 1.6 classes per bank, reflecting the ecological complexity of mitigation sites.</p></li>
<li><p><strong>Classification Complexity</strong>: 8.9% of banks have multiple class classifications, demonstrating that most mitigation banks encompass diverse habitat types rather than single ecosystems.</p></li>
</ol>
</section>
</section>
<section id="types-of-credits" class="level1">
<h1>Types of Credits</h1>
<p>One thing the join allowed us to do was look at the types of credits available for each bank. The relevant columns here are <code>initiation_credits</code>, <code>initiation_acres</code>, and <code>initiation_feet</code>. We also have summary totals for <code>withdrawn_credits</code>, <code>tot_pot_credits_from_details</code>, and <code>tot_pot_credit_types</code>.</p>
</section>
<section id="summary-and-next-steps" class="level1">
<h1>Summary and Next Steps</h1>
<p>This report provided a fairly high-level summary of the main RIBITS raw GeoJson extract. We looked at spatial data availability, bank kinds, types, establishment years, and status through time.</p>
<p>In terms of next steps:</p>
<p>There is a lot of data still available on RIBITS that wasnt able to be extracted via the GeoJson API. It might be worth manually downloading all available files, cleaning and harmonizing them, and then joining them to the main RIBITS dataframe to get a more comprehensive look a the banks. For example, we dont have any information on if the banks are stream vs wetland mitigation banks, what type of wetland ecological characteristics are available, or more specific credit information.</p>
<p>For further downstream analysis, it also might be worth cleaning up the geospatial elements. This would include:</p>
<ul>
<li>Removing/replacing all clearly incorrect footprint geometries with service area geometries</li>
<li>Deciding what an acceptable margin of error will be for discrepancies between footprint area values</li>
<li>Imputing bank footprint areas (i.e., drawing a circle around the centroid) using the value listed in the total acres column when no footprint geometry is available</li>
</ul>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb34" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "RIBITS Cleaned Data Quality Assessment"</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> </span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 4</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="an">editor:</span><span class="co"> source</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="fu"># Introduction</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>The Regulatory In-lieu Fee and Bank Information Tracking System (RIBITS) is a database maintained by the U.S. Army Corps of Engineers that tracks mitigation banks, in-lieu fee programs, and sites across the United States. Mitigation banking allows developers who impact wetlands or streams to offset those impacts by purchasing credits from approved banks, which are created, restored, rehabilitated, or preserved wetlands. RIBITS provides key details such as locations, service areas, status, and credit information, making it the main public source for understanding and analyzing mitigation activities nationwide.</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>I programatically extracted RIBITS data via the GeoJSON API and processed it into a GeoPackage file. The data was processed through a multi-stage pipeline:</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Raw data extraction from RIBITS API</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Spatial data processing</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>GeoPackage creation with multi-layer spatial data.</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>Here, I explore the downloaded raw dataset to look at overall coverage and QA checks.</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="fu"># Document Setup</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load Packages and Set Chunk Options</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: setup</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-37"><a href="#cb34-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb34-38"><a href="#cb34-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)                    <span class="co"># Spatial data handling</span></span>
<span id="cb34-39"><a href="#cb34-39" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)                 <span class="co"># Data manipulation</span></span>
<span id="cb34-40"><a href="#cb34-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)               <span class="co"># Data cleaning</span></span>
<span id="cb34-41"><a href="#cb34-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)                 <span class="co"># Functional programming</span></span>
<span id="cb34-42"><a href="#cb34-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)               <span class="co"># Data visualization</span></span>
<span id="cb34-43"><a href="#cb34-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)             <span class="co"># Date and time manipulation</span></span>
<span id="cb34-44"><a href="#cb34-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)                  <span class="co"># File path handling</span></span>
<span id="cb34-45"><a href="#cb34-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)                 <span class="co"># Data tidying</span></span>
<span id="cb34-46"><a href="#cb34-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)                 <span class="co"># Document knitting</span></span>
<span id="cb34-47"><a href="#cb34-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)            <span class="co"># Table styling</span></span>
<span id="cb34-48"><a href="#cb34-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)                  <span class="co"># String interpolation</span></span>
<span id="cb34-49"><a href="#cb34-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)                 <span class="co"># working with base R</span></span>
<span id="cb34-50"><a href="#cb34-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)               <span class="co"># pattern matching</span></span>
<span id="cb34-51"><a href="#cb34-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)                    <span class="co"># Table styling</span></span>
<span id="cb34-52"><a href="#cb34-52" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)         <span class="co"># Map data</span></span>
<span id="cb34-53"><a href="#cb34-53" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthdata)     <span class="co"># Map data</span></span>
<span id="cb34-54"><a href="#cb34-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearthhires)    <span class="co"># Map data</span></span>
<span id="cb34-55"><a href="#cb34-55" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidytext)              <span class="co"># Text processing</span></span>
<span id="cb34-56"><a href="#cb34-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-57"><a href="#cb34-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Set ggplot theme</span></span>
<span id="cb34-58"><a href="#cb34-58" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>() <span class="sc">+</span> </span>
<span id="cb34-59"><a href="#cb34-59" aria-hidden="true" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb34-60"><a href="#cb34-60" aria-hidden="true" tabindex="-1"></a>                <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb34-61"><a href="#cb34-61" aria-hidden="true" tabindex="-1"></a>                <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb34-62"><a href="#cb34-62" aria-hidden="true" tabindex="-1"></a>                <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)))</span>
<span id="cb34-63"><a href="#cb34-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-64"><a href="#cb34-64" aria-hidden="true" tabindex="-1"></a><span class="co"># Global chunk options</span></span>
<span id="cb34-65"><a href="#cb34-65" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb34-66"><a href="#cb34-66" aria-hidden="true" tabindex="-1"></a>  <span class="at">echo       =</span> <span class="cn">FALSE</span>,   <span class="co"># Hide code by default for clean report</span></span>
<span id="cb34-67"><a href="#cb34-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">message    =</span> <span class="cn">FALSE</span>,  <span class="co"># Hide messages (like package loading)</span></span>
<span id="cb34-68"><a href="#cb34-68" aria-hidden="true" tabindex="-1"></a>  <span class="at">warning    =</span> <span class="cn">FALSE</span>,  <span class="co"># Hide warnings</span></span>
<span id="cb34-69"><a href="#cb34-69" aria-hidden="true" tabindex="-1"></a>  <span class="at">error      =</span> <span class="cn">FALSE</span>,  <span class="co"># Stop on errors instead of showing them in report</span></span>
<span id="cb34-70"><a href="#cb34-70" aria-hidden="true" tabindex="-1"></a>  <span class="at">fig.align  =</span> <span class="st">"center"</span>, <span class="co"># Center all plots</span></span>
<span id="cb34-71"><a href="#cb34-71" aria-hidden="true" tabindex="-1"></a>  <span class="at">out.width  =</span> <span class="st">"90%"</span>,  <span class="co"># Scale figures nicely</span></span>
<span id="cb34-72"><a href="#cb34-72" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi        =</span> <span class="dv">300</span>     <span class="co"># High resolution figures</span></span>
<span id="cb34-73"><a href="#cb34-73" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-74"><a href="#cb34-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-75"><a href="#cb34-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-76"><a href="#cb34-76" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load Reusable Functions</span></span>
<span id="cb34-77"><a href="#cb34-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-80"><a href="#cb34-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-81"><a href="#cb34-81" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-functions</span></span>
<span id="cb34-82"><a href="#cb34-82" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-83"><a href="#cb34-83" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-84"><a href="#cb34-84" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-85"><a href="#cb34-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-86"><a href="#cb34-86" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------</span></span>
<span id="cb34-87"><a href="#cb34-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Function: Table style formatter</span></span>
<span id="cb34-88"><a href="#cb34-88" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------</span></span>
<span id="cb34-89"><a href="#cb34-89" aria-hidden="true" tabindex="-1"></a>style_table <span class="ot">&lt;-</span> <span class="cf">function</span>(gt_tbl, title, <span class="at">subtitle =</span> <span class="cn">NULL</span>) {</span>
<span id="cb34-90"><a href="#cb34-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-91"><a href="#cb34-91" aria-hidden="true" tabindex="-1"></a>  gt_tbl <span class="sc">%&gt;%</span></span>
<span id="cb34-92"><a href="#cb34-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-93"><a href="#cb34-93" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add title and subtitle/table_caption</span></span>
<span id="cb34-94"><a href="#cb34-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb34-95"><a href="#cb34-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">md</span>(title),</span>
<span id="cb34-96"><a href="#cb34-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(subtitle)) <span class="fu">md</span>(subtitle) <span class="cf">else</span> <span class="cn">NULL</span></span>
<span id="cb34-97"><a href="#cb34-97" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-98"><a href="#cb34-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-99"><a href="#cb34-99" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make column headers bold</span></span>
<span id="cb34-100"><a href="#cb34-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb34-101"><a href="#cb34-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>),</span>
<span id="cb34-102"><a href="#cb34-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">locations =</span> <span class="fu">cells_column_labels</span>()</span>
<span id="cb34-103"><a href="#cb34-103" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-104"><a href="#cb34-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-105"><a href="#cb34-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add row stripes</span></span>
<span id="cb34-106"><a href="#cb34-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">opt_row_striping</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-107"><a href="#cb34-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-108"><a href="#cb34-108" aria-hidden="true" tabindex="-1"></a>  <span class="co"># General formatting options</span></span>
<span id="cb34-109"><a href="#cb34-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb34-110"><a href="#cb34-110" aria-hidden="true" tabindex="-1"></a>    <span class="at">column_labels.border.bottom.color =</span> <span class="st">"black"</span>,    <span class="co"># Line under header</span></span>
<span id="cb34-111"><a href="#cb34-111" aria-hidden="true" tabindex="-1"></a>    <span class="at">column_labels.border.bottom.width =</span> <span class="fu">px</span>(<span class="dv">2</span>),</span>
<span id="cb34-112"><a href="#cb34-112" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.border.top.color =</span> <span class="st">"transparent"</span>,         <span class="co"># No top border</span></span>
<span id="cb34-113"><a href="#cb34-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.border.bottom.color =</span> <span class="st">"transparent"</span>,      <span class="co"># No bottom border</span></span>
<span id="cb34-114"><a href="#cb34-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.width =</span> <span class="fu">pct</span>(<span class="dv">90</span>),                          <span class="co"># Consistent width      </span></span>
<span id="cb34-115"><a href="#cb34-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.align =</span> <span class="st">"center"</span>                          <span class="co"># Center the table</span></span>
<span id="cb34-116"><a href="#cb34-116" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-117"><a href="#cb34-117" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-118"><a href="#cb34-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-119"><a href="#cb34-119" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------</span></span>
<span id="cb34-120"><a href="#cb34-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Function: collapse_and_count</span></span>
<span id="cb34-121"><a href="#cb34-121" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------</span></span>
<span id="cb34-122"><a href="#cb34-122" aria-hidden="true" tabindex="-1"></a><span class="co"># Collapses a variable to one value per bank, counts banks per value, and </span></span>
<span id="cb34-123"><a href="#cb34-123" aria-hidden="true" tabindex="-1"></a><span class="co"># handles multi-valued strings (splits and counts tokens).</span></span>
<span id="cb34-124"><a href="#cb34-124" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb34-125"><a href="#cb34-125" aria-hidden="true" tabindex="-1"></a><span class="co"># Arguments:</span></span>
<span id="cb34-126"><a href="#cb34-126" aria-hidden="true" tabindex="-1"></a><span class="co">#   data:        Input data (sf or tibble)</span></span>
<span id="cb34-127"><a href="#cb34-127" aria-hidden="true" tabindex="-1"></a><span class="co">#   var:         Column to analyze (unquoted)</span></span>
<span id="cb34-128"><a href="#cb34-128" aria-hidden="true" tabindex="-1"></a><span class="co">#   how:         Collapse method ("first", "min", "max", "concat")</span></span>
<span id="cb34-129"><a href="#cb34-129" aria-hidden="true" tabindex="-1"></a><span class="co">#   explode:     TRUE to split multi-valued strings and count tokens</span></span>
<span id="cb34-130"><a href="#cb34-130" aria-hidden="true" tabindex="-1"></a><span class="co">#   token_rx:    Regular expression to extract tokens when explode=TRUE</span></span>
<span id="cb34-131"><a href="#cb34-131" aria-hidden="true" tabindex="-1"></a><span class="co">#   sep:         Joiner for concatenation</span></span>
<span id="cb34-132"><a href="#cb34-132" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb34-133"><a href="#cb34-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns:</span></span>
<span id="cb34-134"><a href="#cb34-134" aria-hidden="true" tabindex="-1"></a><span class="co">#   list(counts, bank_level, conflicts)</span></span>
<span id="cb34-135"><a href="#cb34-135" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb34-136"><a href="#cb34-136" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------</span></span>
<span id="cb34-137"><a href="#cb34-137" aria-hidden="true" tabindex="-1"></a>collapse_and_count <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var,</span>
<span id="cb34-138"><a href="#cb34-138" aria-hidden="true" tabindex="-1"></a>                               <span class="at">how =</span> <span class="st">"first"</span>,</span>
<span id="cb34-139"><a href="#cb34-139" aria-hidden="true" tabindex="-1"></a>                               <span class="at">explode =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-140"><a href="#cb34-140" aria-hidden="true" tabindex="-1"></a>                               <span class="at">token_rx =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">b[A-Z]{2}</span><span class="sc">\\</span><span class="st">b"</span>,</span>
<span id="cb34-141"><a href="#cb34-141" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sep =</span> <span class="st">", "</span>) {</span>
<span id="cb34-142"><a href="#cb34-142" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-143"><a href="#cb34-143" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure data is a tibble. Using as_tibble on sf objects is deprecated,</span></span>
<span id="cb34-144"><a href="#cb34-144" aria-hidden="true" tabindex="-1"></a>  <span class="co"># but st_drop_geometry() is a safe way to convert to a regular tibble.</span></span>
<span id="cb34-145"><a href="#cb34-145" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">inherits</span>(data, <span class="st">"sf"</span>)) {</span>
<span id="cb34-146"><a href="#cb34-146" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>(data)</span>
<span id="cb34-147"><a href="#cb34-147" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb34-148"><a href="#cb34-148" aria-hidden="true" tabindex="-1"></a>    data <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(data)</span>
<span id="cb34-149"><a href="#cb34-149" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-150"><a href="#cb34-150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-151"><a href="#cb34-151" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert var to symbol for easier handling</span></span>
<span id="cb34-152"><a href="#cb34-152" aria-hidden="true" tabindex="-1"></a>  var_sym <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">ensym</span>(var)</span>
<span id="cb34-153"><a href="#cb34-153" aria-hidden="true" tabindex="-1"></a>  var_str <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">as_string</span>(var_sym)</span>
<span id="cb34-154"><a href="#cb34-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-155"><a href="#cb34-155" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure column exists</span></span>
<span id="cb34-156"><a href="#cb34-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(var_str <span class="sc">%in%</span> <span class="fu">names</span>(data))</span>
<span id="cb34-157"><a href="#cb34-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-158"><a href="#cb34-158" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Validate `how` parameter</span></span>
<span id="cb34-159"><a href="#cb34-159" aria-hidden="true" tabindex="-1"></a>  how <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(how, <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"first"</span>, <span class="st">"min"</span>, <span class="st">"max"</span>, <span class="st">"concat"</span>))</span>
<span id="cb34-160"><a href="#cb34-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-161"><a href="#cb34-161" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define collapse function</span></span>
<span id="cb34-162"><a href="#cb34-162" aria-hidden="true" tabindex="-1"></a>  bank_collapse <span class="ot">&lt;-</span> <span class="cf">function</span>(data, var_sym, how, sep) {</span>
<span id="cb34-163"><a href="#cb34-163" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-164"><a href="#cb34-164" aria-hidden="true" tabindex="-1"></a>    var_str <span class="ot">&lt;-</span> rlang<span class="sc">::</span><span class="fu">as_string</span>(var_sym)</span>
<span id="cb34-165"><a href="#cb34-165" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-166"><a href="#cb34-166" aria-hidden="true" tabindex="-1"></a>    data <span class="sc">%&gt;%</span></span>
<span id="cb34-167"><a href="#cb34-167" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb34-168"><a href="#cb34-168" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb34-169"><a href="#cb34-169" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!!</span><span class="at">var_sym :=</span> {</span>
<span id="cb34-170"><a href="#cb34-170" aria-hidden="true" tabindex="-1"></a>          vals <span class="ot">&lt;-</span> .data[[var_str]]</span>
<span id="cb34-171"><a href="#cb34-171" aria-hidden="true" tabindex="-1"></a>          vals <span class="ot">&lt;-</span> vals[<span class="sc">!</span><span class="fu">is.na</span>(vals) <span class="sc">&amp;</span> vals <span class="sc">!=</span> <span class="st">""</span>]</span>
<span id="cb34-172"><a href="#cb34-172" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (<span class="fu">length</span>(vals) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb34-173"><a href="#cb34-173" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Return a type-stable NA</span></span>
<span id="cb34-174"><a href="#cb34-174" aria-hidden="true" tabindex="-1"></a>            <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb34-175"><a href="#cb34-175" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb34-176"><a href="#cb34-176" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb34-177"><a href="#cb34-177" aria-hidden="true" tabindex="-1"></a>          <span class="cf">switch</span>(how,</span>
<span id="cb34-178"><a href="#cb34-178" aria-hidden="true" tabindex="-1"></a>                 <span class="at">first  =</span> dplyr<span class="sc">::</span><span class="fu">first</span>(vals),</span>
<span id="cb34-179"><a href="#cb34-179" aria-hidden="true" tabindex="-1"></a>                 <span class="at">min    =</span> <span class="fu">suppressWarnings</span>(<span class="fu">min</span>(vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb34-180"><a href="#cb34-180" aria-hidden="true" tabindex="-1"></a>                 <span class="at">max    =</span> <span class="fu">suppressWarnings</span>(<span class="fu">max</span>(vals, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb34-181"><a href="#cb34-181" aria-hidden="true" tabindex="-1"></a>                 <span class="at">concat =</span> <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(<span class="fu">as.character</span>(vals))), <span class="at">collapse =</span> sep)</span>
<span id="cb34-182"><a href="#cb34-182" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb34-183"><a href="#cb34-183" aria-hidden="true" tabindex="-1"></a>        },</span>
<span id="cb34-184"><a href="#cb34-184" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb34-185"><a href="#cb34-185" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb34-186"><a href="#cb34-186" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-187"><a href="#cb34-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-188"><a href="#cb34-188" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>explode) {</span>
<span id="cb34-189"><a href="#cb34-189" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Call the collapse function</span></span>
<span id="cb34-190"><a href="#cb34-190" aria-hidden="true" tabindex="-1"></a>    bank_level <span class="ot">&lt;-</span> <span class="fu">bank_collapse</span>(data, var_sym, how, sep)</span>
<span id="cb34-191"><a href="#cb34-191" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-192"><a href="#cb34-192" aria-hidden="true" tabindex="-1"></a>    counts <span class="ot">&lt;-</span> bank_level <span class="sc">%&gt;%</span></span>
<span id="cb34-193"><a href="#cb34-193" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>(<span class="sc">!!</span>var_sym, <span class="at">name =</span> <span class="st">"n_banks"</span>, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-194"><a href="#cb34-194" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-195"><a href="#cb34-195" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate conflicts - banks with multiple different values</span></span>
<span id="cb34-196"><a href="#cb34-196" aria-hidden="true" tabindex="-1"></a>    conflicts <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb34-197"><a href="#cb34-197" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb34-198"><a href="#cb34-198" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb34-199"><a href="#cb34-199" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_distinct =</span> <span class="fu">n_distinct</span>(.data[[var_str]], <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-200"><a href="#cb34-200" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb34-201"><a href="#cb34-201" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb34-202"><a href="#cb34-202" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(n_distinct <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-203"><a href="#cb34-203" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(bank_id, n_distinct)</span>
<span id="cb34-204"><a href="#cb34-204" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-205"><a href="#cb34-205" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb34-206"><a href="#cb34-206" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Explode mode for multi-valued strings</span></span>
<span id="cb34-207"><a href="#cb34-207" aria-hidden="true" tabindex="-1"></a>    data_exploded <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb34-208"><a href="#cb34-208" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(bank_id, <span class="sc">!!</span>var_sym) <span class="sc">%&gt;%</span></span>
<span id="cb34-209"><a href="#cb34-209" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">.raw =</span> <span class="fu">as.character</span>(.data[[var_str]])) <span class="sc">%&gt;%</span></span>
<span id="cb34-210"><a href="#cb34-210" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">tokens =</span> stringr<span class="sc">::</span><span class="fu">str_extract_all</span>(<span class="fu">coalesce</span>(.raw, <span class="st">""</span>), token_rx)) <span class="sc">%&gt;%</span></span>
<span id="cb34-211"><a href="#cb34-211" aria-hidden="true" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">unnest_longer</span>(tokens, <span class="at">values_to =</span> <span class="st">"token"</span>, <span class="at">keep_empty =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-212"><a href="#cb34-212" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">token =</span> <span class="fu">na_if</span>(token, <span class="st">""</span>))</span>
<span id="cb34-213"><a href="#cb34-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-214"><a href="#cb34-214" aria-hidden="true" tabindex="-1"></a>    counts <span class="ot">&lt;-</span> data_exploded <span class="sc">%&gt;%</span></span>
<span id="cb34-215"><a href="#cb34-215" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(token)) <span class="sc">%&gt;%</span></span>
<span id="cb34-216"><a href="#cb34-216" aria-hidden="true" tabindex="-1"></a>      <span class="fu">count</span>(token, <span class="at">name =</span> <span class="st">"n_banks"</span>, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-217"><a href="#cb34-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-218"><a href="#cb34-218" aria-hidden="true" tabindex="-1"></a>    bank_level <span class="ot">&lt;-</span> data_exploded <span class="sc">%&gt;%</span></span>
<span id="cb34-219"><a href="#cb34-219" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(token)) <span class="sc">%&gt;%</span></span>
<span id="cb34-220"><a href="#cb34-220" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb34-221"><a href="#cb34-221" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb34-222"><a href="#cb34-222" aria-hidden="true" tabindex="-1"></a>        <span class="sc">!!</span><span class="at">var_sym :=</span> <span class="fu">paste</span>(<span class="fu">sort</span>(<span class="fu">unique</span>(token)), <span class="at">collapse =</span> sep),</span>
<span id="cb34-223"><a href="#cb34-223" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb34-224"><a href="#cb34-224" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb34-225"><a href="#cb34-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-226"><a href="#cb34-226" aria-hidden="true" tabindex="-1"></a>    conflicts <span class="ot">&lt;-</span> data_exploded <span class="sc">%&gt;%</span></span>
<span id="cb34-227"><a href="#cb34-227" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb34-228"><a href="#cb34-228" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarise</span>(</span>
<span id="cb34-229"><a href="#cb34-229" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_distinct =</span> <span class="fu">n_distinct</span>(token, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-230"><a href="#cb34-230" aria-hidden="true" tabindex="-1"></a>        <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb34-231"><a href="#cb34-231" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb34-232"><a href="#cb34-232" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(n_distinct <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-233"><a href="#cb34-233" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(bank_id, n_distinct)</span>
<span id="cb34-234"><a href="#cb34-234" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb34-235"><a href="#cb34-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-236"><a href="#cb34-236" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb34-237"><a href="#cb34-237" aria-hidden="true" tabindex="-1"></a>    <span class="at">counts =</span> counts,</span>
<span id="cb34-238"><a href="#cb34-238" aria-hidden="true" tabindex="-1"></a>    <span class="at">bank_level =</span> bank_level,</span>
<span id="cb34-239"><a href="#cb34-239" aria-hidden="true" tabindex="-1"></a>    <span class="at">conflicts =</span> conflicts</span>
<span id="cb34-240"><a href="#cb34-240" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb34-241"><a href="#cb34-241" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-242"><a href="#cb34-242" aria-hidden="true" tabindex="-1"></a><span class="co"># ------------------------------------------------------------------------------</span></span>
<span id="cb34-243"><a href="#cb34-243" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-244"><a href="#cb34-244" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-245"><a href="#cb34-245" aria-hidden="true" tabindex="-1"></a><span class="fu">## Load Data</span></span>
<span id="cb34-246"><a href="#cb34-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-249"><a href="#cb34-249" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-250"><a href="#cb34-250" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: load-data</span></span>
<span id="cb34-251"><a href="#cb34-251" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-252"><a href="#cb34-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-253"><a href="#cb34-253" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the merged bank summary data</span></span>
<span id="cb34-254"><a href="#cb34-254" aria-hidden="true" tabindex="-1"></a>merged_bank_summary <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"data_intermediate"</span>, <span class="st">"merged_bank_summary.rds"</span>))</span>
<span id="cb34-255"><a href="#cb34-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-256"><a href="#cb34-256" aria-hidden="true" tabindex="-1"></a><span class="co"># Load in the geopackage data</span></span>
<span id="cb34-257"><a href="#cb34-257" aria-hidden="true" tabindex="-1"></a>gpkg_file <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"data_intermediate"</span>, <span class="st">"bank_geometries.gpkg"</span>)</span>
<span id="cb34-258"><a href="#cb34-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-259"><a href="#cb34-259" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(gpkg_file)) {</span>
<span id="cb34-260"><a href="#cb34-260" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Load all layers</span></span>
<span id="cb34-261"><a href="#cb34-261" aria-hidden="true" tabindex="-1"></a>  centroids <span class="ot">&lt;-</span> <span class="fu">st_read</span>(gpkg_file, <span class="at">layer =</span> <span class="st">"bank_centroids"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-262"><a href="#cb34-262" aria-hidden="true" tabindex="-1"></a>  footprints <span class="ot">&lt;-</span> <span class="fu">st_read</span>(gpkg_file, <span class="at">layer =</span> <span class="st">"bank_footprints"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-263"><a href="#cb34-263" aria-hidden="true" tabindex="-1"></a>  service_areas <span class="ot">&lt;-</span> <span class="fu">st_read</span>(gpkg_file, <span class="at">layer =</span> <span class="st">"bank_service_areas"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-264"><a href="#cb34-264" aria-hidden="true" tabindex="-1"></a>  service_areas_individual <span class="ot">&lt;-</span> <span class="fu">st_read</span>(gpkg_file, <span class="at">layer =</span> <span class="st">"bank_service_areas_individual"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-265"><a href="#cb34-265" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb34-266"><a href="#cb34-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stop</span>(<span class="st">"GeoPackage file not found!"</span>)</span>
<span id="cb34-267"><a href="#cb34-267" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-268"><a href="#cb34-268" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-269"><a href="#cb34-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-270"><a href="#cb34-270" aria-hidden="true" tabindex="-1"></a><span class="fu">## Clean up data</span></span>
<span id="cb34-271"><a href="#cb34-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-274"><a href="#cb34-274" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-275"><a href="#cb34-275" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: clean-data</span></span>
<span id="cb34-276"><a href="#cb34-276" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-277"><a href="#cb34-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-278"><a href="#cb34-278" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up the data</span></span>
<span id="cb34-279"><a href="#cb34-279" aria-hidden="true" tabindex="-1"></a>merged_bank_summary <span class="ot">&lt;-</span> merged_bank_summary <span class="sc">%&gt;%</span> </span>
<span id="cb34-280"><a href="#cb34-280" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb34-281"><a href="#cb34-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-282"><a href="#cb34-282" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up the geometry data</span></span>
<span id="cb34-283"><a href="#cb34-283" aria-hidden="true" tabindex="-1"></a>centroids <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(centroids)</span>
<span id="cb34-284"><a href="#cb34-284" aria-hidden="true" tabindex="-1"></a>footprints <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(footprints)</span>
<span id="cb34-285"><a href="#cb34-285" aria-hidden="true" tabindex="-1"></a>service_areas <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(service_areas)</span>
<span id="cb34-286"><a href="#cb34-286" aria-hidden="true" tabindex="-1"></a>service_areas_individual <span class="ot">&lt;-</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>(service_areas_individual)</span>
<span id="cb34-287"><a href="#cb34-287" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-288"><a href="#cb34-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-289"><a href="#cb34-289" aria-hidden="true" tabindex="-1"></a><span class="fu">## Create Analysis Dataframes</span></span>
<span id="cb34-290"><a href="#cb34-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-293"><a href="#cb34-293" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-294"><a href="#cb34-294" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: create-analysis-dataframes</span></span>
<span id="cb34-295"><a href="#cb34-295" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-296"><a href="#cb34-296" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-297"><a href="#cb34-297" aria-hidden="true" tabindex="-1"></a><span class="co"># To avoid memory issues, I separate out the geometries from the main table.</span></span>
<span id="cb34-298"><a href="#cb34-298" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and rename geometry from each layer</span></span>
<span id="cb34-299"><a href="#cb34-299" aria-hidden="true" tabindex="-1"></a>centroids_geom <span class="ot">&lt;-</span> centroids <span class="sc">%&gt;%</span> </span>
<span id="cb34-300"><a href="#cb34-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id) <span class="sc">%&gt;%</span> </span>
<span id="cb34-301"><a href="#cb34-301" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">centroid =</span> geom)</span>
<span id="cb34-302"><a href="#cb34-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-303"><a href="#cb34-303" aria-hidden="true" tabindex="-1"></a>footprints_geom <span class="ot">&lt;-</span> footprints <span class="sc">%&gt;%</span> </span>
<span id="cb34-304"><a href="#cb34-304" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id) <span class="sc">%&gt;%</span> </span>
<span id="cb34-305"><a href="#cb34-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">footprint =</span> geom)</span>
<span id="cb34-306"><a href="#cb34-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-307"><a href="#cb34-307" aria-hidden="true" tabindex="-1"></a>service_areas_geom <span class="ot">&lt;-</span> service_areas <span class="sc">%&gt;%</span> </span>
<span id="cb34-308"><a href="#cb34-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id) <span class="sc">%&gt;%</span> </span>
<span id="cb34-309"><a href="#cb34-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">service_area =</span> geom)</span>
<span id="cb34-310"><a href="#cb34-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-311"><a href="#cb34-311" aria-hidden="true" tabindex="-1"></a><span class="co"># Join them together into a single spatial dataframe</span></span>
<span id="cb34-312"><a href="#cb34-312" aria-hidden="true" tabindex="-1"></a><span class="co"># We start with all bank IDs from the main table to ensure all banks are included</span></span>
<span id="cb34-313"><a href="#cb34-313" aria-hidden="true" tabindex="-1"></a>banks_geometries <span class="ot">&lt;-</span> merged_bank_summary <span class="sc">%&gt;%</span></span>
<span id="cb34-314"><a href="#cb34-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb34-315"><a href="#cb34-315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(centroids_geom, <span class="at">by =</span> <span class="st">"bank_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-316"><a href="#cb34-316" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(footprints_geom, <span class="at">by =</span> <span class="st">"bank_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-317"><a href="#cb34-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(service_areas_geom, <span class="at">by =</span> <span class="st">"bank_id"</span>)</span>
<span id="cb34-318"><a href="#cb34-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-319"><a href="#cb34-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-320"><a href="#cb34-320" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, create a fast, non-spatial main dataframe with availability flags</span></span>
<span id="cb34-321"><a href="#cb34-321" aria-hidden="true" tabindex="-1"></a><span class="co"># This adds boolean flags to the main data, which is much faster and more</span></span>
<span id="cb34-322"><a href="#cb34-322" aria-hidden="true" tabindex="-1"></a><span class="co"># memory-efficient than joining the actual geometries.</span></span>
<span id="cb34-323"><a href="#cb34-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-324"><a href="#cb34-324" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> merged_bank_summary <span class="sc">%&gt;%</span></span>
<span id="cb34-325"><a href="#cb34-325" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-326"><a href="#cb34-326" aria-hidden="true" tabindex="-1"></a>    <span class="co"># True/False for if the variable exists</span></span>
<span id="cb34-327"><a href="#cb34-327" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_centroid =</span> bank_id <span class="sc">%in%</span> centroids<span class="sc">$</span>bank_id,</span>
<span id="cb34-328"><a href="#cb34-328" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_footprint =</span> bank_id <span class="sc">%in%</span> footprints<span class="sc">$</span>bank_id,</span>
<span id="cb34-329"><a href="#cb34-329" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_service_area =</span> bank_id <span class="sc">%in%</span> service_areas<span class="sc">$</span>bank_id</span>
<span id="cb34-330"><a href="#cb34-330" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-331"><a href="#cb34-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-332"><a href="#cb34-332" aria-hidden="true" tabindex="-1"></a><span class="co"># clean names again</span></span>
<span id="cb34-333"><a href="#cb34-333" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb34-334"><a href="#cb34-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-335"><a href="#cb34-335" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean up intermediate objects to save memory</span></span>
<span id="cb34-336"><a href="#cb34-336" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(centroids_geom, footprints_geom, service_areas_geom)</span>
<span id="cb34-337"><a href="#cb34-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-338"><a href="#cb34-338" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the individual spatial dataframes since they are in a combined one</span></span>
<span id="cb34-339"><a href="#cb34-339" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(centroids, footprints, service_areas)</span>
<span id="cb34-340"><a href="#cb34-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-341"><a href="#cb34-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-342"><a href="#cb34-342" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Exploration</span></span>
<span id="cb34-343"><a href="#cb34-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-344"><a href="#cb34-344" aria-hidden="true" tabindex="-1"></a>Let's explore the basic characteristics of the RIBITS dataset, including variable descriptions, data availability and quality, bank types, and geographic distribution.</span>
<span id="cb34-345"><a href="#cb34-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-348"><a href="#cb34-348" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-349"><a href="#cb34-349" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: ribits-variable-descriptions</span></span>
<span id="cb34-350"><a href="#cb34-350" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-351"><a href="#cb34-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-352"><a href="#cb34-352" aria-hidden="true" tabindex="-1"></a><span class="co"># Display available variables (commented out for now)</span></span>
<span id="cb34-353"><a href="#cb34-353" aria-hidden="true" tabindex="-1"></a><span class="co"># data %&gt;%</span></span>
<span id="cb34-354"><a href="#cb34-354" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-BANK_LOCATION_CENTROID) %&gt;%</span></span>
<span id="cb34-355"><a href="#cb34-355" aria-hidden="true" tabindex="-1"></a><span class="co">#   colnames() %&gt;%</span></span>
<span id="cb34-356"><a href="#cb34-356" aria-hidden="true" tabindex="-1"></a><span class="co">#   paste(collapse = ", ")</span></span>
<span id="cb34-357"><a href="#cb34-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-358"><a href="#cb34-358" aria-hidden="true" tabindex="-1"></a><span class="co"># This is pasted from RIBITS documentation</span></span>
<span id="cb34-359"><a href="#cb34-359" aria-hidden="true" tabindex="-1"></a>ribits_vars <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb34-360"><a href="#cb34-360" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>Variable,                  <span class="sc">~</span>Description,</span>
<span id="cb34-361"><a href="#cb34-361" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_ID"</span>,                  <span class="st">"Unique ID for the bank or ILF site"</span>,</span>
<span id="cb34-362"><a href="#cb34-362" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_NAME"</span>,                <span class="st">"Name of the bank"</span>,</span>
<span id="cb34-363"><a href="#cb34-363" aria-hidden="true" tabindex="-1"></a>  <span class="st">"kind_of_bank"</span>,             <span class="st">"ILF, NRDA, Umbrella, or Standard"</span>,</span>
<span id="cb34-364"><a href="#cb34-364" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IS_404"</span>,                   <span class="st">"Yes or No (Section 404 applicability)"</span>,</span>
<span id="cb34-365"><a href="#cb34-365" aria-hidden="true" tabindex="-1"></a>  <span class="st">"IS_CONSERVATION"</span>,          <span class="st">"Yes or No (Conservation bank indicator)"</span>,</span>
<span id="cb34-366"><a href="#cb34-366" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CHAIR"</span>,                    <span class="st">"Overseeing agency"</span>,</span>
<span id="cb34-367"><a href="#cb34-367" aria-hidden="true" tabindex="-1"></a>  <span class="st">"district"</span>,                 <span class="st">"Managing district the bank is in"</span>,</span>
<span id="cb34-368"><a href="#cb34-368" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SECONDARY_district_LIST"</span>,  <span class="st">"Secondary districts the bank location is in"</span>,</span>
<span id="cb34-369"><a href="#cb34-369" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FIELD_OFFICE"</span>,             <span class="st">"Affiliated field office the bank is in"</span>,</span>
<span id="cb34-370"><a href="#cb34-370" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SECONDARY_OFFICE_LIST"</span>,    <span class="st">"Secondary field offices the bank is in"</span>,</span>
<span id="cb34-371"><a href="#cb34-371" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NMFS_REGION"</span>,              <span class="st">"Affiliated NMFS region"</span>,</span>
<span id="cb34-372"><a href="#cb34-372" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SECONDARY_NOAA_REGION_LIST"</span>,<span class="st">"Secondary NMFS regions the bank is in"</span>,</span>
<span id="cb34-373"><a href="#cb34-373" aria-hidden="true" tabindex="-1"></a>  <span class="st">"state_list"</span>,               <span class="st">"Comma-separated list of states"</span>,</span>
<span id="cb34-374"><a href="#cb34-374" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COUNTY_LIST"</span>,              <span class="st">"Comma-separated list of counties"</span>,</span>
<span id="cb34-375"><a href="#cb34-375" aria-hidden="true" tabindex="-1"></a>  <span class="st">"PERMIT_NUMBER"</span>,            <span class="st">"Comma-separated list of bank or site permits"</span>,</span>
<span id="cb34-376"><a href="#cb34-376" aria-hidden="true" tabindex="-1"></a>  <span class="st">"year_established"</span>,         <span class="st">"Year the bank was established"</span>,</span>
<span id="cb34-377"><a href="#cb34-377" aria-hidden="true" tabindex="-1"></a>  <span class="st">"establishment_date"</span>,       <span class="st">"Date bank was established"</span>,</span>
<span id="cb34-378"><a href="#cb34-378" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CLOSURE_DATE"</span>,             <span class="st">"Date of bank closure"</span>,</span>
<span id="cb34-379"><a href="#cb34-379" aria-hidden="true" tabindex="-1"></a>  <span class="st">"total_acres"</span>,              <span class="st">"Total acres of the bank"</span>,</span>
<span id="cb34-380"><a href="#cb34-380" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_status"</span>,              <span class="st">"Bank status"</span>,</span>
<span id="cb34-381"><a href="#cb34-381" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_status_DATE"</span>,         <span class="st">"Date bank status was changed"</span>,</span>
<span id="cb34-382"><a href="#cb34-382" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_type"</span>,                <span class="st">"Type of bank"</span>,</span>
<span id="cb34-383"><a href="#cb34-383" aria-hidden="true" tabindex="-1"></a>  <span class="st">"WEBSITE"</span>,                  <span class="st">"Website of the bank"</span>,</span>
<span id="cb34-384"><a href="#cb34-384" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COMMENTS"</span>,                 <span class="st">"Any additional comments about the bank"</span>,</span>
<span id="cb34-385"><a href="#cb34-385" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RIBITS_URL_TO_BANK"</span>,       <span class="st">"URL to the bank in RIBITS"</span>,</span>
<span id="cb34-386"><a href="#cb34-386" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ILF_PROGRAM_DATA_WS_URL"</span>,  <span class="st">"For ILF site, link to ILF program details"</span>,</span>
<span id="cb34-387"><a href="#cb34-387" aria-hidden="true" tabindex="-1"></a>  <span class="st">"UMBRELLA_INSTRUMENT_DATA_WS_URL"</span>, <span class="st">"For umbrella banks, link to Umbrella Instrument details"</span>,</span>
<span id="cb34-388"><a href="#cb34-388" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_GEOMETRY_OBSCURED"</span>,   <span class="st">"Flag for whether geometry is hidden (1 = obscured)"</span>,</span>
<span id="cb34-389"><a href="#cb34-389" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_LOCATION_CENTROID"</span>,   <span class="st">"Centroid (Lat/Long) of the bank location"</span>,</span>
<span id="cb34-390"><a href="#cb34-390" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_FOOTPRINT"</span>,           <span class="st">"Bank footprint (GeoJSON)"</span>,</span>
<span id="cb34-391"><a href="#cb34-391" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SERVICE_AREAS"</span>,            <span class="st">"Service areas for ILF sites"</span>,</span>
<span id="cb34-392"><a href="#cb34-392" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_SPONSORS"</span>,            <span class="st">"Entities responsible for the bank"</span>,</span>
<span id="cb34-393"><a href="#cb34-393" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_POCS"</span>,                <span class="st">"Bank points of contact (owners/consultants)"</span>,</span>
<span id="cb34-394"><a href="#cb34-394" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_MANAGERS"</span>,            <span class="st">"Regulatory bank managers"</span>,</span>
<span id="cb34-395"><a href="#cb34-395" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_IRT_MEMBERS"</span>,         <span class="st">"Interagency Review Team members"</span>,</span>
<span id="cb34-396"><a href="#cb34-396" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BANK_OTHER_CONTACTS"</span>,      <span class="st">"Other contacts for the bank"</span>,</span>
<span id="cb34-397"><a href="#cb34-397" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LEDGER"</span>,                   <span class="st">"Ledger of bank credits/debits"</span></span>
<span id="cb34-398"><a href="#cb34-398" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-399"><a href="#cb34-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-400"><a href="#cb34-400" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a table</span></span>
<span id="cb34-401"><a href="#cb34-401" aria-hidden="true" tabindex="-1"></a>ribits_vars <span class="sc">%&gt;%</span></span>
<span id="cb34-402"><a href="#cb34-402" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a GT table</span></span>
<span id="cb34-403"><a href="#cb34-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-404"><a href="#cb34-404" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add column labels</span></span>
<span id="cb34-405"><a href="#cb34-405" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb34-406"><a href="#cb34-406" aria-hidden="true" tabindex="-1"></a>      <span class="at">Variable =</span> <span class="st">"Variable"</span>,</span>
<span id="cb34-407"><a href="#cb34-407" aria-hidden="true" tabindex="-1"></a>      <span class="at">Description =</span> <span class="st">"Description"</span></span>
<span id="cb34-408"><a href="#cb34-408" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-409"><a href="#cb34-409" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply theme</span></span>
<span id="cb34-410"><a href="#cb34-410" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb34-411"><a href="#cb34-411" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"**RIBITS Variables**"</span></span>
<span id="cb34-412"><a href="#cb34-412" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-413"><a href="#cb34-413" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-414"><a href="#cb34-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-415"><a href="#cb34-415" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data Quality</span></span>
<span id="cb34-416"><a href="#cb34-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-417"><a href="#cb34-417" aria-hidden="true" tabindex="-1"></a><span class="fu">### Missing Data</span></span>
<span id="cb34-418"><a href="#cb34-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-419"><a href="#cb34-419" aria-hidden="true" tabindex="-1"></a>Let's get a feel for how many values have missing data. Below I summarize how many variables are missing row values.</span>
<span id="cb34-420"><a href="#cb34-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-423"><a href="#cb34-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-424"><a href="#cb34-424" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: missing-data-overview</span></span>
<span id="cb34-425"><a href="#cb34-425" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-426"><a href="#cb34-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-427"><a href="#cb34-427" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze missing data patterns</span></span>
<span id="cb34-428"><a href="#cb34-428" aria-hidden="true" tabindex="-1"></a>missing_analysis <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb34-429"><a href="#cb34-429" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-430"><a href="#cb34-430" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First convert the True/False geometry columns to NA</span></span>
<span id="cb34-431"><a href="#cb34-431" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-432"><a href="#cb34-432" aria-hidden="true" tabindex="-1"></a>    <span class="at">CENTROID =</span> <span class="fu">na_if</span>(has_centroid, <span class="cn">FALSE</span>),</span>
<span id="cb34-433"><a href="#cb34-433" aria-hidden="true" tabindex="-1"></a>    <span class="at">FOOTPRINT =</span> <span class="fu">na_if</span>(has_footprint, <span class="cn">FALSE</span>),</span>
<span id="cb34-434"><a href="#cb34-434" aria-hidden="true" tabindex="-1"></a>    <span class="at">SERVICE_AREA =</span> <span class="fu">na_if</span>(has_service_area, <span class="cn">FALSE</span>)</span>
<span id="cb34-435"><a href="#cb34-435" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-436"><a href="#cb34-436" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unselect the original geom columns</span></span>
<span id="cb34-437"><a href="#cb34-437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(has_centroid, has_footprint, has_service_area)) <span class="sc">%&gt;%</span></span>
<span id="cb34-438"><a href="#cb34-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-439"><a href="#cb34-439" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Now this summarise/across will work correctly</span></span>
<span id="cb34-440"><a href="#cb34-440" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.)))) <span class="sc">%&gt;%</span></span>
<span id="cb34-441"><a href="#cb34-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-442"><a href="#cb34-442" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to long data </span></span>
<span id="cb34-443"><a href="#cb34-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Field"</span>, <span class="at">values_to =</span> <span class="st">"Missing_Count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-444"><a href="#cb34-444" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate as a proportion (0-1) so fmt_percent() works perfectly</span></span>
<span id="cb34-445"><a href="#cb34-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Missing_Proportion =</span> Missing_Count <span class="sc">/</span> <span class="fu">nrow</span>(data)) <span class="sc">%&gt;%</span></span>
<span id="cb34-446"><a href="#cb34-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Missing_Count <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-447"><a href="#cb34-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Missing_Count))</span>
<span id="cb34-448"><a href="#cb34-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-449"><a href="#cb34-449" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(missing_analysis) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb34-450"><a href="#cb34-450" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-451"><a href="#cb34-451" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the count for the subtitle</span></span>
<span id="cb34-452"><a href="#cb34-452" aria-hidden="true" tabindex="-1"></a>  num_missing_vars <span class="ot">&lt;-</span> <span class="fu">nrow</span>(missing_analysis)</span>
<span id="cb34-453"><a href="#cb34-453" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-454"><a href="#cb34-454" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Display the detailed gt table</span></span>
<span id="cb34-455"><a href="#cb34-455" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-456"><a href="#cb34-456" aria-hidden="true" tabindex="-1"></a>    missing_analysis <span class="sc">%&gt;%</span></span>
<span id="cb34-457"><a href="#cb34-457" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-458"><a href="#cb34-458" aria-hidden="true" tabindex="-1"></a>      <span class="co"># --- Data-specific formatting ---</span></span>
<span id="cb34-459"><a href="#cb34-459" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cols_label</span>(</span>
<span id="cb34-460"><a href="#cb34-460" aria-hidden="true" tabindex="-1"></a>        <span class="at">Field =</span> <span class="st">"Field"</span>,</span>
<span id="cb34-461"><a href="#cb34-461" aria-hidden="true" tabindex="-1"></a>        <span class="at">Missing_Count =</span> <span class="st">"Missing Count"</span>,</span>
<span id="cb34-462"><a href="#cb34-462" aria-hidden="true" tabindex="-1"></a>        <span class="at">Missing_Proportion =</span> <span class="st">"Missing (%)"</span></span>
<span id="cb34-463"><a href="#cb34-463" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb34-464"><a href="#cb34-464" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Format the count with commas and no decimals</span></span>
<span id="cb34-465"><a href="#cb34-465" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fmt_number</span>(</span>
<span id="cb34-466"><a href="#cb34-466" aria-hidden="true" tabindex="-1"></a>        <span class="at">columns =</span> Missing_Count,</span>
<span id="cb34-467"><a href="#cb34-467" aria-hidden="true" tabindex="-1"></a>        <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb34-468"><a href="#cb34-468" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb34-469"><a href="#cb34-469" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Format the proportion into a percentage</span></span>
<span id="cb34-470"><a href="#cb34-470" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fmt_percent</span>(</span>
<span id="cb34-471"><a href="#cb34-471" aria-hidden="true" tabindex="-1"></a>        <span class="at">columns =</span> Missing_Proportion,</span>
<span id="cb34-472"><a href="#cb34-472" aria-hidden="true" tabindex="-1"></a>        <span class="at">decimals =</span> <span class="dv">1</span></span>
<span id="cb34-473"><a href="#cb34-473" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb34-474"><a href="#cb34-474" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb34-475"><a href="#cb34-475" aria-hidden="true" tabindex="-1"></a>      <span class="co"># --- Apply your consistent theme ---</span></span>
<span id="cb34-476"><a href="#cb34-476" aria-hidden="true" tabindex="-1"></a>      <span class="fu">style_table</span>(</span>
<span id="cb34-477"><a href="#cb34-477" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="st">"**Missing Data Overview**"</span>,</span>
<span id="cb34-478"><a href="#cb34-478" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"{num_missing_vars} field(s) have missing values."</span>)</span>
<span id="cb34-479"><a href="#cb34-479" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb34-480"><a href="#cb34-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-481"><a href="#cb34-481" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb34-482"><a href="#cb34-482" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is fine, or you could use a gt-styled message</span></span>
<span id="cb34-483"><a href="#cb34-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"No missing data detected in the main dataset."</span>)</span>
<span id="cb34-484"><a href="#cb34-484" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-485"><a href="#cb34-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-486"><a href="#cb34-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-487"><a href="#cb34-487" aria-hidden="true" tabindex="-1"></a>Many of the columns aren't super important (secondary office list, secondary district list, website/URL fields). However, there are a few we should note that have significant amounts of missing data:</span>
<span id="cb34-488"><a href="#cb34-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-489"><a href="#cb34-489" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Footprint</span>
<span id="cb34-490"><a href="#cb34-490" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Service Area</span>
<span id="cb34-491"><a href="#cb34-491" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Total Acres</span>
<span id="cb34-492"><a href="#cb34-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-493"><a href="#cb34-493" aria-hidden="true" tabindex="-1"></a>These three fields might come in useful later for calculating total area offset or other metrics of interest. Let's now dive specifically into the spatial data quality.</span>
<span id="cb34-494"><a href="#cb34-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-495"><a href="#cb34-495" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spatial Data Quality</span></span>
<span id="cb34-496"><a href="#cb34-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-499"><a href="#cb34-499" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-500"><a href="#cb34-500" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: spatial-data-quality</span></span>
<span id="cb34-501"><a href="#cb34-501" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-502"><a href="#cb34-502" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-503"><a href="#cb34-503" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-504"><a href="#cb34-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-505"><a href="#cb34-505" aria-hidden="true" tabindex="-1"></a><span class="co"># Build flags to see what data exists</span></span>
<span id="cb34-506"><a href="#cb34-506" aria-hidden="true" tabindex="-1"></a>spat_flags <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb34-507"><a href="#cb34-507" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-508"><a href="#cb34-508" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Only choose banks in dataset</span></span>
<span id="cb34-509"><a href="#cb34-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(bank_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-510"><a href="#cb34-510" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-511"><a href="#cb34-511" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create new dataframe with specified columns</span></span>
<span id="cb34-512"><a href="#cb34-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb34-513"><a href="#cb34-513" aria-hidden="true" tabindex="-1"></a>    bank_id,</span>
<span id="cb34-514"><a href="#cb34-514" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_centroid      =</span> has_centroid,</span>
<span id="cb34-515"><a href="#cb34-515" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_footprint     =</span> has_footprint,</span>
<span id="cb34-516"><a href="#cb34-516" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_service_area  =</span> has_service_area,</span>
<span id="cb34-517"><a href="#cb34-517" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_total_acres   =</span> <span class="sc">!</span><span class="fu">is.na</span>(total_acres), <span class="co"># Already a TRUE/FALSE flag</span></span>
<span id="cb34-518"><a href="#cb34-518" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb34-519"><a href="#cb34-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-520"><a href="#cb34-520" aria-hidden="true" tabindex="-1"></a><span class="co"># Counter for the number of total banks</span></span>
<span id="cb34-521"><a href="#cb34-521" aria-hidden="true" tabindex="-1"></a>n_banks <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(spat_flags<span class="sc">$</span>bank_id)</span>
<span id="cb34-522"><a href="#cb34-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-523"><a href="#cb34-523" aria-hidden="true" tabindex="-1"></a><span class="co"># overall coverage</span></span>
<span id="cb34-524"><a href="#cb34-524" aria-hidden="true" tabindex="-1"></a>overall_cov <span class="ot">&lt;-</span> spat_flags <span class="sc">%&gt;%</span></span>
<span id="cb34-525"><a href="#cb34-525" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summarise all the TRUE/FALSE columns.</span></span>
<span id="cb34-526"><a href="#cb34-526" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sum(column, na.rm = TRUE) counts all the TRUEs.</span></span>
<span id="cb34-527"><a href="#cb34-527" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-528"><a href="#cb34-528" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Has centroid</span><span class="st">`</span>      <span class="ot">=</span> <span class="fu">sum</span>(has_centroid,     <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-529"><a href="#cb34-529" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Has footprint</span><span class="st">`</span>     <span class="ot">=</span> <span class="fu">sum</span>(has_footprint,    <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-530"><a href="#cb34-530" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Has service area</span><span class="st">`</span>  <span class="ot">=</span> <span class="fu">sum</span>(has_service_area, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb34-531"><a href="#cb34-531" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">Has total acres</span><span class="st">`</span>   <span class="ot">=</span> <span class="fu">sum</span>(has_total_acres,  <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-532"><a href="#cb34-532" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-533"><a href="#cb34-533" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"Field"</span>, <span class="at">values_to =</span> <span class="st">"Count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-534"><a href="#cb34-534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-535"><a href="#cb34-535" aria-hidden="true" tabindex="-1"></a>    <span class="at">Proportion =</span> Count <span class="sc">/</span> n_banks <span class="co"># Calculate 0-1 proportion for gt</span></span>
<span id="cb34-536"><a href="#cb34-536" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-537"><a href="#cb34-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-538"><a href="#cb34-538" aria-hidden="true" tabindex="-1"></a><span class="co"># Print this using a gt table</span></span>
<span id="cb34-539"><a href="#cb34-539" aria-hidden="true" tabindex="-1"></a>  overall_cov <span class="sc">%&gt;%</span></span>
<span id="cb34-540"><a href="#cb34-540" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-541"><a href="#cb34-541" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb34-542"><a href="#cb34-542" aria-hidden="true" tabindex="-1"></a>      <span class="at">Field =</span> <span class="st">"Flag"</span>,</span>
<span id="cb34-543"><a href="#cb34-543" aria-hidden="true" tabindex="-1"></a>      <span class="at">Count =</span> <span class="st">"Count"</span>,</span>
<span id="cb34-544"><a href="#cb34-544" aria-hidden="true" tabindex="-1"></a>      <span class="at">Proportion =</span> <span class="st">"Percent"</span></span>
<span id="cb34-545"><a href="#cb34-545" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-546"><a href="#cb34-546" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_percent</span>(</span>
<span id="cb34-547"><a href="#cb34-547" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> Proportion,</span>
<span id="cb34-548"><a href="#cb34-548" aria-hidden="true" tabindex="-1"></a>      <span class="at">decimals =</span> <span class="dv">1</span></span>
<span id="cb34-549"><a href="#cb34-549" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-550"><a href="#cb34-550" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(</span>
<span id="cb34-551"><a href="#cb34-551" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> Count,</span>
<span id="cb34-552"><a href="#cb34-552" aria-hidden="true" tabindex="-1"></a>      <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb34-553"><a href="#cb34-553" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-554"><a href="#cb34-554" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply your consistent theme</span></span>
<span id="cb34-555"><a href="#cb34-555" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb34-556"><a href="#cb34-556" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"**Spatial Data Coverage**"</span>,</span>
<span id="cb34-557"><a href="#cb34-557" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Based on {n_banks} banks"</span>)</span>
<span id="cb34-558"><a href="#cb34-558" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-559"><a href="#cb34-559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-560"><a href="#cb34-560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-561"><a href="#cb34-561" aria-hidden="true" tabindex="-1"></a><span class="fu">### Footprint and Total Acres Coverage</span></span>
<span id="cb34-562"><a href="#cb34-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-563"><a href="#cb34-563" aria-hidden="true" tabindex="-1"></a>For future analyses, we might also want to know the total area made up by the banks. We can calculate this either using the total_acres column, or by extracting the area from the bank footprint polygon. Let's check what banks have areal information (either the footprint, the total acreage, both, or none).</span>
<span id="cb34-564"><a href="#cb34-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-567"><a href="#cb34-567" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-568"><a href="#cb34-568" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: footprint-vs-acres</span></span>
<span id="cb34-569"><a href="#cb34-569" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-570"><a href="#cb34-570" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-571"><a href="#cb34-571" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-572"><a href="#cb34-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-573"><a href="#cb34-573" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the table dataframe </span></span>
<span id="cb34-574"><a href="#cb34-574" aria-hidden="true" tabindex="-1"></a>footprint_acres <span class="ot">&lt;-</span> spat_flags <span class="sc">%&gt;%</span></span>
<span id="cb34-575"><a href="#cb34-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-576"><a href="#cb34-576" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb34-577"><a href="#cb34-577" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to yes/no</span></span>
<span id="cb34-578"><a href="#cb34-578" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_footprint =</span> <span class="fu">ifelse</span>(has_footprint, <span class="st">"Yes"</span>, <span class="st">"No"</span>),</span>
<span id="cb34-579"><a href="#cb34-579" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_acres     =</span> <span class="fu">ifelse</span>(has_total_acres, <span class="st">"Yes"</span>, <span class="st">"No"</span>)</span>
<span id="cb34-580"><a href="#cb34-580" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-581"><a href="#cb34-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-582"><a href="#cb34-582" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count the number of banks that have footprint / total acres</span></span>
<span id="cb34-583"><a href="#cb34-583" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(has_footprint, has_acres, <span class="at">name =</span> <span class="st">"Banks"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-584"><a href="#cb34-584" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-585"><a href="#cb34-585" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to a percentage </span></span>
<span id="cb34-586"><a href="#cb34-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Share =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> Banks <span class="sc">/</span> <span class="fu">sum</span>(Banks), <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-587"><a href="#cb34-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Banks))</span>
<span id="cb34-588"><a href="#cb34-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-589"><a href="#cb34-589" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a GT table</span></span>
<span id="cb34-590"><a href="#cb34-590" aria-hidden="true" tabindex="-1"></a>footprint_acres <span class="sc">%&gt;%</span></span>
<span id="cb34-591"><a href="#cb34-591" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-592"><a href="#cb34-592" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb34-593"><a href="#cb34-593" aria-hidden="true" tabindex="-1"></a>      <span class="at">has_footprint =</span> <span class="st">"Has footprint"</span>,</span>
<span id="cb34-594"><a href="#cb34-594" aria-hidden="true" tabindex="-1"></a>      <span class="at">has_acres     =</span> <span class="st">"Has total acres"</span>,</span>
<span id="cb34-595"><a href="#cb34-595" aria-hidden="true" tabindex="-1"></a>      <span class="at">Share         =</span> <span class="st">"Share (%)"</span></span>
<span id="cb34-596"><a href="#cb34-596" aria-hidden="true" tabindex="-1"></a>    )  <span class="sc">%&gt;%</span></span>
<span id="cb34-597"><a href="#cb34-597" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb34-598"><a href="#cb34-598" aria-hidden="true" tabindex="-1"></a>      <span class="at">title    =</span> <span class="st">"**Data Availability: Footprint  Total Acres**"</span>,</span>
<span id="cb34-599"><a href="#cb34-599" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {n_banks} banks"</span>))</span>
<span id="cb34-600"><a href="#cb34-600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-601"><a href="#cb34-601" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-602"><a href="#cb34-602" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-603"><a href="#cb34-603" aria-hidden="true" tabindex="-1"></a>There is fairly complete information on spatial area - only 572 banks (11.6%) have no footprint or total acreage information.</span>
<span id="cb34-604"><a href="#cb34-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-605"><a href="#cb34-605" aria-hidden="true" tabindex="-1"></a><span class="fu">### Footprint and Total Acres Alignment</span></span>
<span id="cb34-606"><a href="#cb34-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-607"><a href="#cb34-607" aria-hidden="true" tabindex="-1"></a>A quick inspection of the data seems like there might be discrepancies between the area calculated from the <span class="in">`BANK_FOOTPRINT`</span> geometry against the <span class="in">`total_acres`</span> value reported in the data. To compare, we first need to ensure the area is calculated correctly. Geometries are often stored in a geographic CRS (like WGS84, EPSG:4326), where units are in degrees. To get an accurate area in meters, we must first transform the data into a projected, equal-area CRS. For the continental U.S., the Albers Equal Area projection (EPSG:5070) is a standard choice.</span>
<span id="cb34-608"><a href="#cb34-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-609"><a href="#cb34-609" aria-hidden="true" tabindex="-1"></a>Below, I transform the spatial data, convert area into square meters, convert square meters into acres, and then compare the values of total acres listed to the calculated total acres.</span>
<span id="cb34-610"><a href="#cb34-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-613"><a href="#cb34-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-614"><a href="#cb34-614" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: footprint-acres-alignment-plot</span></span>
<span id="cb34-615"><a href="#cb34-615" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-616"><a href="#cb34-616" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-617"><a href="#cb34-617" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-618"><a href="#cb34-618" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Prepare the data for area calculation</span></span>
<span id="cb34-619"><a href="#cb34-619" aria-hidden="true" tabindex="-1"></a><span class="co"># The CRS is missing and the dataframe is not a true sf object. We need to explicitly create an sf object from the footprint data and set its CRS before transforming. WGS84 (EPSG:4326) is a safe assumption for GeoJSON data.</span></span>
<span id="cb34-620"><a href="#cb34-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-621"><a href="#cb34-621" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the original and target CRS</span></span>
<span id="cb34-622"><a href="#cb34-622" aria-hidden="true" tabindex="-1"></a>initial_crs <span class="ot">&lt;-</span> <span class="dv">4326</span> <span class="co"># WGS84</span></span>
<span id="cb34-623"><a href="#cb34-623" aria-hidden="true" tabindex="-1"></a>target_crs <span class="ot">&lt;-</span> <span class="dv">5070</span>  <span class="co"># Albers Equal Area for US</span></span>
<span id="cb34-624"><a href="#cb34-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-625"><a href="#cb34-625" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a valid sf object from the footprint data</span></span>
<span id="cb34-626"><a href="#cb34-626" aria-hidden="true" tabindex="-1"></a>footprints_sf <span class="ot">&lt;-</span> banks_geometries <span class="sc">%&gt;%</span></span>
<span id="cb34-627"><a href="#cb34-627" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep only banks with a footprint geometry</span></span>
<span id="cb34-628"><a href="#cb34-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">sapply</span>(footprint, <span class="cf">function</span>(x) <span class="fu">is.null</span>(x) <span class="sc">||</span> <span class="fu">st_is_empty</span>(x))) <span class="sc">%&gt;%</span></span>
<span id="cb34-629"><a href="#cb34-629" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to a proper sf object, specifying the geometry column</span></span>
<span id="cb34-630"><a href="#cb34-630" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">sf_column_name =</span> <span class="st">"footprint"</span>, <span class="at">crs =</span> initial_crs)</span>
<span id="cb34-631"><a href="#cb34-631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-632"><a href="#cb34-632" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Calculate area</span></span>
<span id="cb34-633"><a href="#cb34-633" aria-hidden="true" tabindex="-1"></a>footprint_areas <span class="ot">&lt;-</span> footprints_sf <span class="sc">%&gt;%</span></span>
<span id="cb34-634"><a href="#cb34-634" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transform to an equal-area projection</span></span>
<span id="cb34-635"><a href="#cb34-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs =</span> target_crs) <span class="sc">%&gt;%</span></span>
<span id="cb34-636"><a href="#cb34-636" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate area in square meters, then convert to acres</span></span>
<span id="cb34-637"><a href="#cb34-637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-638"><a href="#cb34-638" aria-hidden="true" tabindex="-1"></a>    <span class="at">calculated_acres =</span> <span class="fu">as.numeric</span>(<span class="fu">st_area</span>(footprint)) <span class="sc">/</span> <span class="fl">4046.86</span></span>
<span id="cb34-639"><a href="#cb34-639" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-640"><a href="#cb34-640" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We only need the ID and the calculated area</span></span>
<span id="cb34-641"><a href="#cb34-641" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-642"><a href="#cb34-642" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id, calculated_acres)</span>
<span id="cb34-643"><a href="#cb34-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-644"><a href="#cb34-644" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Join calculated area with reported acres</span></span>
<span id="cb34-645"><a href="#cb34-645" aria-hidden="true" tabindex="-1"></a>comparison_df <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb34-646"><a href="#cb34-646" aria-hidden="true" tabindex="-1"></a>  <span class="co"># We only need total_acres for comparison</span></span>
<span id="cb34-647"><a href="#cb34-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id, total_acres) <span class="sc">%&gt;%</span></span>
<span id="cb34-648"><a href="#cb34-648" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Join the calculated areas</span></span>
<span id="cb34-649"><a href="#cb34-649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(footprint_areas, <span class="at">by =</span> <span class="st">"bank_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-650"><a href="#cb34-650" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter out cases with no reported acres</span></span>
<span id="cb34-651"><a href="#cb34-651" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(total_acres) <span class="sc">&amp;</span> total_acres <span class="sc">&gt;</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-652"><a href="#cb34-652" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the discrepancy ratio</span></span>
<span id="cb34-653"><a href="#cb34-653" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-654"><a href="#cb34-654" aria-hidden="true" tabindex="-1"></a>    <span class="at">discrepancy_ratio =</span> calculated_acres <span class="sc">/</span> total_acres</span>
<span id="cb34-655"><a href="#cb34-655" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-656"><a href="#cb34-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-657"><a href="#cb34-657" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Visualize the comparison</span></span>
<span id="cb34-658"><a href="#cb34-658" aria-hidden="true" tabindex="-1"></a><span class="co"># A scatter plot is ideal for this. A 1:1 line shows where perfect agreement lies.</span></span>
<span id="cb34-659"><a href="#cb34-659" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison_df, <span class="fu">aes</span>(<span class="at">x =</span> total_acres, <span class="at">y =</span> calculated_acres)) <span class="sc">+</span></span>
<span id="cb34-660"><a href="#cb34-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb34-661"><a href="#cb34-661" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a 1:1 line for perfect agreement</span></span>
<span id="cb34-662"><a href="#cb34-662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb34-663"><a href="#cb34-663" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use a log scale to handle the wide range of values</span></span>
<span id="cb34-664"><a href="#cb34-664" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb34-665"><a href="#cb34-665" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb34-666"><a href="#cb34-666" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-667"><a href="#cb34-667" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Footprint Area vs. Reported Acres"</span>,</span>
<span id="cb34-668"><a href="#cb34-668" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {nrow(comparison_df)} banks"</span>),</span>
<span id="cb34-669"><a href="#cb34-669" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Reported Total Acres (log scale)"</span>,</span>
<span id="cb34-670"><a href="#cb34-670" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Calculated Footprint Acres (log scale)"</span></span>
<span id="cb34-671"><a href="#cb34-671" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-672"><a href="#cb34-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-673"><a href="#cb34-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb34-674"><a href="#cb34-674" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title    =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb34-675"><a href="#cb34-675" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb34-676"><a href="#cb34-676" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb34-677"><a href="#cb34-677" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb34-678"><a href="#cb34-678" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">+</span></span>
<span id="cb34-679"><a href="#cb34-679" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>() <span class="co"># Ensures the 1:1 line is visually accurate</span></span>
<span id="cb34-680"><a href="#cb34-680" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-681"><a href="#cb34-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-682"><a href="#cb34-682" aria-hidden="true" tabindex="-1"></a>There are <span class="in">`r nrow(footprint_areas)`</span> banks with footprint information, and <span class="in">`r nrow(comparison_df)`</span> banks with both reported acres and a valid footprint to compare.</span>
<span id="cb34-683"><a href="#cb34-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-684"><a href="#cb34-684" aria-hidden="true" tabindex="-1"></a>The plot above generally shows a correlation between the reported <span class="in">`total_acres`</span> and the area calculated from the footprint geometries. I would not call this a great plot though - there is a lot of dispersion around the line, and in theory, the reported acreage and the calculated acreage should be exactly the same. However, we are seeing:</span>
<span id="cb34-685"><a href="#cb34-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-686"><a href="#cb34-686" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Under-reported Area**: Points below the line, where the calculated footprint area is *smaller* than the reported total acres. This could be because <span class="in">`total_acres`</span> refers to the entire property parcel, while the footprint only covers the actual mitigation area.</span>
<span id="cb34-687"><a href="#cb34-687" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Over-reported Area**: Points above the line, where the calculated footprint is significantly *larger* than the reported acreage. These are a bit more more concerning, as it signals data entry errors in <span class="in">`total_acres`</span> or an incorrect footprint geometry.</span>
<span id="cb34-688"><a href="#cb34-688" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Outliers**: A few points are far from the line, representing significant discrepancies. These are likely service area polygons that were misattributed to the footprint column in RIBITS.</span>
<span id="cb34-689"><a href="#cb34-689" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-690"><a href="#cb34-690" aria-hidden="true" tabindex="-1"></a>Let's check how many banks actually fall significantly outside of the line. Here, I plot the data as a histogram, with the 1:1 ratio line in black, with grey lines at 0.5 and 2 to indicate an acceptable "margin of error" (i.e. banks with reported areas either half as small or twice as large as the calculated area). We may want to think about what is an acceptable margin of error for further analyses.</span>
<span id="cb34-691"><a href="#cb34-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-694"><a href="#cb34-694" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-695"><a href="#cb34-695" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: discrepancy-ratio-histogram</span></span>
<span id="cb34-696"><a href="#cb34-696" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-697"><a href="#cb34-697" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-698"><a href="#cb34-698" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-699"><a href="#cb34-699" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-700"><a href="#cb34-700" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of the Discrepancy Ratio</span></span>
<span id="cb34-701"><a href="#cb34-701" aria-hidden="true" tabindex="-1"></a>discrepancy_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparison_df, <span class="fu">aes</span>(<span class="at">x =</span> discrepancy_ratio)) <span class="sc">+</span></span>
<span id="cb34-702"><a href="#cb34-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">100</span>, <span class="at">fill =</span> <span class="st">"dodgerblue"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb34-703"><a href="#cb34-703" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use a log10 scale to see the distribution of extreme outliers</span></span>
<span id="cb34-704"><a href="#cb34-704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>, <span class="dv">10000</span>)) <span class="sc">+</span></span>
<span id="cb34-705"><a href="#cb34-705" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add vertical lines at key thresholds for context</span></span>
<span id="cb34-706"><a href="#cb34-706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">1.0</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb34-707"><a href="#cb34-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">2.0</span>), <span class="at">color =</span> <span class="st">"grey"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb34-708"><a href="#cb34-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-709"><a href="#cb34-709" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Discrepancy Ratios"</span>,</span>
<span id="cb34-710"><a href="#cb34-710" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {nrow(comparison_df)} banks"</span>),</span>
<span id="cb34-711"><a href="#cb34-711" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Discrepancy Ratio (Geometric Area / Listed Area) - Log Scale"</span>,</span>
<span id="cb34-712"><a href="#cb34-712" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb34-713"><a href="#cb34-713" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-714"><a href="#cb34-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb34-715"><a href="#cb34-715" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb34-716"><a href="#cb34-716" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title    =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb34-717"><a href="#cb34-717" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb34-718"><a href="#cb34-718" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.x  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb34-719"><a href="#cb34-719" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb34-720"><a href="#cb34-720" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-721"><a href="#cb34-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-722"><a href="#cb34-722" aria-hidden="true" tabindex="-1"></a>discrepancy_plot</span>
<span id="cb34-723"><a href="#cb34-723" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-724"><a href="#cb34-724" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-725"><a href="#cb34-725" aria-hidden="true" tabindex="-1"></a>We see a large peak near 1.0, which is good. But we also see fairly long tails to both the right and left, as well as a decent amount of banks just outside the "margin of error". Let's check the top 20 "worst" (i.e., most misaligned) banks.</span>
<span id="cb34-726"><a href="#cb34-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-729"><a href="#cb34-729" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-730"><a href="#cb34-730" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: discrepancy-ratio-table-top-twenty</span></span>
<span id="cb34-731"><a href="#cb34-731" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-732"><a href="#cb34-732" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-733"><a href="#cb34-733" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-734"><a href="#cb34-734" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-735"><a href="#cb34-735" aria-hidden="true" tabindex="-1"></a><span class="co"># Create table of top 20 banks with greatest discrepancy</span></span>
<span id="cb34-736"><a href="#cb34-736" aria-hidden="true" tabindex="-1"></a>top_discrepancies <span class="ot">&lt;-</span> comparison_df <span class="sc">%&gt;%</span></span>
<span id="cb34-737"><a href="#cb34-737" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a column for absolute distance from a perfect ratio of 1</span></span>
<span id="cb34-738"><a href="#cb34-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">abs_log_ratio =</span> <span class="fu">abs</span>(<span class="fu">log10</span>(discrepancy_ratio))) <span class="sc">%&gt;%</span></span>
<span id="cb34-739"><a href="#cb34-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(abs_log_ratio)) <span class="sc">%&gt;%</span></span>
<span id="cb34-740"><a href="#cb34-740" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>)</span>
<span id="cb34-741"><a href="#cb34-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-742"><a href="#cb34-742" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the table </span></span>
<span id="cb34-743"><a href="#cb34-743" aria-hidden="true" tabindex="-1"></a>  top_discrepancies <span class="sc">%&gt;%</span></span>
<span id="cb34-744"><a href="#cb34-744" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-745"><a href="#cb34-745" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb34-746"><a href="#cb34-746" aria-hidden="true" tabindex="-1"></a>      <span class="at">bank_id       =</span> <span class="st">"Bank ID"</span>,</span>
<span id="cb34-747"><a href="#cb34-747" aria-hidden="true" tabindex="-1"></a>      <span class="at">total_acres   =</span> <span class="st">"Listed Total Acres"</span>,</span>
<span id="cb34-748"><a href="#cb34-748" aria-hidden="true" tabindex="-1"></a>      <span class="at">calculated_acres =</span> <span class="st">"Calculated Total Acres"</span>,</span>
<span id="cb34-749"><a href="#cb34-749" aria-hidden="true" tabindex="-1"></a>      <span class="at">discrepancy_ratio  =</span> <span class="st">"Discrepancy Ratio"</span></span>
<span id="cb34-750"><a href="#cb34-750" aria-hidden="true" tabindex="-1"></a>    )  <span class="sc">%&gt;%</span></span>
<span id="cb34-751"><a href="#cb34-751" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb34-752"><a href="#cb34-752" aria-hidden="true" tabindex="-1"></a>      <span class="at">title    =</span> <span class="st">"**Top 20 Highest Area/Footprint Discrepancies**"</span>,</span>
<span id="cb34-753"><a href="#cb34-753" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {nrow(comparison_df)} banks"</span>))</span>
<span id="cb34-754"><a href="#cb34-754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-755"><a href="#cb34-755" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-756"><a href="#cb34-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-757"><a href="#cb34-757" aria-hidden="true" tabindex="-1"></a>Clearly these are incorrect and likely just service area polygons listed as footprints. However, all of this makes it a bit difficult to trust the RIBITS data - many calculated area values are either higher or lower than the reported values, so knowing which is the "true" value is unclear. For any analyses, we may want to:</span>
<span id="cb34-758"><a href="#cb34-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-759"><a href="#cb34-759" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Define our margin of error (how big/small can the area discrepancy ratio be)</span>
<span id="cb34-760"><a href="#cb34-760" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Remove all banks that fall outside of that margin of error</span>
<span id="cb34-761"><a href="#cb34-761" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>Then calculate downstream stats</span>
<span id="cb34-762"><a href="#cb34-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-763"><a href="#cb34-763" aria-hidden="true" tabindex="-1"></a>If we don't, we may run the risk of over-inflating any area counts.</span>
<span id="cb34-764"><a href="#cb34-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-765"><a href="#cb34-765" aria-hidden="true" tabindex="-1"></a><span class="fu">## Bank Characteristics</span></span>
<span id="cb34-766"><a href="#cb34-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-767"><a href="#cb34-767" aria-hidden="true" tabindex="-1"></a>Let's now move on to exploring the variables in the RIBITS extract.</span>
<span id="cb34-768"><a href="#cb34-768" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-769"><a href="#cb34-769" aria-hidden="true" tabindex="-1"></a><span class="fu">### Spatial Distribution</span></span>
<span id="cb34-770"><a href="#cb34-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-771"><a href="#cb34-771" aria-hidden="true" tabindex="-1"></a>Let's see where the banks are, and how their spatial distribution varies by state and district. First, I will plot the centroids on a map of the U.S.</span>
<span id="cb34-772"><a href="#cb34-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-775"><a href="#cb34-775" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-776"><a href="#cb34-776" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: bank-national-distribution-map</span></span>
<span id="cb34-777"><a href="#cb34-777" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-778"><a href="#cb34-778" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-cap: "Distribution of RIBITS bank centroids across the United States."</span></span>
<span id="cb34-779"><a href="#cb34-779" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb34-780"><a href="#cb34-780" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb34-781"><a href="#cb34-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-782"><a href="#cb34-782" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare the centroid data for plotting</span></span>
<span id="cb34-783"><a href="#cb34-783" aria-hidden="true" tabindex="-1"></a><span class="co"># We need a clean sf object with a valid CRS.</span></span>
<span id="cb34-784"><a href="#cb34-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-785"><a href="#cb34-785" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a valid sf object from the centroid data</span></span>
<span id="cb34-786"><a href="#cb34-786" aria-hidden="true" tabindex="-1"></a>centroids_sf <span class="ot">&lt;-</span> banks_geometries <span class="sc">%&gt;%</span></span>
<span id="cb34-787"><a href="#cb34-787" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Keep only banks with a centroid geometry</span></span>
<span id="cb34-788"><a href="#cb34-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">sapply</span>(centroid, <span class="cf">function</span>(x) <span class="fu">is.null</span>(x) <span class="sc">||</span> <span class="fu">st_is_empty</span>(x))) <span class="sc">%&gt;%</span></span>
<span id="cb34-789"><a href="#cb34-789" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to a proper sf object</span></span>
<span id="cb34-790"><a href="#cb34-790" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">sf_column_name =</span> <span class="st">"centroid"</span>, <span class="at">crs =</span> <span class="dv">4326</span>) <span class="co"># Assume WGS84</span></span>
<span id="cb34-791"><a href="#cb34-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-792"><a href="#cb34-792" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Prepared"</span>, <span class="fu">nrow</span>(centroids_sf), <span class="st">"centroids for plotting.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-793"><a href="#cb34-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-794"><a href="#cb34-794" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Get base map data using rnaturalearth to get country and state boundaries.</span></span>
<span id="cb34-795"><a href="#cb34-795" aria-hidden="true" tabindex="-1"></a>world <span class="ot">&lt;-</span> <span class="fu">ne_countries</span>(<span class="at">scale =</span> <span class="st">"medium"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb34-796"><a href="#cb34-796" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">ne_states</span>(<span class="at">country =</span> <span class="st">"United States of America"</span>, <span class="at">returnclass =</span> <span class="st">"sf"</span>)</span>
<span id="cb34-797"><a href="#cb34-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-798"><a href="#cb34-798" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create the map</span></span>
<span id="cb34-799"><a href="#cb34-799" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-800"><a href="#cb34-800" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a base layer for the world, filled with a light grey</span></span>
<span id="cb34-801"><a href="#cb34-801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world, <span class="at">fill =</span> <span class="st">"gray90"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb34-802"><a href="#cb34-802" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add US state boundaries</span></span>
<span id="cb34-803"><a href="#cb34-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> states, <span class="at">fill =</span> <span class="st">"gray80"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb34-804"><a href="#cb34-804" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the bank centroids on top</span></span>
<span id="cb34-805"><a href="#cb34-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb34-806"><a href="#cb34-806" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> centroids_sf,</span>
<span id="cb34-807"><a href="#cb34-807" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb34-808"><a href="#cb34-808" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.5</span>,</span>
<span id="cb34-809"><a href="#cb34-809" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.4</span>,</span>
<span id="cb34-810"><a href="#cb34-810" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">16</span></span>
<span id="cb34-811"><a href="#cb34-811" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-812"><a href="#cb34-812" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set the coordinate system and limits.</span></span>
<span id="cb34-813"><a href="#cb34-813" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This zooms the map to show the continental US, Alaska, Hawaii, and the Caribbean.</span></span>
<span id="cb34-814"><a href="#cb34-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb34-815"><a href="#cb34-815" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">180</span>, <span class="sc">-</span><span class="dv">65</span>),</span>
<span id="cb34-816"><a href="#cb34-816" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">72</span>),</span>
<span id="cb34-817"><a href="#cb34-817" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-818"><a href="#cb34-818" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">4326</span> <span class="co"># Use WGS84 projection</span></span>
<span id="cb34-819"><a href="#cb34-819" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-820"><a href="#cb34-820" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-821"><a href="#cb34-821" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"National Distribution of Sites"</span>,</span>
<span id="cb34-822"><a href="#cb34-822" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Each red dot represents one bank centroid."</span></span>
<span id="cb34-823"><a href="#cb34-823" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-824"><a href="#cb34-824" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use a minimal theme suitable for maps</span></span>
<span id="cb34-825"><a href="#cb34-825" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-826"><a href="#cb34-826" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb34-827"><a href="#cb34-827" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"aliceblue"</span>),</span>
<span id="cb34-828"><a href="#cb34-828" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb34-829"><a href="#cb34-829" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb34-830"><a href="#cb34-830" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-831"><a href="#cb34-831" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-832"><a href="#cb34-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-833"><a href="#cb34-833" aria-hidden="true" tabindex="-1"></a>We have a pretty wide geographic distribution of banks, with significant clusters in the eastern and southeastern U.S., the northern midwest (Minnesota), California, the Pacific Northwest, and along the Gulf Coast. There's also coverage in Alaska, and Puerto Rico, interestingly enough. I will now quickly plot the distribution in the conterminous U.S. (lower 48):</span>
<span id="cb34-834"><a href="#cb34-834" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-837"><a href="#cb34-837" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-838"><a href="#cb34-838" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: map-conterminous-us</span></span>
<span id="cb34-839"><a href="#cb34-839" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-840"><a href="#cb34-840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-841"><a href="#cb34-841" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-842"><a href="#cb34-842" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a base layer for the world</span></span>
<span id="cb34-843"><a href="#cb34-843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> world, <span class="at">fill =</span> <span class="st">"gray90"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb34-844"><a href="#cb34-844" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add US state boundaries</span></span>
<span id="cb34-845"><a href="#cb34-845" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> states, <span class="at">fill =</span> <span class="st">"gray80"</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb34-846"><a href="#cb34-846" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add the bank centroids on top</span></span>
<span id="cb34-847"><a href="#cb34-847" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb34-848"><a href="#cb34-848" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> centroids_sf,</span>
<span id="cb34-849"><a href="#cb34-849" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"red"</span>,</span>
<span id="cb34-850"><a href="#cb34-850" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">1.5</span>,</span>
<span id="cb34-851"><a href="#cb34-851" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.4</span>,</span>
<span id="cb34-852"><a href="#cb34-852" aria-hidden="true" tabindex="-1"></a>    <span class="at">shape =</span> <span class="dv">16</span></span>
<span id="cb34-853"><a href="#cb34-853" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-854"><a href="#cb34-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-855"><a href="#cb34-855" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set the coordinate system and limits.</span></span>
<span id="cb34-856"><a href="#cb34-856" aria-hidden="true" tabindex="-1"></a>  <span class="co"># These new coordinates zoom to the conterminous (lower 48) US.</span></span>
<span id="cb34-857"><a href="#cb34-857" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_sf</span>(</span>
<span id="cb34-858"><a href="#cb34-858" aria-hidden="true" tabindex="-1"></a>    <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">125</span>, <span class="sc">-</span><span class="fl">66.5</span>),  <span class="co"># From Washington coast to Maine coast</span></span>
<span id="cb34-859"><a href="#cb34-859" aria-hidden="true" tabindex="-1"></a>    <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">24</span>, <span class="dv">50</span>),     <span class="co"># From Florida keys to Canadian border</span></span>
<span id="cb34-860"><a href="#cb34-860" aria-hidden="true" tabindex="-1"></a>    <span class="at">expand =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-861"><a href="#cb34-861" aria-hidden="true" tabindex="-1"></a>    <span class="at">crs =</span> <span class="dv">4326</span> <span class="co"># Use WGS84 projection</span></span>
<span id="cb34-862"><a href="#cb34-862" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-863"><a href="#cb34-863" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-864"><a href="#cb34-864" aria-hidden="true" tabindex="-1"></a>  <span class="co"># --- UPDATED TITLE ---</span></span>
<span id="cb34-865"><a href="#cb34-865" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-866"><a href="#cb34-866" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Sites (Conterminous US)"</span>,</span>
<span id="cb34-867"><a href="#cb34-867" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Each red dot represents one bank centroid."</span></span>
<span id="cb34-868"><a href="#cb34-868" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-869"><a href="#cb34-869" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-870"><a href="#cb34-870" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use a minimal theme suitable for maps</span></span>
<span id="cb34-871"><a href="#cb34-871" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-872"><a href="#cb34-872" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb34-873"><a href="#cb34-873" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"aliceblue"</span>),</span>
<span id="cb34-874"><a href="#cb34-874" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb34-875"><a href="#cb34-875" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb34-876"><a href="#cb34-876" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-877"><a href="#cb34-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-878"><a href="#cb34-878" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-879"><a href="#cb34-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-880"><a href="#cb34-880" aria-hidden="true" tabindex="-1"></a>Let's break the geographic distribution down by state:</span>
<span id="cb34-881"><a href="#cb34-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-884"><a href="#cb34-884" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-885"><a href="#cb34-885" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calculate-state-stats-geo-summary</span></span>
<span id="cb34-886"><a href="#cb34-886" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-887"><a href="#cb34-887" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false </span></span>
<span id="cb34-888"><a href="#cb34-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-889"><a href="#cb34-889" aria-hidden="true" tabindex="-1"></a><span class="co"># Collapse and count state_list</span></span>
<span id="cb34-890"><a href="#cb34-890" aria-hidden="true" tabindex="-1"></a>res_states   <span class="ot">&lt;-</span> <span class="fu">collapse_and_count</span>(data, state_list, <span class="at">explode =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-891"><a href="#cb34-891" aria-hidden="true" tabindex="-1"></a>state_counts <span class="ot">&lt;-</span> res_states<span class="sc">$</span>counts</span>
<span id="cb34-892"><a href="#cb34-892" aria-hidden="true" tabindex="-1"></a>banks_unique <span class="ot">&lt;-</span> res_states<span class="sc">$</span>bank_level</span>
<span id="cb34-893"><a href="#cb34-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-894"><a href="#cb34-894" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick headline numbers</span></span>
<span id="cb34-895"><a href="#cb34-895" aria-hidden="true" tabindex="-1"></a>n_banks  <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(data<span class="sc">$</span>bank_id)</span>
<span id="cb34-896"><a href="#cb34-896" aria-hidden="true" tabindex="-1"></a>n_states <span class="ot">&lt;-</span> <span class="fu">nrow</span>(state_counts)</span>
<span id="cb34-897"><a href="#cb34-897" aria-hidden="true" tabindex="-1"></a>top_n    <span class="ot">&lt;-</span> <span class="dv">15</span></span>
<span id="cb34-898"><a href="#cb34-898" aria-hidden="true" tabindex="-1"></a>top_slice <span class="ot">&lt;-</span> state_counts <span class="sc">%&gt;%</span> <span class="fu">slice_max</span>(n_banks, <span class="at">n =</span> top_n)</span>
<span id="cb34-899"><a href="#cb34-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-900"><a href="#cb34-900" aria-hidden="true" tabindex="-1"></a><span class="co"># All official 50 states</span></span>
<span id="cb34-901"><a href="#cb34-901" aria-hidden="true" tabindex="-1"></a>us_states <span class="ot">&lt;-</span> state.abb</span>
<span id="cb34-902"><a href="#cb34-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-903"><a href="#cb34-903" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare observed vs official</span></span>
<span id="cb34-904"><a href="#cb34-904" aria-hidden="true" tabindex="-1"></a>states_with_banks <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">unique</span>(state_counts<span class="sc">$</span>token))</span>
<span id="cb34-905"><a href="#cb34-905" aria-hidden="true" tabindex="-1"></a>missing_states    <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(us_states, states_with_banks)</span>
<span id="cb34-906"><a href="#cb34-906" aria-hidden="true" tabindex="-1"></a>extra_codes       <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(states_with_banks, us_states)</span>
<span id="cb34-907"><a href="#cb34-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-908"><a href="#cb34-908" aria-hidden="true" tabindex="-1"></a><span class="co"># Banks missing state info</span></span>
<span id="cb34-909"><a href="#cb34-909" aria-hidden="true" tabindex="-1"></a>n_missing_state <span class="ot">&lt;-</span> banks_unique <span class="sc">%&gt;%</span></span>
<span id="cb34-910"><a href="#cb34-910" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">is.na</span>(state_list)) <span class="sc">%&gt;%</span></span>
<span id="cb34-911"><a href="#cb34-911" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nrow</span>()</span>
<span id="cb34-912"><a href="#cb34-912" aria-hidden="true" tabindex="-1"></a>pct_missing_state <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> n_missing_state <span class="sc">/</span> n_banks, <span class="dv">1</span>)</span>
<span id="cb34-913"><a href="#cb34-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-914"><a href="#cb34-914" aria-hidden="true" tabindex="-1"></a><span class="co"># Create helper variables for prose</span></span>
<span id="cb34-915"><a href="#cb34-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-916"><a href="#cb34-916" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper for the Top N list. This creates a markdown-ready string.</span></span>
<span id="cb34-917"><a href="#cb34-917" aria-hidden="true" tabindex="-1"></a>top_states_md <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"- "</span>, top_slice<span class="sc">$</span>token, <span class="st">": "</span>, top_slice<span class="sc">$</span>n_banks, <span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb34-918"><a href="#cb34-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-919"><a href="#cb34-919" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper for the missing states list</span></span>
<span id="cb34-920"><a href="#cb34-920" aria-hidden="true" tabindex="-1"></a>missing_states_md <span class="ot">&lt;-</span> <span class="fu">paste</span>(missing_states, <span class="at">collapse =</span> <span class="st">', '</span>)</span>
<span id="cb34-921"><a href="#cb34-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-922"><a href="#cb34-922" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper for the extra codes list</span></span>
<span id="cb34-923"><a href="#cb34-923" aria-hidden="true" tabindex="-1"></a>extra_codes_md <span class="ot">&lt;-</span> <span class="fu">paste</span>(extra_codes, <span class="at">collapse =</span> <span class="st">', '</span>)</span>
<span id="cb34-924"><a href="#cb34-924" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-925"><a href="#cb34-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-926"><a href="#cb34-926" aria-hidden="true" tabindex="-1"></a>There are <span class="in">`r n_banks`</span> unique banks represented across <span class="in">`r n_states`</span> states. <span class="in">`r n_missing_state`</span> banks (<span class="in">`r pct_missing_state`</span>%) have no recorded state information. Banks are present in <span class="in">`r length(states_with_banks)`</span> states (plus <span class="in">`r extra_codes_md`</span>). No banks are present in the following <span class="in">`r length(missing_states)`</span> states: <span class="in">`r missing_states_md`</span>. The top <span class="in">`r top_n`</span> states by number of banks:</span>
<span id="cb34-927"><a href="#cb34-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-930"><a href="#cb34-930" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-931"><a href="#cb34-931" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: geo-spread-bar-chart-states</span></span>
<span id="cb34-932"><a href="#cb34-932" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-933"><a href="#cb34-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-934"><a href="#cb34-934" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar chart of the top 15 states</span></span>
<span id="cb34-935"><a href="#cb34-935" aria-hidden="true" tabindex="-1"></a>state_counts <span class="sc">%&gt;%</span></span>
<span id="cb34-936"><a href="#cb34-936" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(n_banks, <span class="at">n =</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-937"><a href="#cb34-937" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(token, n_banks), <span class="at">y =</span> n_banks)) <span class="sc">+</span></span>
<span id="cb34-938"><a href="#cb34-938" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"seagreen2"</span>) <span class="sc">+</span></span>
<span id="cb34-939"><a href="#cb34-939" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_banks),</span>
<span id="cb34-940"><a href="#cb34-940" aria-hidden="true" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>,             <span class="co"># push text a little outside the bar</span></span>
<span id="cb34-941"><a href="#cb34-941" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>             <span class="co"># control text size</span></span>
<span id="cb34-942"><a href="#cb34-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb34-943"><a href="#cb34-943" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-944"><a href="#cb34-944" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Number of Banks by State (Top 15)"</span>,</span>
<span id="cb34-945"><a href="#cb34-945" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"State"</span>,</span>
<span id="cb34-946"><a href="#cb34-946" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb34-947"><a href="#cb34-947" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-948"><a href="#cb34-948" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-949"><a href="#cb34-949" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">max</span>(state_counts<span class="sc">$</span>n_banks, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">1.1</span>)  <span class="co"># add space for labels</span></span>
<span id="cb34-950"><a href="#cb34-950" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-951"><a href="#cb34-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-952"><a href="#cb34-952" aria-hidden="true" tabindex="-1"></a>We can also break it down by USACE District, which is responsible for overseeing the management and reporting on banking.</span>
<span id="cb34-953"><a href="#cb34-953" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-956"><a href="#cb34-956" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-957"><a href="#cb34-957" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-district-counts</span></span>
<span id="cb34-958"><a href="#cb34-958" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-959"><a href="#cb34-959" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-960"><a href="#cb34-960" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the counts for USACE Districts</span></span>
<span id="cb34-961"><a href="#cb34-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-962"><a href="#cb34-962" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename the new count column to 'n_banks'</span></span>
<span id="cb34-963"><a href="#cb34-963" aria-hidden="true" tabindex="-1"></a>district_counts <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb34-964"><a href="#cb34-964" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(district)) <span class="sc">%&gt;%</span>            <span class="co"># Remove any NA district entries</span></span>
<span id="cb34-965"><a href="#cb34-965" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(district, <span class="at">name =</span> <span class="st">"n_banks"</span>) <span class="sc">%&gt;%</span>   <span class="co"># Count banks per district</span></span>
<span id="cb34-966"><a href="#cb34-966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_banks))                <span class="co"># Sort from largest to smallest</span></span>
<span id="cb34-967"><a href="#cb34-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-968"><a href="#cb34-968" aria-hidden="true" tabindex="-1"></a><span class="co"># Bar chart of the top 15 districts</span></span>
<span id="cb34-969"><a href="#cb34-969" aria-hidden="true" tabindex="-1"></a>  district_counts <span class="sc">%&gt;%</span></span>
<span id="cb34-970"><a href="#cb34-970" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_max</span>(n_banks, <span class="at">n =</span> <span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-971"><a href="#cb34-971" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(district, n_banks), <span class="at">y =</span> n_banks)) <span class="sc">+</span> <span class="co"># Swapped 'token' for 'district'</span></span>
<span id="cb34-972"><a href="#cb34-972" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"dodgerblue3"</span>) <span class="sc">+</span>  <span class="co"># Changed color</span></span>
<span id="cb34-973"><a href="#cb34-973" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_banks),</span>
<span id="cb34-974"><a href="#cb34-974" aria-hidden="true" tabindex="-1"></a>              <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>,       <span class="co"># push text a little outside the bar</span></span>
<span id="cb34-975"><a href="#cb34-975" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span>         <span class="co"># (I made the size a bit smaller)</span></span>
<span id="cb34-976"><a href="#cb34-976" aria-hidden="true" tabindex="-1"></a>    <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb34-977"><a href="#cb34-977" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb34-978"><a href="#cb34-978" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"Number of Banks by USACE District (Top 15)"</span>, <span class="co"># Updated title</span></span>
<span id="cb34-979"><a href="#cb34-979" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"USACE District"</span>,                     <span class="co"># Updated x-axis</span></span>
<span id="cb34-980"><a href="#cb34-980" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb34-981"><a href="#cb34-981" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb34-982"><a href="#cb34-982" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-983"><a href="#cb34-983" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Make sure to use the new district_counts for the limit</span></span>
<span id="cb34-984"><a href="#cb34-984" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">max</span>(district_counts<span class="sc">$</span>n_banks, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">1.1</span>)</span>
<span id="cb34-985"><a href="#cb34-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-986"><a href="#cb34-986" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-987"><a href="#cb34-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-988"><a href="#cb34-988" aria-hidden="true" tabindex="-1"></a><span class="fu">### Kinds of Banks</span></span>
<span id="cb34-989"><a href="#cb34-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-990"><a href="#cb34-990" aria-hidden="true" tabindex="-1"></a>There are several **Kinds of banks (`kind_of_bank`):** represented in the dataset:</span>
<span id="cb34-991"><a href="#cb34-991" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-992"><a href="#cb34-992" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**ILF (In-Lieu Fee program):** Permittee pays a fee; the ILF sponsor later uses those funds to restore or establish wetlands/streams.</span>
<span id="cb34-993"><a href="#cb34-993" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**NRDA (Natural Resource Damage Assessment):** Bank created to offset environmental damages (e.g., oil spills, hazardous releases).</span>
<span id="cb34-994"><a href="#cb34-994" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Umbrella Bank:** A single umbrella instrument covering multiple sites under one sponsor/permit.</span>
<span id="cb34-995"><a href="#cb34-995" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Standard Bank:** The most common type; a single mitigation bank site with its own instrument.</span>
<span id="cb34-996"><a href="#cb34-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-997"><a href="#cb34-997" aria-hidden="true" tabindex="-1"></a>**Other classifications:**</span>
<span id="cb34-998"><a href="#cb34-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-999"><a href="#cb34-999" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Is 404 (`IS_404`):** Indicates whether the bank is authorized under Section 404 of the Clean Water Act (administered by the U.S. Army Corps of Engineers).</span>
<span id="cb34-1000"><a href="#cb34-1000" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*Yes*: Usable for compensatory mitigation required by 404 permits.</span>
<span id="cb34-1001"><a href="#cb34-1001" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>*No*: May be tied to state, local, or non-404 obligations.</span>
<span id="cb34-1002"><a href="#cb34-1002" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Is Conservation Bank (`IS_CONSERVATION`):** Indicates whether the site is a conservation bank under the U.S. Fish &amp; Wildlife Service.</span>
<span id="cb34-1003"><a href="#cb34-1003" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>Conservation banks focus on endangered species habitat offsets rather than wetlands/streams.</span>
<span id="cb34-1004"><a href="#cb34-1004" aria-hidden="true" tabindex="-1"></a><span class="ss">    -   </span>They often coexist in RIBITS alongside mitigation banks but serve different legal/regulatory purposes.</span>
<span id="cb34-1005"><a href="#cb34-1005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1008"><a href="#cb34-1008" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1009"><a href="#cb34-1009" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: bank-kinds-summary</span></span>
<span id="cb34-1010"><a href="#cb34-1010" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1011"><a href="#cb34-1011" aria-hidden="true" tabindex="-1"></a><span class="co">#| results: "asis"</span></span>
<span id="cb34-1012"><a href="#cb34-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1013"><a href="#cb34-1013" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply collapse and count function to bank types, whether they are 404 or not, and whether they are conservation banks or not</span></span>
<span id="cb34-1014"><a href="#cb34-1014" aria-hidden="true" tabindex="-1"></a>bank_kinds <span class="ot">&lt;-</span> <span class="fu">collapse_and_count</span>(data, <span class="st">"kind_of_bank"</span>, <span class="at">how =</span> <span class="st">"first"</span>)</span>
<span id="cb34-1015"><a href="#cb34-1015" aria-hidden="true" tabindex="-1"></a>bank_404 <span class="ot">&lt;-</span> <span class="fu">collapse_and_count</span>(data, <span class="st">"is_404"</span>, <span class="at">how =</span> <span class="st">"first"</span>) </span>
<span id="cb34-1016"><a href="#cb34-1016" aria-hidden="true" tabindex="-1"></a>bank_conservation <span class="ot">&lt;-</span> <span class="fu">collapse_and_count</span>(data, <span class="st">"is_conservation"</span>, <span class="at">how =</span> <span class="st">"first"</span>)</span>
<span id="cb34-1017"><a href="#cb34-1017" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1018"><a href="#cb34-1018" aria-hidden="true" tabindex="-1"></a><span class="co"># Table: Bank Kind Distribution</span></span>
<span id="cb34-1019"><a href="#cb34-1019" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the bank types</span></span>
<span id="cb34-1020"><a href="#cb34-1020" aria-hidden="true" tabindex="-1"></a>  bank_kinds<span class="sc">$</span>counts <span class="sc">%&gt;%</span></span>
<span id="cb34-1021"><a href="#cb34-1021" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-1022"><a href="#cb34-1022" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb34-1023"><a href="#cb34-1023" aria-hidden="true" tabindex="-1"></a>      <span class="at">kind_of_bank  =</span> <span class="st">"Kind of Bank"</span>,</span>
<span id="cb34-1024"><a href="#cb34-1024" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_banks       =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb34-1025"><a href="#cb34-1025" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1026"><a href="#cb34-1026" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb34-1027"><a href="#cb34-1027" aria-hidden="true" tabindex="-1"></a>      <span class="at">title    =</span> <span class="st">"**Bank Kind Distribution**"</span>,</span>
<span id="cb34-1028"><a href="#cb34-1028" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {nrow(data)} banks"</span>))</span>
<span id="cb34-1029"><a href="#cb34-1029" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1030"><a href="#cb34-1030" aria-hidden="true" tabindex="-1"></a><span class="co"># Table: Section 404 Applicability</span></span>
<span id="cb34-1031"><a href="#cb34-1031" aria-hidden="true" tabindex="-1"></a>  bank_404<span class="sc">$</span>counts <span class="sc">%&gt;%</span></span>
<span id="cb34-1032"><a href="#cb34-1032" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-1033"><a href="#cb34-1033" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb34-1034"><a href="#cb34-1034" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_404  =</span> <span class="st">"Section 404 Applicable"</span>,</span>
<span id="cb34-1035"><a href="#cb34-1035" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_banks =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb34-1036"><a href="#cb34-1036" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1037"><a href="#cb34-1037" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb34-1038"><a href="#cb34-1038" aria-hidden="true" tabindex="-1"></a>      <span class="at">title    =</span> <span class="st">"**Section 404 Applicability**"</span>,</span>
<span id="cb34-1039"><a href="#cb34-1039" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {nrow(data)} banks"</span>))</span>
<span id="cb34-1040"><a href="#cb34-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1041"><a href="#cb34-1041" aria-hidden="true" tabindex="-1"></a><span class="co"># Table: Conservation Bank Status</span></span>
<span id="cb34-1042"><a href="#cb34-1042" aria-hidden="true" tabindex="-1"></a>  bank_conservation<span class="sc">$</span>counts <span class="sc">%&gt;%</span></span>
<span id="cb34-1043"><a href="#cb34-1043" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-1044"><a href="#cb34-1044" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb34-1045"><a href="#cb34-1045" aria-hidden="true" tabindex="-1"></a>      <span class="at">is_conservation  =</span> <span class="st">"Conservation Bank"</span>,</span>
<span id="cb34-1046"><a href="#cb34-1046" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_banks =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb34-1047"><a href="#cb34-1047" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1048"><a href="#cb34-1048" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb34-1049"><a href="#cb34-1049" aria-hidden="true" tabindex="-1"></a>      <span class="at">title    =</span> <span class="st">"**Conservation Bank Status**"</span>,</span>
<span id="cb34-1050"><a href="#cb34-1050" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Across {nrow(data)} banks"</span>))</span>
<span id="cb34-1051"><a href="#cb34-1051" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1052"><a href="#cb34-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1053"><a href="#cb34-1053" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bank Type</span></span>
<span id="cb34-1054"><a href="#cb34-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1055"><a href="#cb34-1055" aria-hidden="true" tabindex="-1"></a>In addition to kinds of banks, there is also the type of bank. The **bank type (`bank_type`)** field describes who owns, operates, or sponsors the mitigation bank and provides context on the institution behind the credits and how they are managed.</span>
<span id="cb34-1056"><a href="#cb34-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1057"><a href="#cb34-1057" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Private Commercial**\</span>
<span id="cb34-1058"><a href="#cb34-1058" aria-hidden="true" tabindex="-1"></a>    Privately owned, for-profit entities that develop banks and sell credits on the open market.\</span>
<span id="cb34-1059"><a href="#cb34-1059" aria-hidden="true" tabindex="-1"></a>    This is the most common type of mitigation bank.</span>
<span id="cb34-1060"><a href="#cb34-1060" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1061"><a href="#cb34-1061" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Public Commercial**\</span>
<span id="cb34-1062"><a href="#cb34-1062" aria-hidden="true" tabindex="-1"></a>    Government agencies (e.g., state DOTs, local governments) acting as bank sponsors and selling credits.</span>
<span id="cb34-1063"><a href="#cb34-1063" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1064"><a href="#cb34-1064" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Private Nonprofit**\</span>
<span id="cb34-1065"><a href="#cb34-1065" aria-hidden="true" tabindex="-1"></a>    Nonprofit organizations (such as land trusts or conservation groups) that operate banks, often reinvesting proceeds into restoration and stewardship.</span>
<span id="cb34-1066"><a href="#cb34-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1067"><a href="#cb34-1067" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Single-Client**\</span>
<span id="cb34-1068"><a href="#cb34-1068" aria-hidden="true" tabindex="-1"></a>    Banks established to serve the mitigation needs of a single developer or project sponsor.\</span>
<span id="cb34-1069"><a href="#cb34-1069" aria-hidden="true" tabindex="-1"></a>    Credits are not generally available to the broader market.</span>
<span id="cb34-1070"><a href="#cb34-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1071"><a href="#cb34-1071" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Combination Public/Private**\</span>
<span id="cb34-1072"><a href="#cb34-1072" aria-hidden="true" tabindex="-1"></a>    Joint ventures where both public agencies and private entities share roles in sponsoring or managing the bank.</span>
<span id="cb34-1073"><a href="#cb34-1073" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1074"><a href="#cb34-1074" aria-hidden="true" tabindex="-1"></a>Here I show it as a plot rather than a table.</span>
<span id="cb34-1075"><a href="#cb34-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1078"><a href="#cb34-1078" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1079"><a href="#cb34-1079" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: bank-type-summary-and-plot</span></span>
<span id="cb34-1080"><a href="#cb34-1080" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-1081"><a href="#cb34-1081" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-1082"><a href="#cb34-1082" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1083"><a href="#cb34-1083" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1084"><a href="#cb34-1084" aria-hidden="true" tabindex="-1"></a><span class="co"># Collapse to one row per bank (take first recorded type per bank)</span></span>
<span id="cb34-1085"><a href="#cb34-1085" aria-hidden="true" tabindex="-1"></a>bank_type    <span class="ot">&lt;-</span> <span class="fu">collapse_and_count</span>(data, <span class="st">"bank_type"</span>, <span class="at">how =</span> <span class="st">"first"</span>)</span>
<span id="cb34-1086"><a href="#cb34-1086" aria-hidden="true" tabindex="-1"></a>type_level  <span class="ot">&lt;-</span> bank_type<span class="sc">$</span>bank_level</span>
<span id="cb34-1087"><a href="#cb34-1087" aria-hidden="true" tabindex="-1"></a>type_counts <span class="ot">&lt;-</span> bank_type<span class="sc">$</span>counts <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bank_type))</span>
<span id="cb34-1088"><a href="#cb34-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1089"><a href="#cb34-1089" aria-hidden="true" tabindex="-1"></a><span class="co"># Horizontal bar chart with value labels</span></span>
<span id="cb34-1090"><a href="#cb34-1090" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(type_counts, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(bank_type, n_banks), <span class="at">y =</span> n_banks)) <span class="sc">+</span></span>
<span id="cb34-1091"><a href="#cb34-1091" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"seagreen"</span>) <span class="sc">+</span></span>
<span id="cb34-1092"><a href="#cb34-1092" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n_banks), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb34-1093"><a href="#cb34-1093" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb34-1094"><a href="#cb34-1094" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-1095"><a href="#cb34-1095" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Bank Type"</span>,</span>
<span id="cb34-1096"><a href="#cb34-1096" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Bank Type"</span>,</span>
<span id="cb34-1097"><a href="#cb34-1097" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb34-1098"><a href="#cb34-1098" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-1099"><a href="#cb34-1099" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">max</span>(type_counts<span class="sc">$</span>n_banks, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="fl">1.1</span>) <span class="sc">+</span></span>
<span id="cb34-1100"><a href="#cb34-1100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb34-1101"><a href="#cb34-1101" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1102"><a href="#cb34-1102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1103"><a href="#cb34-1103" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bank Status</span></span>
<span id="cb34-1104"><a href="#cb34-1104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1105"><a href="#cb34-1105" aria-hidden="true" tabindex="-1"></a>**Bank status (`bank_status`)** indicates where a mitigation or conservation bank stands in the regulatory process and determines whether credits from the bank are available for use. There is also **Bank status date (`bank_status_date`)** which provides the date in which the bank status was changed.</span>
<span id="cb34-1106"><a href="#cb34-1106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1107"><a href="#cb34-1107" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Approved**\</span>
<span id="cb34-1108"><a href="#cb34-1108" aria-hidden="true" tabindex="-1"></a>    Active banks with an approved instrument (formal agreement with agencies).\</span>
<span id="cb34-1109"><a href="#cb34-1109" aria-hidden="true" tabindex="-1"></a>    These banks are authorized to sell credits for compensatory mitigation.</span>
<span id="cb34-1110"><a href="#cb34-1110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1111"><a href="#cb34-1111" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Sold-Out**\</span>
<span id="cb34-1112"><a href="#cb34-1112" aria-hidden="true" tabindex="-1"></a>    Banks that have sold all of their available credits.\</span>
<span id="cb34-1113"><a href="#cb34-1113" aria-hidden="true" tabindex="-1"></a>    They remain in RIBITS for historical purposes but cannot provide new credits.</span>
<span id="cb34-1114"><a href="#cb34-1114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1115"><a href="#cb34-1115" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Pending**\</span>
<span id="cb34-1116"><a href="#cb34-1116" aria-hidden="true" tabindex="-1"></a>    Proposed banks currently under review.\</span>
<span id="cb34-1117"><a href="#cb34-1117" aria-hidden="true" tabindex="-1"></a>    Credits cannot yet be purchased, but these represent projects in the pipeline.</span>
<span id="cb34-1118"><a href="#cb34-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1119"><a href="#cb34-1119" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Withdrawn**\</span>
<span id="cb34-1120"><a href="#cb34-1120" aria-hidden="true" tabindex="-1"></a>    Applications that were submitted but later withdrawn by the sponsor or rejected.\</span>
<span id="cb34-1121"><a href="#cb34-1121" aria-hidden="true" tabindex="-1"></a>    These banks never became active.</span>
<span id="cb34-1122"><a href="#cb34-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1123"><a href="#cb34-1123" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Terminated**\</span>
<span id="cb34-1124"><a href="#cb34-1124" aria-hidden="true" tabindex="-1"></a>    Banks that were once approved but have since been closed or terminated by regulators.\</span>
<span id="cb34-1125"><a href="#cb34-1125" aria-hidden="true" tabindex="-1"></a>    Credits are no longer valid.</span>
<span id="cb34-1126"><a href="#cb34-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1127"><a href="#cb34-1127" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>**Suspended**\</span>
<span id="cb34-1128"><a href="#cb34-1128" aria-hidden="true" tabindex="-1"></a>    Banks temporarily suspended, often due to compliance or legal issues.\</span>
<span id="cb34-1129"><a href="#cb34-1129" aria-hidden="true" tabindex="-1"></a>    While suspended, the bank cannot sell credits; it may later be reinstated or permanently terminated.</span>
<span id="cb34-1130"><a href="#cb34-1130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1133"><a href="#cb34-1133" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1134"><a href="#cb34-1134" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: get-current-bank-status</span></span>
<span id="cb34-1135"><a href="#cb34-1135" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1136"><a href="#cb34-1136" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb34-1137"><a href="#cb34-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1138"><a href="#cb34-1138" aria-hidden="true" tabindex="-1"></a><span class="co"># Get raw status data (before date filtering)</span></span>
<span id="cb34-1139"><a href="#cb34-1139" aria-hidden="true" tabindex="-1"></a>bank_status_pre_filter <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb34-1140"><a href="#cb34-1140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id, bank_status, bank_status_date) <span class="sc">%&gt;%</span></span>
<span id="cb34-1141"><a href="#cb34-1141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bank_status) <span class="sc">&amp;</span> bank_status <span class="sc">!=</span> <span class="st">""</span>)</span>
<span id="cb34-1142"><a href="#cb34-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1143"><a href="#cb34-1143" aria-hidden="true" tabindex="-1"></a><span class="co"># total banks before filter</span></span>
<span id="cb34-1144"><a href="#cb34-1144" aria-hidden="true" tabindex="-1"></a>n_banks_before_date_filter <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(bank_status_pre_filter<span class="sc">$</span>bank_id)</span>
<span id="cb34-1145"><a href="#cb34-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1146"><a href="#cb34-1146" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse dates and filter out rows with invalid dates</span></span>
<span id="cb34-1147"><a href="#cb34-1147" aria-hidden="true" tabindex="-1"></a>bank_status_raw <span class="ot">&lt;-</span> bank_status_pre_filter <span class="sc">%&gt;%</span></span>
<span id="cb34-1148"><a href="#cb34-1148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bank_status_date))</span>
<span id="cb34-1149"><a href="#cb34-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1150"><a href="#cb34-1150" aria-hidden="true" tabindex="-1"></a><span class="co"># Get current bank status </span></span>
<span id="cb34-1151"><a href="#cb34-1151" aria-hidden="true" tabindex="-1"></a>current_bank_status <span class="ot">&lt;-</span> bank_status_raw <span class="sc">%&gt;%</span></span>
<span id="cb34-1152"><a href="#cb34-1152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb34-1153"><a href="#cb34-1153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(<span class="at">order_by =</span> bank_status_date, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1154"><a href="#cb34-1154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb34-1155"><a href="#cb34-1155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1156"><a href="#cb34-1156" aria-hidden="true" tabindex="-1"></a><span class="co"># Count current banks and number of banks dropped</span></span>
<span id="cb34-1157"><a href="#cb34-1157" aria-hidden="true" tabindex="-1"></a>n_current_banks <span class="ot">&lt;-</span> <span class="fu">nrow</span>(current_bank_status)</span>
<span id="cb34-1158"><a href="#cb34-1158" aria-hidden="true" tabindex="-1"></a>n_banks_dropped <span class="ot">&lt;-</span> n_banks_before_date_filter <span class="sc">-</span> n_current_banks</span>
<span id="cb34-1159"><a href="#cb34-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1160"><a href="#cb34-1160" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the counts for the "Current" banks (ones we kept)</span></span>
<span id="cb34-1161"><a href="#cb34-1161" aria-hidden="true" tabindex="-1"></a>counts_current <span class="ot">&lt;-</span> current_bank_status <span class="sc">%&gt;%</span></span>
<span id="cb34-1162"><a href="#cb34-1162" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(bank_status, <span class="at">name =</span> <span class="st">"n_current_with_date"</span>)</span>
<span id="cb34-1163"><a href="#cb34-1163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1164"><a href="#cb34-1164" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the bank IDs of those we dropped</span></span>
<span id="cb34-1165"><a href="#cb34-1165" aria-hidden="true" tabindex="-1"></a>dropped_bank_ids <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(bank_status_pre_filter<span class="sc">$</span>bank_id, current_bank_status<span class="sc">$</span>bank_id)</span>
<span id="cb34-1166"><a href="#cb34-1166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1167"><a href="#cb34-1167" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, get the status counts for *only* the dropped banks</span></span>
<span id="cb34-1168"><a href="#cb34-1168" aria-hidden="true" tabindex="-1"></a><span class="co"># We take one row per dropped bank to ensure we count 517 banks, not 517+ rows</span></span>
<span id="cb34-1169"><a href="#cb34-1169" aria-hidden="true" tabindex="-1"></a>counts_dropped <span class="ot">&lt;-</span> bank_status_pre_filter <span class="sc">%&gt;%</span></span>
<span id="cb34-1170"><a href="#cb34-1170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(bank_id <span class="sc">%in%</span> dropped_bank_ids) <span class="sc">%&gt;%</span></span>
<span id="cb34-1171"><a href="#cb34-1171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(bank_id, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="co"># Get one status row per dropped bank</span></span>
<span id="cb34-1172"><a href="#cb34-1172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(bank_status, <span class="at">name =</span> <span class="st">"n_dropped_no_date"</span>)</span>
<span id="cb34-1173"><a href="#cb34-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1174"><a href="#cb34-1174" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the final comparison table</span></span>
<span id="cb34-1175"><a href="#cb34-1175" aria-hidden="true" tabindex="-1"></a>status_comparison_table <span class="ot">&lt;-</span> <span class="fu">full_join</span>(</span>
<span id="cb34-1176"><a href="#cb34-1176" aria-hidden="true" tabindex="-1"></a>    counts_current,</span>
<span id="cb34-1177"><a href="#cb34-1177" aria-hidden="true" tabindex="-1"></a>    counts_dropped,</span>
<span id="cb34-1178"><a href="#cb34-1178" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"bank_status"</span></span>
<span id="cb34-1179"><a href="#cb34-1179" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1180"><a href="#cb34-1180" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replace NAs with 0s for statuses that only exist in one group</span></span>
<span id="cb34-1181"><a href="#cb34-1181" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-1182"><a href="#cb34-1182" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_current_with_date =</span> <span class="fu">coalesce</span>(n_current_with_date, <span class="dv">0</span>),</span>
<span id="cb34-1183"><a href="#cb34-1183" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_dropped_no_date =</span> <span class="fu">coalesce</span>(n_dropped_no_date, <span class="dv">0</span>)</span>
<span id="cb34-1184"><a href="#cb34-1184" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1185"><a href="#cb34-1185" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add a total</span></span>
<span id="cb34-1186"><a href="#cb34-1186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_total =</span> n_current_with_date <span class="sc">+</span> n_dropped_no_date) <span class="sc">%&gt;%</span></span>
<span id="cb34-1187"><a href="#cb34-1187" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort to show most common statuses first</span></span>
<span id="cb34-1188"><a href="#cb34-1188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n_total))</span>
<span id="cb34-1189"><a href="#cb34-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1190"><a href="#cb34-1190" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the "after" summary (for the plot)</span></span>
<span id="cb34-1191"><a href="#cb34-1191" aria-hidden="true" tabindex="-1"></a>status_summary_counts <span class="ot">&lt;-</span> current_bank_status <span class="sc">%&gt;%</span></span>
<span id="cb34-1192"><a href="#cb34-1192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(bank_status, <span class="at">sort =</span> <span class="cn">TRUE</span>, <span class="at">name =</span> <span class="st">"n_banks"</span>)</span>
<span id="cb34-1193"><a href="#cb34-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1194"><a href="#cb34-1194" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Define the helper function</span></span>
<span id="cb34-1195"><a href="#cb34-1195" aria-hidden="true" tabindex="-1"></a>inspect_bank_status <span class="ot">&lt;-</span> <span class="cf">function</span>(bank_id) {</span>
<span id="cb34-1196"><a href="#cb34-1196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">glue</span>(<span class="st">"Inspecting raw status for bank_id: {bank_id}</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb34-1197"><a href="#cb34-1197" aria-hidden="true" tabindex="-1"></a>  bank_status_raw <span class="sc">%&gt;%</span></span>
<span id="cb34-1198"><a href="#cb34-1198" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(bank_id <span class="sc">==</span> bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb34-1199"><a href="#cb34-1199" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(bank_status_date))</span>
<span id="cb34-1200"><a href="#cb34-1200" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-1201"><a href="#cb34-1201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1202"><a href="#cb34-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1203"><a href="#cb34-1203" aria-hidden="true" tabindex="-1"></a>Here, I check how many banks have a recorded and dated status entry. Of the <span class="in">`r n_banks_before_date_filter`</span> banks that had status information, **`r n_banks_dropped` banks were excluded** from this analysis because they had no valid status date. The table below compares the statuses for the <span class="in">`r n_current_banks`</span> banks we kept (those with valid dates) against the statuses listed for the <span class="in">`r n_banks_dropped`</span> banks we had to drop.</span>
<span id="cb34-1204"><a href="#cb34-1204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1207"><a href="#cb34-1207" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1208"><a href="#cb34-1208" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: print-status-comparison-table</span></span>
<span id="cb34-1209"><a href="#cb34-1209" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1210"><a href="#cb34-1210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1211"><a href="#cb34-1211" aria-hidden="true" tabindex="-1"></a>  status_comparison_table <span class="sc">%&gt;%</span></span>
<span id="cb34-1212"><a href="#cb34-1212" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-1213"><a href="#cb34-1213" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb34-1214"><a href="#cb34-1214" aria-hidden="true" tabindex="-1"></a>      <span class="at">bank_status =</span> <span class="st">"Bank Status"</span>,</span>
<span id="cb34-1215"><a href="#cb34-1215" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_current_with_date =</span> <span class="st">"Kept (Has Date)"</span>,</span>
<span id="cb34-1216"><a href="#cb34-1216" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_dropped_no_date =</span> <span class="st">"Dropped (No Date)"</span>,</span>
<span id="cb34-1217"><a href="#cb34-1217" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_total =</span> <span class="st">"Total Banks"</span></span>
<span id="cb34-1218"><a href="#cb34-1218" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1219"><a href="#cb34-1219" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">where</span>(is.numeric), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1220"><a href="#cb34-1220" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a summary row at the bottom to show totals</span></span>
<span id="cb34-1221"><a href="#cb34-1221" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grand_summary_rows</span>(</span>
<span id="cb34-1222"><a href="#cb34-1222" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="fu">c</span>(n_current_with_date, n_dropped_no_date, n_total),</span>
<span id="cb34-1223"><a href="#cb34-1223" aria-hidden="true" tabindex="-1"></a>      <span class="at">fns =</span> <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"Total"</span>, <span class="at">fn =</span> <span class="st">"sum"</span>),</span>
<span id="cb34-1224"><a href="#cb34-1224" aria-hidden="true" tabindex="-1"></a>      <span class="at">formatter =</span> fmt_number, <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb34-1225"><a href="#cb34-1225" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1226"><a href="#cb34-1226" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb34-1227"><a href="#cb34-1227" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"**Bank Status: Kept vs. Dropped**"</span>,</span>
<span id="cb34-1228"><a href="#cb34-1228" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Comparing banks with and without valid status dates"</span></span>
<span id="cb34-1229"><a href="#cb34-1229" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-1230"><a href="#cb34-1230" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1231"><a href="#cb34-1231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1232"><a href="#cb34-1232" aria-hidden="true" tabindex="-1"></a>Now let's check how these status events look by year:</span>
<span id="cb34-1233"><a href="#cb34-1233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1236"><a href="#cb34-1236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1237"><a href="#cb34-1237" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: bank-status-events-per-year</span></span>
<span id="cb34-1238"><a href="#cb34-1238" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-1239"><a href="#cb34-1239" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-1240"><a href="#cb34-1240" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1241"><a href="#cb34-1241" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 8</span></span>
<span id="cb34-1242"><a href="#cb34-1242" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 4</span></span>
<span id="cb34-1243"><a href="#cb34-1243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1244"><a href="#cb34-1244" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Calculate events per year (This is the corrected part)</span></span>
<span id="cb34-1245"><a href="#cb34-1245" aria-hidden="true" tabindex="-1"></a><span class="co">#    We just use the existing all-caps column names.</span></span>
<span id="cb34-1246"><a href="#cb34-1246" aria-hidden="true" tabindex="-1"></a>events_by_year <span class="ot">&lt;-</span> current_bank_status <span class="sc">%&gt;%</span></span>
<span id="cb34-1247"><a href="#cb34-1247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(bank_status_date)) <span class="sc">%&gt;%</span></span>
<span id="cb34-1248"><a href="#cb34-1248" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year, bank_status, <span class="at">name =</span> <span class="st">"n_events"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1249"><a href="#cb34-1249" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, bank_status)</span>
<span id="cb34-1250"><a href="#cb34-1250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1251"><a href="#cb34-1251" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Plot the stacked bar chart of new events</span></span>
<span id="cb34-1252"><a href="#cb34-1252" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(events_by_year, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> n_events, <span class="at">fill =</span> bank_status)) <span class="sc">+</span></span>
<span id="cb34-1253"><a href="#cb34-1253" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb34-1254"><a href="#cb34-1254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-1255"><a href="#cb34-1255" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"New Bank Status Events Per Year"</span>,</span>
<span id="cb34-1256"><a href="#cb34-1256" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Each bar shows the number of banks that received their status that year."</span>,</span>
<span id="cb34-1257"><a href="#cb34-1257" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb34-1258"><a href="#cb34-1258" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of New Status Events"</span>,</span>
<span id="cb34-1259"><a href="#cb34-1259" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Status"</span></span>
<span id="cb34-1260"><a href="#cb34-1260" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-1261"><a href="#cb34-1261" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">pretty</span>(events_by_year<span class="sc">$</span>year, <span class="at">n =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb34-1262"><a href="#cb34-1262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb34-1263"><a href="#cb34-1263" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1264"><a href="#cb34-1264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1267"><a href="#cb34-1267" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1268"><a href="#cb34-1268" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: get-binned-summary-data</span></span>
<span id="cb34-1269"><a href="#cb34-1269" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1270"><a href="#cb34-1270" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb34-1271"><a href="#cb34-1271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1272"><a href="#cb34-1272" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Get the min/max years from the data to build the bins</span></span>
<span id="cb34-1273"><a href="#cb34-1273" aria-hidden="true" tabindex="-1"></a>year_data <span class="ot">&lt;-</span> current_bank_status <span class="sc">%&gt;%</span></span>
<span id="cb34-1274"><a href="#cb34-1274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(bank_status_date)) <span class="sc">%&gt;%</span></span>
<span id="cb34-1275"><a href="#cb34-1275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year)) <span class="co"># Make sure we only use dated events</span></span>
<span id="cb34-1276"><a href="#cb34-1276" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1277"><a href="#cb34-1277" aria-hidden="true" tabindex="-1"></a>min_year_in_data <span class="ot">&lt;-</span> <span class="fu">min</span>(year_data<span class="sc">$</span>year)</span>
<span id="cb34-1278"><a href="#cb34-1278" aria-hidden="true" tabindex="-1"></a>max_year_in_data <span class="ot">&lt;-</span> <span class="fu">max</span>(year_data<span class="sc">$</span>year)</span>
<span id="cb34-1279"><a href="#cb34-1279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1280"><a href="#cb34-1280" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll start at 1980 as requested</span></span>
<span id="cb34-1281"><a href="#cb34-1281" aria-hidden="true" tabindex="-1"></a>start_year <span class="ot">&lt;-</span> <span class="dv">1980</span></span>
<span id="cb34-1282"><a href="#cb34-1282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1283"><a href="#cb34-1283" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Define the 5-year break points</span></span>
<span id="cb34-1284"><a href="#cb34-1284" aria-hidden="true" tabindex="-1"></a><span class="co"># We want intervals [1980, 1985), [1985, 1990), etc.</span></span>
<span id="cb34-1285"><a href="#cb34-1285" aria-hidden="true" tabindex="-1"></a><span class="co"># This means 1980-1984, 1985-1989, etc.</span></span>
<span id="cb34-1286"><a href="#cb34-1286" aria-hidden="true" tabindex="-1"></a>breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(</span>
<span id="cb34-1287"><a href="#cb34-1287" aria-hidden="true" tabindex="-1"></a>  <span class="at">from =</span> start_year, </span>
<span id="cb34-1288"><a href="#cb34-1288" aria-hidden="true" tabindex="-1"></a>  <span class="at">to =</span> max_year_in_data <span class="sc">+</span> <span class="dv">5</span>, <span class="co"># Go one step past the max</span></span>
<span id="cb34-1289"><a href="#cb34-1289" aria-hidden="true" tabindex="-1"></a>  <span class="at">by =</span> <span class="dv">5</span></span>
<span id="cb34-1290"><a href="#cb34-1290" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-1291"><a href="#cb34-1291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1292"><a href="#cb34-1292" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create the binned summary table</span></span>
<span id="cb34-1293"><a href="#cb34-1293" aria-hidden="true" tabindex="-1"></a>binned_summary_table <span class="ot">&lt;-</span> year_data <span class="sc">%&gt;%</span></span>
<span id="cb34-1294"><a href="#cb34-1294" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1295"><a href="#cb34-1295" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 4. Create the 'year_bin' column</span></span>
<span id="cb34-1296"><a href="#cb34-1296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-1297"><a href="#cb34-1297" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_bin =</span> <span class="fu">cut</span>(</span>
<span id="cb34-1298"><a href="#cb34-1298" aria-hidden="true" tabindex="-1"></a>      year,</span>
<span id="cb34-1299"><a href="#cb34-1299" aria-hidden="true" tabindex="-1"></a>      <span class="at">breaks =</span> breaks,</span>
<span id="cb34-1300"><a href="#cb34-1300" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 'right = FALSE' means the interval is [start, end)</span></span>
<span id="cb34-1301"><a href="#cb34-1301" aria-hidden="true" tabindex="-1"></a>      <span class="co"># e.g., [1980, 1985) which includes 1980, 81, 82, 83, 84</span></span>
<span id="cb34-1302"><a href="#cb34-1302" aria-hidden="true" tabindex="-1"></a>      <span class="at">right =</span> <span class="cn">FALSE</span>, </span>
<span id="cb34-1303"><a href="#cb34-1303" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Create clear labels like "1980-1984"</span></span>
<span id="cb34-1304"><a href="#cb34-1304" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">paste0</span>(breaks[<span class="sc">-</span><span class="fu">length</span>(breaks)], <span class="st">"-"</span>, breaks[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb34-1305"><a href="#cb34-1305" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-1306"><a href="#cb34-1306" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1307"><a href="#cb34-1307" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1308"><a href="#cb34-1308" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter out any data before 1980</span></span>
<span id="cb34-1309"><a href="#cb34-1309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year_bin)) <span class="sc">%&gt;%</span></span>
<span id="cb34-1310"><a href="#cb34-1310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1311"><a href="#cb34-1311" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 5. Count by the new bin and the status</span></span>
<span id="cb34-1312"><a href="#cb34-1312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year_bin, bank_status, <span class="at">name =</span> <span class="st">"n_events"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1313"><a href="#cb34-1313" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1314"><a href="#cb34-1314" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 6. Pivot to the format you want</span></span>
<span id="cb34-1315"><a href="#cb34-1315" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb34-1316"><a href="#cb34-1316" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> bank_status,</span>
<span id="cb34-1317"><a href="#cb34-1317" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> n_events,</span>
<span id="cb34-1318"><a href="#cb34-1318" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_fill =</span> <span class="dv">0</span> <span class="co"># Show 0 for empty status/bin combos</span></span>
<span id="cb34-1319"><a href="#cb34-1319" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1320"><a href="#cb34-1320" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1321"><a href="#cb34-1321" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 7. Arrange by the bin</span></span>
<span id="cb34-1322"><a href="#cb34-1322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year_bin)</span>
<span id="cb34-1323"><a href="#cb34-1323" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1324"><a href="#cb34-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1325"><a href="#cb34-1325" aria-hidden="true" tabindex="-1"></a>This table shows the same; it is **the number of bank status events** that occurred within each 5-year period.</span>
<span id="cb34-1326"><a href="#cb34-1326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1329"><a href="#cb34-1329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1330"><a href="#cb34-1330" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: print-binned-summary-table</span></span>
<span id="cb34-1331"><a href="#cb34-1331" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1332"><a href="#cb34-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1333"><a href="#cb34-1333" aria-hidden="true" tabindex="-1"></a>  binned_summary_table <span class="sc">%&gt;%</span></span>
<span id="cb34-1334"><a href="#cb34-1334" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-1335"><a href="#cb34-1335" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Relabel the bin column to be clearer</span></span>
<span id="cb34-1336"><a href="#cb34-1336" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb34-1337"><a href="#cb34-1337" aria-hidden="true" tabindex="-1"></a>      <span class="at">year_bin =</span> <span class="st">"5-Year Period"</span></span>
<span id="cb34-1338"><a href="#cb34-1338" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1339"><a href="#cb34-1339" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Format all number columns</span></span>
<span id="cb34-1340"><a href="#cb34-1340" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(</span>
<span id="cb34-1341"><a href="#cb34-1341" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb34-1342"><a href="#cb34-1342" aria-hidden="true" tabindex="-1"></a>      <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb34-1343"><a href="#cb34-1343" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1344"><a href="#cb34-1344" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use your custom theme function</span></span>
<span id="cb34-1345"><a href="#cb34-1345" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb34-1346"><a href="#cb34-1346" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"**Bank Status Events by 5-Year Period**"</span></span>
<span id="cb34-1347"><a href="#cb34-1347" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1348"><a href="#cb34-1348" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a summary row at the bottom</span></span>
<span id="cb34-1349"><a href="#cb34-1349" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grand_summary_rows</span>(</span>
<span id="cb34-1350"><a href="#cb34-1350" aria-hidden="true" tabindex="-1"></a>      <span class="at">columns =</span> <span class="fu">where</span>(is.numeric),</span>
<span id="cb34-1351"><a href="#cb34-1351" aria-hidden="true" tabindex="-1"></a>      <span class="at">fns =</span> <span class="fu">list</span>(<span class="at">label =</span> <span class="st">"Total"</span>, <span class="at">fn =</span> <span class="st">"sum"</span>),</span>
<span id="cb34-1352"><a href="#cb34-1352" aria-hidden="true" tabindex="-1"></a>      <span class="at">formatter =</span> fmt_number, <span class="at">decimals =</span> <span class="dv">0</span></span>
<span id="cb34-1353"><a href="#cb34-1353" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-1354"><a href="#cb34-1354" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1355"><a href="#cb34-1355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1356"><a href="#cb34-1356" aria-hidden="true" tabindex="-1"></a>We can also see the cumulative trajectory - how many total banks are approved/pending/terminated/etc through time:</span>
<span id="cb34-1357"><a href="#cb34-1357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1360"><a href="#cb34-1360" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1361"><a href="#cb34-1361" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: bank-status-cumulative-trajectory</span></span>
<span id="cb34-1362"><a href="#cb34-1362" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-1363"><a href="#cb34-1363" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-1364"><a href="#cb34-1364" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1365"><a href="#cb34-1365" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 10</span></span>
<span id="cb34-1366"><a href="#cb34-1366" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 6</span></span>
<span id="cb34-1367"><a href="#cb34-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1368"><a href="#cb34-1368" aria-hidden="true" tabindex="-1"></a><span class="co"># Add the cumulative sum using the 'events_by_year' table from the chunk above</span></span>
<span id="cb34-1369"><a href="#cb34-1369" aria-hidden="true" tabindex="-1"></a>cumulative_counts <span class="ot">&lt;-</span> events_by_year <span class="sc">%&gt;%</span></span>
<span id="cb34-1370"><a href="#cb34-1370" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add 0-count rows for missing year/status combos</span></span>
<span id="cb34-1371"><a href="#cb34-1371" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(year, bank_status, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">n_events =</span> <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb34-1372"><a href="#cb34-1372" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the cumulative sum *within each status group*</span></span>
<span id="cb34-1373"><a href="#cb34-1373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bank_status) <span class="sc">%&gt;%</span></span>
<span id="cb34-1374"><a href="#cb34-1374" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb34-1375"><a href="#cb34-1375" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_banks =</span> <span class="fu">cumsum</span>(n_events)) <span class="sc">%&gt;%</span></span>
<span id="cb34-1376"><a href="#cb34-1376" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb34-1377"><a href="#cb34-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1378"><a href="#cb34-1378" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the cumulative trajectories</span></span>
<span id="cb34-1379"><a href="#cb34-1379" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cumulative_counts, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> total_banks, <span class="at">color =</span> bank_status, <span class="at">group =</span> bank_status)) <span class="sc">+</span></span>
<span id="cb34-1380"><a href="#cb34-1380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb34-1381"><a href="#cb34-1381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb34-1382"><a href="#cb34-1382" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-1383"><a href="#cb34-1383" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cumulative Bank Status Over Time"</span>,</span>
<span id="cb34-1384"><a href="#cb34-1384" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Total number of banks in each state at the end of each year"</span>,</span>
<span id="cb34-1385"><a href="#cb34-1385" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb34-1386"><a href="#cb34-1386" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Total Number of Banks"</span>,</span>
<span id="cb34-1387"><a href="#cb34-1387" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Bank Status"</span></span>
<span id="cb34-1388"><a href="#cb34-1388" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-1389"><a href="#cb34-1389" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-1390"><a href="#cb34-1390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">pretty</span>(cumulative_counts<span class="sc">$</span>year, <span class="at">n =</span> <span class="dv">8</span>)) <span class="sc">+</span></span>
<span id="cb34-1391"><a href="#cb34-1391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span>
<span id="cb34-1392"><a href="#cb34-1392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1393"><a href="#cb34-1393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1394"><a href="#cb34-1394" aria-hidden="true" tabindex="-1"></a><span class="fu">### Bank Establishment</span></span>
<span id="cb34-1395"><a href="#cb34-1395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1396"><a href="#cb34-1396" aria-hidden="true" tabindex="-1"></a>The date of bank establishment is also helpful to understand the age of banks and trends over time.</span>
<span id="cb34-1397"><a href="#cb34-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1400"><a href="#cb34-1400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1401"><a href="#cb34-1401" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: calculate-establishment-stats</span></span>
<span id="cb34-1402"><a href="#cb34-1402" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1403"><a href="#cb34-1403" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb34-1404"><a href="#cb34-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1405"><a href="#cb34-1405" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataframe of banks established</span></span>
<span id="cb34-1406"><a href="#cb34-1406" aria-hidden="true" tabindex="-1"></a>banks_establish <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb34-1407"><a href="#cb34-1407" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> <span class="co"># Drop geometry for faster processing</span></span>
<span id="cb34-1408"><a href="#cb34-1408" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-1409"><a href="#cb34-1409" aria-hidden="true" tabindex="-1"></a>    <span class="at">est_date  =</span> <span class="fu">suppressWarnings</span>(<span class="fu">mdy</span>(establishment_date)),</span>
<span id="cb34-1410"><a href="#cb34-1410" aria-hidden="true" tabindex="-1"></a>    <span class="at">status_dt =</span> <span class="fu">suppressWarnings</span>(<span class="fu">mdy</span>(bank_status_date)),</span>
<span id="cb34-1411"><a href="#cb34-1411" aria-hidden="true" tabindex="-1"></a>    <span class="at">YEAR_EST2 =</span> <span class="fu">coalesce</span>(year_established, <span class="fu">year</span>(est_date))</span>
<span id="cb34-1412"><a href="#cb34-1412" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-1413"><a href="#cb34-1413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1414"><a href="#cb34-1414" aria-hidden="true" tabindex="-1"></a><span class="co"># Get earliest known establishment year per bank</span></span>
<span id="cb34-1415"><a href="#cb34-1415" aria-hidden="true" tabindex="-1"></a>year_by_bank <span class="ot">&lt;-</span> banks_establish <span class="sc">%&gt;%</span></span>
<span id="cb34-1416"><a href="#cb34-1416" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb34-1417"><a href="#cb34-1417" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-1418"><a href="#cb34-1418" aria-hidden="true" tabindex="-1"></a>    <span class="at">year_established =</span> <span class="fu">suppressWarnings</span>(<span class="fu">min</span>(YEAR_EST2, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb34-1419"><a href="#cb34-1419" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb34-1420"><a href="#cb34-1420" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1421"><a href="#cb34-1421" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert Inf (from min(NA)) back to NA</span></span>
<span id="cb34-1422"><a href="#cb34-1422" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year_established =</span> <span class="fu">ifelse</span>(<span class="fu">is.infinite</span>(year_established), <span class="cn">NA_integer_</span>, year_established))</span>
<span id="cb34-1423"><a href="#cb34-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1424"><a href="#cb34-1424" aria-hidden="true" tabindex="-1"></a><span class="co"># Get most recent reported status per bank</span></span>
<span id="cb34-1425"><a href="#cb34-1425" aria-hidden="true" tabindex="-1"></a>status_by_bank <span class="ot">&lt;-</span> banks_establish <span class="sc">%&gt;%</span></span>
<span id="cb34-1426"><a href="#cb34-1426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(bank_id) <span class="sc">%&gt;%</span></span>
<span id="cb34-1427"><a href="#cb34-1427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(status_dt), <span class="at">.by_group =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1428"><a href="#cb34-1428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-1429"><a href="#cb34-1429" aria-hidden="true" tabindex="-1"></a>    <span class="at">bank_status =</span> <span class="fu">first</span>(<span class="fu">na.omit</span>(bank_status)), <span class="co"># Get first non-NA status</span></span>
<span id="cb34-1430"><a href="#cb34-1430" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb34-1431"><a href="#cb34-1431" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-1432"><a href="#cb34-1432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1433"><a href="#cb34-1433" aria-hidden="true" tabindex="-1"></a><span class="co"># Build the final 'bank_level' table</span></span>
<span id="cb34-1434"><a href="#cb34-1434" aria-hidden="true" tabindex="-1"></a>bank_level <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb34-1435"><a href="#cb34-1435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-1436"><a href="#cb34-1436" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(bank_id, bank_name) <span class="sc">%&gt;%</span></span>
<span id="cb34-1437"><a href="#cb34-1437" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(year_by_bank,   <span class="at">by =</span> <span class="st">"bank_id"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1438"><a href="#cb34-1438" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(status_by_bank, <span class="at">by =</span> <span class="st">"bank_id"</span>)</span>
<span id="cb34-1439"><a href="#cb34-1439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1440"><a href="#cb34-1440" aria-hidden="true" tabindex="-1"></a><span class="co"># Bank Age Analysis</span></span>
<span id="cb34-1441"><a href="#cb34-1441" aria-hidden="true" tabindex="-1"></a>this_year <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(<span class="fu">Sys.Date</span>())</span>
<span id="cb34-1442"><a href="#cb34-1442" aria-hidden="true" tabindex="-1"></a>bank_level <span class="ot">&lt;-</span> bank_level <span class="sc">%&gt;%</span></span>
<span id="cb34-1443"><a href="#cb34-1443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">bank_age =</span> this_year <span class="sc">-</span> year_established)</span>
<span id="cb34-1444"><a href="#cb34-1444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1445"><a href="#cb34-1445" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate all variables for prose, plots, and tables</span></span>
<span id="cb34-1446"><a href="#cb34-1446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1447"><a href="#cb34-1447" aria-hidden="true" tabindex="-1"></a><span class="co"># Headline numbers for prose</span></span>
<span id="cb34-1448"><a href="#cb34-1448" aria-hidden="true" tabindex="-1"></a>n_banks       <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(bank_level<span class="sc">$</span>bank_id)</span>
<span id="cb34-1449"><a href="#cb34-1449" aria-hidden="true" tabindex="-1"></a>n_with_year   <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(bank_level<span class="sc">$</span>year_established))</span>
<span id="cb34-1450"><a href="#cb34-1450" aria-hidden="true" tabindex="-1"></a>pct_with_year <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> n_with_year <span class="sc">/</span> n_banks, <span class="dv">1</span>)</span>
<span id="cb34-1451"><a href="#cb34-1451" aria-hidden="true" tabindex="-1"></a>year_min      <span class="ot">&lt;-</span> <span class="fu">min</span>(bank_level<span class="sc">$</span>year_established, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-1452"><a href="#cb34-1452" aria-hidden="true" tabindex="-1"></a>year_max      <span class="ot">&lt;-</span> <span class="fu">max</span>(bank_level<span class="sc">$</span>year_established, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb34-1453"><a href="#cb34-1453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1454"><a href="#cb34-1454" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary stats for Bank Age</span></span>
<span id="cb34-1455"><a href="#cb34-1455" aria-hidden="true" tabindex="-1"></a>age_summary_stats <span class="ot">&lt;-</span> bank_level <span class="sc">%&gt;%</span></span>
<span id="cb34-1456"><a href="#cb34-1456" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bank_age)) <span class="sc">%&gt;%</span></span>
<span id="cb34-1457"><a href="#cb34-1457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-1458"><a href="#cb34-1458" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_age    =</span> <span class="fu">mean</span>(bank_age),</span>
<span id="cb34-1459"><a href="#cb34-1459" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_age =</span> <span class="fu">median</span>(bank_age),</span>
<span id="cb34-1460"><a href="#cb34-1460" aria-hidden="true" tabindex="-1"></a>    <span class="at">oldest     =</span> <span class="fu">max</span>(bank_age),</span>
<span id="cb34-1461"><a href="#cb34-1461" aria-hidden="true" tabindex="-1"></a>    <span class="at">youngest   =</span> <span class="fu">min</span>(bank_age)</span>
<span id="cb34-1462"><a href="#cb34-1462" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-1463"><a href="#cb34-1463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1464"><a href="#cb34-1464" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 1: Oldest banks</span></span>
<span id="cb34-1465"><a href="#cb34-1465" aria-hidden="true" tabindex="-1"></a>oldest_banks_table <span class="ot">&lt;-</span> bank_level <span class="sc">%&gt;%</span></span>
<span id="cb34-1466"><a href="#cb34-1466" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bank_age)) <span class="sc">%&gt;%</span></span>
<span id="cb34-1467"><a href="#cb34-1467" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_name, bank_id, year_established, bank_age) <span class="sc">%&gt;%</span></span>
<span id="cb34-1468"><a href="#cb34-1468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(bank_age)) <span class="sc">%&gt;%</span></span>
<span id="cb34-1469"><a href="#cb34-1469" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb34-1470"><a href="#cb34-1470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1471"><a href="#cb34-1471" aria-hidden="true" tabindex="-1"></a><span class="co"># Table 2: Data Gaps (Missingness by status)</span></span>
<span id="cb34-1472"><a href="#cb34-1472" aria-hidden="true" tabindex="-1"></a>missing_by_status_table <span class="ot">&lt;-</span> bank_level <span class="sc">%&gt;%</span></span>
<span id="cb34-1473"><a href="#cb34-1473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-1474"><a href="#cb34-1474" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_total     =</span> <span class="fu">n</span>(),</span>
<span id="cb34-1475"><a href="#cb34-1475" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_missing   =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(year_established)),</span>
<span id="cb34-1476"><a href="#cb34-1476" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_missing =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> n_missing <span class="sc">/</span> n_total, <span class="dv">1</span>),</span>
<span id="cb34-1477"><a href="#cb34-1477" aria-hidden="true" tabindex="-1"></a>    <span class="at">.by =</span> bank_status</span>
<span id="cb34-1478"><a href="#cb34-1478" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1479"><a href="#cb34-1479" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(pct_missing), <span class="fu">desc</span>(n_missing))</span>
<span id="cb34-1480"><a href="#cb34-1480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1481"><a href="#cb34-1481" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot 1: Data for establishment year histogram</span></span>
<span id="cb34-1482"><a href="#cb34-1482" aria-hidden="true" tabindex="-1"></a>year_counts_for_plot <span class="ot">&lt;-</span> bank_level <span class="sc">%&gt;%</span></span>
<span id="cb34-1483"><a href="#cb34-1483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(year_established)) <span class="sc">%&gt;%</span></span>
<span id="cb34-1484"><a href="#cb34-1484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(year_established, <span class="at">name =</span> <span class="st">"n_banks"</span>)</span>
<span id="cb34-1485"><a href="#cb34-1485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1486"><a href="#cb34-1486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1487"><a href="#cb34-1487" aria-hidden="true" tabindex="-1"></a>We found <span class="in">`r n_with_year`</span> of the <span class="in">`r n_banks`</span> banks (<span class="in">`r pct_with_year`</span>%) have a recorded establishment year. These dates range from <span class="in">`r year_min`</span> to <span class="in">`r year_max`</span>.</span>
<span id="cb34-1488"><a href="#cb34-1488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1489"><a href="#cb34-1489" aria-hidden="true" tabindex="-1"></a>The median age (as of 2025) for a bank with a known establishment date is <span class="in">`r round(age_summary_stats$median_age, 1)`</span> years, with the oldest being <span class="in">`r age_summary_stats$oldest`</span> years.</span>
<span id="cb34-1490"><a href="#cb34-1490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1491"><a href="#cb34-1491" aria-hidden="true" tabindex="-1"></a>This plot shows the number of new banks established each year:</span>
<span id="cb34-1492"><a href="#cb34-1492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1495"><a href="#cb34-1495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1496"><a href="#cb34-1496" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-establishment-year</span></span>
<span id="cb34-1497"><a href="#cb34-1497" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1498"><a href="#cb34-1498" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 9</span></span>
<span id="cb34-1499"><a href="#cb34-1499" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 5</span></span>
<span id="cb34-1500"><a href="#cb34-1500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1501"><a href="#cb34-1501" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(year_counts_for_plot, <span class="fu">aes</span>(<span class="at">x =</span> year_established, <span class="at">y =</span> n_banks)) <span class="sc">+</span></span>
<span id="cb34-1502"><a href="#cb34-1502" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fill =</span> <span class="st">"#0099F8"</span>) <span class="sc">+</span></span>
<span id="cb34-1503"><a href="#cb34-1503" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">pretty_breaks</span>(<span class="at">n =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="co"># Cleaner axis</span></span>
<span id="cb34-1504"><a href="#cb34-1504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-1505"><a href="#cb34-1505" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Bank Establishment Years"</span>,</span>
<span id="cb34-1506"><a href="#cb34-1506" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Year Established"</span>,</span>
<span id="cb34-1507"><a href="#cb34-1507" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Banks"</span></span>
<span id="cb34-1508"><a href="#cb34-1508" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-1509"><a href="#cb34-1509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>)</span>
<span id="cb34-1510"><a href="#cb34-1510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1511"><a href="#cb34-1511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1512"><a href="#cb34-1512" aria-hidden="true" tabindex="-1"></a>This histogram shows the distribution of bank ages (as of <span class="in">`r this_year`</span>):</span>
<span id="cb34-1513"><a href="#cb34-1513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1516"><a href="#cb34-1516" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1517"><a href="#cb34-1517" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: plot-bank-age-by-status</span></span>
<span id="cb34-1518"><a href="#cb34-1518" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1519"><a href="#cb34-1519" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 10</span></span>
<span id="cb34-1520"><a href="#cb34-1520" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 6</span></span>
<span id="cb34-1521"><a href="#cb34-1521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1522"><a href="#cb34-1522" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bank_level <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(bank_age)), <span class="fu">aes</span>(<span class="at">x =</span> bank_age, <span class="at">fill =</span> bank_status)) <span class="sc">+</span></span>
<span id="cb34-1523"><a href="#cb34-1523" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(</span>
<span id="cb34-1524"><a href="#cb34-1524" aria-hidden="true" tabindex="-1"></a>    <span class="at">binwidth =</span> <span class="dv">1</span>,</span>
<span id="cb34-1525"><a href="#cb34-1525" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"white"</span>, <span class="co"># White outlines for clarity</span></span>
<span id="cb34-1526"><a href="#cb34-1526" aria-hidden="true" tabindex="-1"></a>    <span class="at">boundary =</span> <span class="dv">0</span></span>
<span id="cb34-1527"><a href="#cb34-1527" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-1528"><a href="#cb34-1528" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-1529"><a href="#cb34-1529" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Bank Age Distribution by Status"</span>,</span>
<span id="cb34-1530"><a href="#cb34-1530" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Bank Age (Years)"</span>,</span>
<span id="cb34-1531"><a href="#cb34-1531" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Banks"</span>,</span>
<span id="cb34-1532"><a href="#cb34-1532" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Bank Status"</span></span>
<span id="cb34-1533"><a href="#cb34-1533" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-1534"><a href="#cb34-1534" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb34-1535"><a href="#cb34-1535" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>) <span class="co"># Move legend to bottom for more space</span></span>
<span id="cb34-1536"><a href="#cb34-1536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1537"><a href="#cb34-1537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1538"><a href="#cb34-1538" aria-hidden="true" tabindex="-1"></a>It looks like most banks are under \~25 years, with some pushing 40. Note that many of the older banks are appear to be sold-out or terminated. Next, we can look at a few of the oldest banks:</span>
<span id="cb34-1539"><a href="#cb34-1539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1542"><a href="#cb34-1542" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1543"><a href="#cb34-1543" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: table-oldest-banks</span></span>
<span id="cb34-1544"><a href="#cb34-1544" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1545"><a href="#cb34-1545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1546"><a href="#cb34-1546" aria-hidden="true" tabindex="-1"></a>  oldest_banks_table <span class="sc">%&gt;%</span></span>
<span id="cb34-1547"><a href="#cb34-1547" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-1548"><a href="#cb34-1548" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb34-1549"><a href="#cb34-1549" aria-hidden="true" tabindex="-1"></a>      <span class="at">bank_name =</span> <span class="st">"Bank Name"</span>,</span>
<span id="cb34-1550"><a href="#cb34-1550" aria-hidden="true" tabindex="-1"></a>      <span class="at">bank_id =</span> <span class="st">"Bank ID"</span>,</span>
<span id="cb34-1551"><a href="#cb34-1551" aria-hidden="true" tabindex="-1"></a>      <span class="at">year_established =</span> <span class="st">"Year Est."</span>,</span>
<span id="cb34-1552"><a href="#cb34-1552" aria-hidden="true" tabindex="-1"></a>      <span class="at">bank_age =</span> <span class="st">"Age"</span></span>
<span id="cb34-1553"><a href="#cb34-1553" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1554"><a href="#cb34-1554" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(bank_age, year_established), <span class="at">decimals =</span> <span class="dv">0</span>, <span class="at">sep_mark =</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1555"><a href="#cb34-1555" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb34-1556"><a href="#cb34-1556" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"**Oldest Banks in Dataset**"</span>,</span>
<span id="cb34-1557"><a href="#cb34-1557" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"As of {this_year}"</span>)</span>
<span id="cb34-1558"><a href="#cb34-1558" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-1559"><a href="#cb34-1559" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1560"><a href="#cb34-1560" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1561"><a href="#cb34-1561" aria-hidden="true" tabindex="-1"></a>Finally, just to check the data quality of bank establishment year, I create a table showing what proportion of banks in each status (approved, pending, withdrawn, etc) are missing the establishment year in RIBITS.</span>
<span id="cb34-1562"><a href="#cb34-1562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1565"><a href="#cb34-1565" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1566"><a href="#cb34-1566" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: table-missing-year-status</span></span>
<span id="cb34-1567"><a href="#cb34-1567" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1568"><a href="#cb34-1568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1569"><a href="#cb34-1569" aria-hidden="true" tabindex="-1"></a>  missing_by_status_table <span class="sc">%&gt;%</span></span>
<span id="cb34-1570"><a href="#cb34-1570" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-1571"><a href="#cb34-1571" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cols_label</span>(</span>
<span id="cb34-1572"><a href="#cb34-1572" aria-hidden="true" tabindex="-1"></a>      <span class="at">bank_status =</span> <span class="st">"Bank Status"</span>,</span>
<span id="cb34-1573"><a href="#cb34-1573" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_total =</span> <span class="st">"Total Banks"</span>,</span>
<span id="cb34-1574"><a href="#cb34-1574" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_missing =</span> <span class="st">"Banks Missing Est. Year"</span>,</span>
<span id="cb34-1575"><a href="#cb34-1575" aria-hidden="true" tabindex="-1"></a>      <span class="at">pct_missing =</span> <span class="st">"Missing %"</span></span>
<span id="cb34-1576"><a href="#cb34-1576" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1577"><a href="#cb34-1577" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(n_total, n_missing), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1578"><a href="#cb34-1578" aria-hidden="true" tabindex="-1"></a>    <span class="fu">fmt_percent</span>(<span class="at">columns =</span> pct_missing, <span class="at">scale_values =</span> <span class="cn">FALSE</span>, <span class="at">decimals =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1579"><a href="#cb34-1579" aria-hidden="true" tabindex="-1"></a>    <span class="fu">style_table</span>(</span>
<span id="cb34-1580"><a href="#cb34-1580" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">"**Missing Establishment Year by Bank Status**"</span></span>
<span id="cb34-1581"><a href="#cb34-1581" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb34-1582"><a href="#cb34-1582" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1583"><a href="#cb34-1583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1584"><a href="#cb34-1584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1585"><a href="#cb34-1585" aria-hidden="true" tabindex="-1"></a><span class="fu"># Bank Cowardin Classes</span></span>
<span id="cb34-1586"><a href="#cb34-1586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1587"><a href="#cb34-1587" aria-hidden="true" tabindex="-1"></a>The Cowardin system is a hierarchical method for classifying wetland vegetation and habitats. Because a single mitigation bank may encompass several types of ecosystems, there might be multiple values in the Cowardin columns. The data below represents multi-value lists (comma-separated) for each bank.</span>
<span id="cb34-1588"><a href="#cb34-1588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1589"><a href="#cb34-1589" aria-hidden="true" tabindex="-1"></a>We analyze the four main hierarchy levels:</span>
<span id="cb34-1590"><a href="#cb34-1590" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1591"><a href="#cb34-1591" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Systems: (<span class="in">`bank_cowardin_system_list`</span>) - The broadest category describing the general hydrologic environment (e.g., Palustrine, Riverine, Estuarine).</span>
<span id="cb34-1592"><a href="#cb34-1592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1593"><a href="#cb34-1593" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Subsystems: (<span class="in">`bank_cowardin_subsystem_list`</span>) - A subdivision of Systems based on water flow or flooding regimes (e.g., Tidal, Perennial, Intermittent). Note: The Palustrine system usually has no subsystem.</span>
<span id="cb34-1594"><a href="#cb34-1594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1595"><a href="#cb34-1595" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Classes: (<span class="in">`bank_cowardin_class_list`</span>) - Describes the general appearance of the habitat in terms of either the dominant life form of the vegetation or the composition of the substrate (e.g., Emergent, Scrub-Shrub, Unconsolidated Bottom).</span>
<span id="cb34-1596"><a href="#cb34-1596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1597"><a href="#cb34-1597" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Subclasses: (<span class="in">`bank_cowardin_subclass_list`</span>) - A finer distinction of the Class (e.g., Persistent, Broad-Leaved Deciduous).</span>
<span id="cb34-1598"><a href="#cb34-1598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1601"><a href="#cb34-1601" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1602"><a href="#cb34-1602" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: cowardin-analysis</span></span>
<span id="cb34-1603"><a href="#cb34-1603" aria-hidden="true" tabindex="-1"></a><span class="co">#| warning: false</span></span>
<span id="cb34-1604"><a href="#cb34-1604" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb34-1605"><a href="#cb34-1605" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1606"><a href="#cb34-1606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1607"><a href="#cb34-1607" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the columns of interest mapping to readable names</span></span>
<span id="cb34-1608"><a href="#cb34-1608" aria-hidden="true" tabindex="-1"></a>cowardin_map <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb34-1609"><a href="#cb34-1609" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_cowardin_system_list"</span>    <span class="ot">=</span> <span class="st">"Systems"</span>,</span>
<span id="cb34-1610"><a href="#cb34-1610" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_cowardin_class_list"</span>     <span class="ot">=</span> <span class="st">"Classes"</span>, </span>
<span id="cb34-1611"><a href="#cb34-1611" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_cowardin_subsystem_list"</span> <span class="ot">=</span> <span class="st">"Subsystems"</span>,</span>
<span id="cb34-1612"><a href="#cb34-1612" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bank_cowardin_subclass_list"</span>  <span class="ot">=</span> <span class="st">"Subclasses"</span></span>
<span id="cb34-1613"><a href="#cb34-1613" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-1614"><a href="#cb34-1614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1615"><a href="#cb34-1615" aria-hidden="true" tabindex="-1"></a><span class="co"># Helper function to calculate stats for ONE column</span></span>
<span id="cb34-1616"><a href="#cb34-1616" aria-hidden="true" tabindex="-1"></a>calc_cowardin_stats <span class="ot">&lt;-</span> <span class="cf">function</span>(col_name, label, df) {</span>
<span id="cb34-1617"><a href="#cb34-1617" aria-hidden="true" tabindex="-1"></a>  vals <span class="ot">&lt;-</span> df[[col_name]]</span>
<span id="cb34-1618"><a href="#cb34-1618" aria-hidden="true" tabindex="-1"></a>  n_per_bank <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(vals) <span class="sc">|</span> vals <span class="sc">==</span> <span class="st">""</span>, <span class="dv">0</span>, <span class="fu">str_count</span>(vals, <span class="st">","</span>) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb34-1619"><a href="#cb34-1619" aria-hidden="true" tabindex="-1"></a>  all_tokens <span class="ot">&lt;-</span> vals[<span class="sc">!</span><span class="fu">is.na</span>(vals) <span class="sc">&amp;</span> vals <span class="sc">!=</span> <span class="st">""</span>] <span class="sc">%&gt;%</span> </span>
<span id="cb34-1620"><a href="#cb34-1620" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_split</span>(<span class="st">",</span><span class="sc">\\</span><span class="st">s*"</span>) <span class="sc">%&gt;%</span> <span class="fu">unlist</span>() <span class="sc">%&gt;%</span> <span class="fu">str_trim</span>()</span>
<span id="cb34-1621"><a href="#cb34-1621" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1622"><a href="#cb34-1622" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb34-1623"><a href="#cb34-1623" aria-hidden="true" tabindex="-1"></a>    <span class="at">classification_level =</span> label,</span>
<span id="cb34-1624"><a href="#cb34-1624" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_types =</span> <span class="fu">n_distinct</span>(all_tokens),</span>
<span id="cb34-1625"><a href="#cb34-1625" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_tags =</span> <span class="fu">length</span>(all_tokens),</span>
<span id="cb34-1626"><a href="#cb34-1626" aria-hidden="true" tabindex="-1"></a>    <span class="at">banks_with_data =</span> <span class="fu">sum</span>(n_per_bank <span class="sc">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb34-1627"><a href="#cb34-1627" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_of_banks =</span> <span class="fu">mean</span>(n_per_bank <span class="sc">&gt;</span> <span class="dv">0</span>),</span>
<span id="cb34-1628"><a href="#cb34-1628" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_per_bank =</span> <span class="fu">mean</span>(n_per_bank[n_per_bank <span class="sc">&gt;</span> <span class="dv">0</span>])</span>
<span id="cb34-1629"><a href="#cb34-1629" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-1630"><a href="#cb34-1630" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-1631"><a href="#cb34-1631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1632"><a href="#cb34-1632" aria-hidden="true" tabindex="-1"></a><span class="co"># Build summary table</span></span>
<span id="cb34-1633"><a href="#cb34-1633" aria-hidden="true" tabindex="-1"></a>summary_df <span class="ot">&lt;-</span> <span class="fu">imap_dfr</span>(cowardin_map, <span class="sc">~</span><span class="fu">calc_cowardin_stats</span>(.y, .x, data))</span>
<span id="cb34-1634"><a href="#cb34-1634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1635"><a href="#cb34-1635" aria-hidden="true" tabindex="-1"></a><span class="co"># Create formatted summary table</span></span>
<span id="cb34-1636"><a href="#cb34-1636" aria-hidden="true" tabindex="-1"></a>summary_df <span class="sc">%&gt;%</span></span>
<span id="cb34-1637"><a href="#cb34-1637" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-1638"><a href="#cb34-1638" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb34-1639"><a href="#cb34-1639" aria-hidden="true" tabindex="-1"></a>    <span class="at">classification_level =</span> <span class="st">"Classification Level"</span>,</span>
<span id="cb34-1640"><a href="#cb34-1640" aria-hidden="true" tabindex="-1"></a>    <span class="at">unique_types =</span> <span class="st">"Unique Types"</span>,</span>
<span id="cb34-1641"><a href="#cb34-1641" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_tags =</span> <span class="st">"Total Tags"</span>, </span>
<span id="cb34-1642"><a href="#cb34-1642" aria-hidden="true" tabindex="-1"></a>    <span class="at">banks_with_data =</span> <span class="st">"Banks with Data"</span>,</span>
<span id="cb34-1643"><a href="#cb34-1643" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_of_banks =</span> <span class="st">"% of Banks"</span>,</span>
<span id="cb34-1644"><a href="#cb34-1644" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_per_bank =</span> <span class="st">"Avg per Bank"</span></span>
<span id="cb34-1645"><a href="#cb34-1645" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1646"><a href="#cb34-1646" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(unique_types, total_tags, banks_with_data), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1647"><a href="#cb34-1647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(avg_per_bank), <span class="at">decimals =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1648"><a href="#cb34-1648" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> <span class="fu">c</span>(pct_of_banks), <span class="at">decimals =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1649"><a href="#cb34-1649" aria-hidden="true" tabindex="-1"></a>  <span class="fu">style_table</span>(</span>
<span id="cb34-1650"><a href="#cb34-1650" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"**Cowardin Classification Data Availability**"</span>,</span>
<span id="cb34-1651"><a href="#cb34-1651" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">glue</span>(<span class="st">"Data density across {n_banks} banks"</span>)</span>
<span id="cb34-1652"><a href="#cb34-1652" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-1653"><a href="#cb34-1653" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1654"><a href="#cb34-1654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1655"><a href="#cb34-1655" aria-hidden="true" tabindex="-1"></a><span class="fu">## Top Classifications by Level</span></span>
<span id="cb34-1656"><a href="#cb34-1656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1659"><a href="#cb34-1659" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1660"><a href="#cb34-1660" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: cowardin-top-classifications</span></span>
<span id="cb34-1661"><a href="#cb34-1661" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1662"><a href="#cb34-1662" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.width: 12</span></span>
<span id="cb34-1663"><a href="#cb34-1663" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig.height: 8</span></span>
<span id="cb34-1664"><a href="#cb34-1664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1665"><a href="#cb34-1665" aria-hidden="true" tabindex="-1"></a><span class="co"># Create tidy data for plotting</span></span>
<span id="cb34-1666"><a href="#cb34-1666" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb34-1667"><a href="#cb34-1667" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(bank_id, <span class="fu">all_of</span>(<span class="fu">names</span>(cowardin_map))) <span class="sc">%&gt;%</span></span>
<span id="cb34-1668"><a href="#cb34-1668" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>bank_id, <span class="at">names_to =</span> <span class="st">"col_name"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1669"><a href="#cb34-1669" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(value), value <span class="sc">!=</span> <span class="st">""</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1670"><a href="#cb34-1670" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(value, <span class="at">sep =</span> <span class="st">",</span><span class="sc">\\</span><span class="st">s*"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1671"><a href="#cb34-1671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb34-1672"><a href="#cb34-1672" aria-hidden="true" tabindex="-1"></a>    <span class="at">value =</span> <span class="fu">str_trim</span>(value),</span>
<span id="cb34-1673"><a href="#cb34-1673" aria-hidden="true" tabindex="-1"></a>    <span class="at">category =</span> <span class="fu">factor</span>(cowardin_map[col_name], <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Systems"</span>, <span class="st">"Subsystems"</span>, <span class="st">"Classes"</span>, <span class="st">"Subclasses"</span>))</span>
<span id="cb34-1674"><a href="#cb34-1674" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1675"><a href="#cb34-1675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(category, value) <span class="sc">%&gt;%</span></span>
<span id="cb34-1676"><a href="#cb34-1676" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(category) <span class="sc">%&gt;%</span></span>
<span id="cb34-1677"><a href="#cb34-1677" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(n, <span class="at">n =</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1678"><a href="#cb34-1678" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb34-1679"><a href="#cb34-1679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1680"><a href="#cb34-1680" aria-hidden="true" tabindex="-1"></a><span class="co"># Create faceted plot</span></span>
<span id="cb34-1681"><a href="#cb34-1681" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> <span class="fu">reorder_within</span>(value, n, category))) <span class="sc">+</span></span>
<span id="cb34-1682"><a href="#cb34-1682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"grey"</span>) <span class="sc">+</span></span>
<span id="cb34-1683"><a href="#cb34-1683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> n), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb34-1684"><a href="#cb34-1684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_reordered</span>() <span class="sc">+</span></span>
<span id="cb34-1685"><a href="#cb34-1685" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>category, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb34-1686"><a href="#cb34-1686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-1687"><a href="#cb34-1687" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 5 Cowardin Classifications by Level"</span>,</span>
<span id="cb34-1688"><a href="#cb34-1688" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of Banks"</span>,</span>
<span id="cb34-1689"><a href="#cb34-1689" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="cn">NULL</span></span>
<span id="cb34-1690"><a href="#cb34-1690" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-1691"><a href="#cb34-1691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-1692"><a href="#cb34-1692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">11</span>)) <span class="sc">+</span></span>
<span id="cb34-1693"><a href="#cb34-1693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand_limits</span>(<span class="at">x =</span> <span class="fu">max</span>(plot_data<span class="sc">$</span>n) <span class="sc">*</span> <span class="fl">1.1</span>)</span>
<span id="cb34-1694"><a href="#cb34-1694" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1695"><a href="#cb34-1695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1696"><a href="#cb34-1696" aria-hidden="true" tabindex="-1"></a><span class="fu">## Classification Complexity Analysis</span></span>
<span id="cb34-1697"><a href="#cb34-1697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1700"><a href="#cb34-1700" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb34-1701"><a href="#cb34-1701" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: cowardin-complexity</span></span>
<span id="cb34-1702"><a href="#cb34-1702" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: true</span></span>
<span id="cb34-1703"><a href="#cb34-1703" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1704"><a href="#cb34-1704" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to analyze complexity per level</span></span>
<span id="cb34-1705"><a href="#cb34-1705" aria-hidden="true" tabindex="-1"></a>analyze_complexity <span class="ot">&lt;-</span> <span class="cf">function</span>(col_name, label) {</span>
<span id="cb34-1706"><a href="#cb34-1706" aria-hidden="true" tabindex="-1"></a>  vals <span class="ot">&lt;-</span> data[[col_name]]</span>
<span id="cb34-1707"><a href="#cb34-1707" aria-hidden="true" tabindex="-1"></a>  n_per_bank <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(vals) <span class="sc">|</span> vals <span class="sc">==</span> <span class="st">""</span>, <span class="dv">0</span>, <span class="fu">str_count</span>(vals, <span class="st">","</span>) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb34-1708"><a href="#cb34-1708" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb34-1709"><a href="#cb34-1709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb34-1710"><a href="#cb34-1710" aria-hidden="true" tabindex="-1"></a>    <span class="at">classification_level =</span> label,</span>
<span id="cb34-1711"><a href="#cb34-1711" aria-hidden="true" tabindex="-1"></a>    <span class="at">single_classification =</span> <span class="fu">sum</span>(n_per_bank <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb34-1712"><a href="#cb34-1712" aria-hidden="true" tabindex="-1"></a>    <span class="at">multiple_classifications =</span> <span class="fu">sum</span>(n_per_bank <span class="sc">&gt;</span> <span class="dv">1</span>),</span>
<span id="cb34-1713"><a href="#cb34-1713" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_classifications =</span> <span class="fu">max</span>(n_per_bank),</span>
<span id="cb34-1714"><a href="#cb34-1714" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_multiple =</span> <span class="fu">mean</span>(n_per_bank <span class="sc">&gt;</span> <span class="dv">1</span>)</span>
<span id="cb34-1715"><a href="#cb34-1715" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-1716"><a href="#cb34-1716" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-1717"><a href="#cb34-1717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1718"><a href="#cb34-1718" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate complexity for all levels</span></span>
<span id="cb34-1719"><a href="#cb34-1719" aria-hidden="true" tabindex="-1"></a>complexity_df <span class="ot">&lt;-</span> <span class="fu">imap_dfr</span>(cowardin_map, <span class="sc">~</span><span class="fu">analyze_complexity</span>(.y, .x))</span>
<span id="cb34-1720"><a href="#cb34-1720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1721"><a href="#cb34-1721" aria-hidden="true" tabindex="-1"></a><span class="co"># Create complexity table</span></span>
<span id="cb34-1722"><a href="#cb34-1722" aria-hidden="true" tabindex="-1"></a>complexity_df <span class="sc">%&gt;%</span></span>
<span id="cb34-1723"><a href="#cb34-1723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-1724"><a href="#cb34-1724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cols_label</span>(</span>
<span id="cb34-1725"><a href="#cb34-1725" aria-hidden="true" tabindex="-1"></a>    <span class="at">classification_level =</span> <span class="st">"Classification Level"</span>,</span>
<span id="cb34-1726"><a href="#cb34-1726" aria-hidden="true" tabindex="-1"></a>    <span class="at">single_classification =</span> <span class="st">"Single"</span>,</span>
<span id="cb34-1727"><a href="#cb34-1727" aria-hidden="true" tabindex="-1"></a>    <span class="at">multiple_classifications =</span> <span class="st">"Multiple"</span>, </span>
<span id="cb34-1728"><a href="#cb34-1728" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_classifications =</span> <span class="st">"Max per Bank"</span>,</span>
<span id="cb34-1729"><a href="#cb34-1729" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_multiple =</span> <span class="st">"% Multiple"</span></span>
<span id="cb34-1730"><a href="#cb34-1730" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb34-1731"><a href="#cb34-1731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_number</span>(<span class="at">columns =</span> <span class="fu">c</span>(single_classification, multiple_classifications, max_classifications), <span class="at">decimals =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1732"><a href="#cb34-1732" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fmt_percent</span>(<span class="at">columns =</span> <span class="fu">c</span>(pct_multiple), <span class="at">decimals =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-1733"><a href="#cb34-1733" aria-hidden="true" tabindex="-1"></a>  <span class="fu">style_table</span>(</span>
<span id="cb34-1734"><a href="#cb34-1734" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"**Classification Complexity Analysis**"</span>,</span>
<span id="cb34-1735"><a href="#cb34-1735" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Banks with single vs multiple classifications by level"</span></span>
<span id="cb34-1736"><a href="#cb34-1736" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-1737"><a href="#cb34-1737" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb34-1738"><a href="#cb34-1738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1739"><a href="#cb34-1739" aria-hidden="true" tabindex="-1"></a><span class="fu">## Key Findings</span></span>
<span id="cb34-1740"><a href="#cb34-1740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1741"><a href="#cb34-1741" aria-hidden="true" tabindex="-1"></a>The Cowardin classification analysis reveals several important patterns:</span>
<span id="cb34-1742"><a href="#cb34-1742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1743"><a href="#cb34-1743" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Data Coverage**: <span class="in">`r round(100 * summary_df$banks_with_data[summary_df$classification_level == "Systems"] / n_distinct(data$bank_id), 1)`</span>% of banks have system-level data, with <span class="in">`r round(100 * summary_df$banks_with_data[summary_df$classification_level == "Classes"] / n_distinct(data$bank_id), 1)`</span>% having class-level data, indicating good coverage of ecological habitat information.</span>
<span id="cb34-1744"><a href="#cb34-1744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1745"><a href="#cb34-1745" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Dominant Systems**: The <span class="in">`r summary_df$unique_types[summary_df$classification_level == "Systems"]`</span> system dominates, representing the majority of all system classifications. This includes freshwater wetlands like marshes, swamps, and forested wetlands - the primary focus of mitigation banking.</span>
<span id="cb34-1746"><a href="#cb34-1746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1747"><a href="#cb34-1747" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Habitat Diversity**: Banks typically contain multiple habitat types, with an average of <span class="in">`r round(summary_df$avg_per_bank[summary_df$classification_level == "Classes"], 1)`</span> classes per bank, reflecting the ecological complexity of mitigation sites.</span>
<span id="cb34-1748"><a href="#cb34-1748" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1749"><a href="#cb34-1749" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Classification Complexity**: <span class="in">`r round(100 * complexity_df$pct_multiple[complexity_df$classification_level == "Classes"], 1)`</span>% of banks have multiple class classifications, demonstrating that most mitigation banks encompass diverse habitat types rather than single ecosystems.</span>
<span id="cb34-1750"><a href="#cb34-1750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1751"><a href="#cb34-1751" aria-hidden="true" tabindex="-1"></a><span class="fu"># Types of Credits</span></span>
<span id="cb34-1752"><a href="#cb34-1752" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1753"><a href="#cb34-1753" aria-hidden="true" tabindex="-1"></a>One thing the join allowed us to do was look at the types of credits available for each bank. The relevant columns here are <span class="in">`initiation_credits`</span>, <span class="in">`initiation_acres`</span>, and <span class="in">`initiation_feet`</span>. We also have summary totals for <span class="in">`withdrawn_credits`</span>, <span class="in">`tot_pot_credits_from_details`</span>, and <span class="in">`tot_pot_credit_types`</span>. </span>
<span id="cb34-1754"><a href="#cb34-1754" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1755"><a href="#cb34-1755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1756"><a href="#cb34-1756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1757"><a href="#cb34-1757" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summary and Next Steps</span></span>
<span id="cb34-1758"><a href="#cb34-1758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1759"><a href="#cb34-1759" aria-hidden="true" tabindex="-1"></a>This report provided a fairly high-level summary of the main RIBITS raw GeoJson extract. We looked at spatial data availability, bank kinds, types, establishment years, and status through time.</span>
<span id="cb34-1760"><a href="#cb34-1760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1761"><a href="#cb34-1761" aria-hidden="true" tabindex="-1"></a>In terms of next steps:</span>
<span id="cb34-1762"><a href="#cb34-1762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1763"><a href="#cb34-1763" aria-hidden="true" tabindex="-1"></a>There is a lot of data still available on RIBITS that wasn't able to be extracted via the GeoJson API. It might be worth manually downloading all available files, cleaning and harmonizing them, and then joining them to the main RIBITS dataframe to get a more comprehensive look a the banks. For example, we don't have any information on if the banks are stream vs wetland mitigation banks, what type of wetland ecological characteristics are available, or more specific credit information.</span>
<span id="cb34-1764"><a href="#cb34-1764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1765"><a href="#cb34-1765" aria-hidden="true" tabindex="-1"></a>For further downstream analysis, it also might be worth cleaning up the geospatial elements. This would include:</span>
<span id="cb34-1766"><a href="#cb34-1766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-1767"><a href="#cb34-1767" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Removing/replacing all clearly incorrect footprint geometries with service area geometries</span>
<span id="cb34-1768"><a href="#cb34-1768" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Deciding what an acceptable "margin of error" will be for discrepancies between footprint area values</span>
<span id="cb34-1769"><a href="#cb34-1769" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Imputing bank footprint areas (i.e., drawing a circle around the centroid) using the value listed in the "total acres" column when no footprint geometry is available</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>